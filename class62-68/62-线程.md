# C++ ä¸­çš„çº¿ç¨‹ï¼ˆ`std::thread`ï¼‰è¯´æ˜ä¸æ€»ç»“**

## ä¸€ã€ä»€ä¹ˆæ˜¯ `std::thread`ï¼Ÿ

`std::thread` æ˜¯ C++11 å¼•å…¥çš„æ ‡å‡†åº“ç»„ä»¶ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†**æ“ä½œç³»ç»Ÿçº§åˆ«çš„å¹¶å‘æ‰§è¡Œçº¿ç¨‹**ã€‚å®ƒå°è£…äº†åº•å±‚å¹³å°ï¼ˆå¦‚ POSIX threads æˆ– Windows threadsï¼‰çš„å¤æ‚æ€§ï¼Œæä¾›äº†ä¸€ç§è·¨å¹³å°çš„æ–¹å¼æ¥å®ç°å¤šçº¿ç¨‹ç¼–ç¨‹ã€‚

é€šè¿‡ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œç¨‹åºå¯ä»¥ï¼š

* åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡
* æé«˜ CPU åˆ©ç”¨ç‡ï¼ˆå°¤å…¶æ˜¯åœ¨å¤šæ ¸å¤„ç†å™¨ä¸Šï¼‰
* å®ç°å“åº”å¼ UIï¼ˆä¾‹å¦‚ä¸»çº¿ç¨‹å¤„ç†ç•Œé¢ï¼Œåå°çº¿ç¨‹å¤„ç†è®¡ç®—ï¼‰

## äºŒã€æ ¸å¿ƒç‰¹ç‚¹æ€»ç»“


| ç‰¹æ€§                | è¯´æ˜                                                             |
| ------------------- | ---------------------------------------------------------------- |
| **å¤´æ–‡ä»¶**          | `<thread>`                                                       |
| **å¯åŠ¨æ–¹å¼**        | æ„é€ `std::thread` å¯¹è±¡æ—¶ä¼ å…¥å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€lambdaã€ä»¿å‡½æ•°ç­‰ï¼‰ |
| **ä¸è‡ªåŠ¨ç­‰å¾…**      | åˆ›å»ºçš„çº¿ç¨‹ä¸ä¼šè‡ªåŠ¨â€œjoinâ€ï¼Œå¿…é¡»æ‰‹åŠ¨è°ƒç”¨`.join()` æˆ– `.detach()` |
| **RAII ä¸å®Œå…¨æ”¯æŒ** | å¦‚æœæœª`join` æˆ– `detach` å°±é”€æ¯çº¿ç¨‹å¯¹è±¡ï¼Œç¨‹åºä¼š `std::terminate` |
| **å¯ä¼ é€’å‚æ•°**      | æ”¯æŒå‘çº¿ç¨‹å‡½æ•°ä¼ é€’å‚æ•°ï¼ˆé»˜è®¤æ˜¯å€¼æ‹·è´ï¼Œéœ€ç”¨`std::ref` ä¼ å¼•ç”¨ï¼‰    |
| **è·¨å¹³å°**          | æ ‡å‡†åº“æŠ½è±¡ï¼Œæ— éœ€å…³å¿ƒ Win32/Pthreads å·®å¼‚                         |

## ä¸‰ã€åŸºæœ¬ç”¨æ³•æµç¨‹

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><thread><span>
</span>
<span></span>void task() <span>{
</span><span>    </span><span>// è¦åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç </span><span>
</span>}

<span></span>int main() <span>{
</span><span>    </span>std::thread t(task)<span>;        </span><span>// 1. åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹</span><span>
</span><span>    t.join();                   </span><span>// 2. ç­‰å¾…çº¿ç¨‹å®Œæˆï¼ˆé˜»å¡ä¸»çº¿ç¨‹ï¼‰</span><span>
</span><span>    </span><span>// æˆ–è€… t.detach();         // åˆ†ç¦»çº¿ç¨‹ï¼Œè®©å®ƒç‹¬ç«‹è¿è¡Œ</span><span>
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

## å››ã€é‡è¦è§„åˆ™ä¸é™·é˜±


| è§„åˆ™                                          | è¯´æ˜                                                                                    |
| --------------------------------------------- | --------------------------------------------------------------------------------------- |
| ğŸ”**æ¯ä¸ªçº¿ç¨‹å¯¹è±¡åªèƒ½ `join()` ä¸€æ¬¡**          | å¤šæ¬¡`join()` ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º                                                           |
| ğŸš«**ä¸èƒ½å¤åˆ¶çº¿ç¨‹å¯¹è±¡**                        | `std::thread` ä¸å¯æ‹·è´ï¼Œä½†å¯ä»¥ç§»åŠ¨ï¼ˆ`std::move`ï¼‰                                       |
| â³**ä¸»çº¿ç¨‹ç»“æŸ = æ•´ä¸ªè¿›ç¨‹ç»“æŸ**               | å³ä½¿å…¶ä»–çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œ`main()` è¿”å›åç¨‹åºç»ˆæ­¢                                           |
| ğŸ’£**æœª `join()` / `detach()` å°±ææ„ â†’ å´©æºƒ** | ä¼šè§¦å‘`std::terminate()`                                                                |
| ğŸ§µ**å…±äº«æ•°æ®éœ€è¦åŒæ­¥**                        | å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å˜é‡æ—¶å¿…é¡»ä½¿ç”¨äº’æ–¥é”ï¼ˆ`std::mutex`ï¼‰ï¼Œå¦åˆ™å¯¼è‡´**æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰** |

## äº”ã€å¯è¿è¡Œå®Œæ•´ä»£ç ç¤ºä¾‹

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><iostream><span>
</span><span></span><span>#</span>include<span> </span><thread><span>
</span><span></span><span>#</span>include<span> </span><chrono><span>
</span><span></span><span>#</span>include<span> </span><vector><span>
</span><span></span><span>#</span>include<span> </span><functional><span>
</span><span></span><span>#</span>include<span> </span><mutex><span>
</span>
<span></span><span>// å…¨å±€å˜é‡ï¼šå¤šä¸ªçº¿ç¨‹å…±äº«</span><span>
</span><span></span><span>int</span><span> shared_counter = </span>0<span>;
</span><span></span><span>std</span><span>::mutex counter_mutex;  </span><span>// ä¿æŠ¤ shared_counter çš„äº’æ–¥é”</span><span>
</span>
<span></span><span>// ç¤ºä¾‹ 1ï¼šæ™®é€šå‡½æ•°ä½œä¸ºçº¿ç¨‹ä»»åŠ¡</span><span>
</span><span></span>void print_hello(int id) <span>{
</span><span>    </span><span>for</span><span> (</span><span>int</span><span> i = </span>0<span>; i < </span>3<span>; ++i) {
</span><span>        </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Thread "</span><span> << id << </span><span>": Hello "</span><span> << i << </span><span>"\n"</span><span>;
</span><span>        </span><span>std</span><span>::this_thread::sleep_for(</span><span>std</span><span>::chrono::milliseconds(</span>100<span>));
</span>    }
}

<span></span><span>// ç¤ºä¾‹ 2ï¼šå¸¦å¼•ç”¨å‚æ•°çš„å‡½æ•°ï¼ˆå¿…é¡»ç”¨ std::refï¼‰</span><span>
</span><span></span>void increment_counter(int times) <span>{
</span><span>    </span><span>for</span><span> (</span><span>int</span><span> i = </span>0<span>; i < times; ++i) {
</span><span>        </span><span>// åŠ é”ä¿è¯åŸå­æ€§</span><span>
</span><span>        </span>std::lock_guard<std::mutex> lock(counter_mutex)<span>;
</span>        ++shared_counter;
<span>        </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Thread "</span><span> << </span><span>std</span><span>::this_thread::get_id()
</span><span>                  << </span><span>" incremented counter to "</span><span> << shared_counter << </span><span>"\n"</span><span>;
</span><span>        </span><span>std</span><span>::this_thread::sleep_for(</span><span>std</span><span>::chrono::milliseconds(</span>50<span>));
</span>    }
}

<span></span><span>// ç¤ºä¾‹ 3ï¼šLambda è¡¨è¾¾å¼ä½œä¸ºçº¿ç¨‹ä»»åŠ¡</span><span>
</span><span></span><span>auto</span><span> lambda_task = [](</span><span>const</span><span> </span><span>std</span><span>::</span><span>string</span><span>& name) {
</span><span>    </span><span>for</span><span> (</span><span>int</span><span> i = </span>0<span>; i < </span>2<span>; ++i) {
</span><span>        </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"[Lambda] "</span><span> << name << </span><span>" - Step "</span><span> << i << </span><span>"\n"</span><span>;
</span><span>        </span><span>std</span><span>::this_thread::sleep_for(</span><span>std</span><span>::chrono::milliseconds(</span>150<span>));
</span>    }
};

<span></span>int main() <span>{
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"=== ä¸»çº¿ç¨‹ ID: "</span><span> << </span><span>std</span><span>::this_thread::get_id() << </span><span>" ===\n\n"</span><span>;
</span>
<span>    </span><span>std</span><span>::</span><span>vector</span><span><</span><span>std</span><span>::thread> threads;
</span>
<span>    </span><span>// 1. åˆ›å»ºå¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ™®é€šå‡½æ•°</span><span>
</span><span>    </span><span>for</span><span> (</span><span>int</span><span> i = </span>0<span>; i < </span>3<span>; ++i) {
</span><span>        threads.emplace_back(print_hello, i + </span>1<span>);  </span><span>// è‡ªåŠ¨æ¨å¯¼å‚æ•°ç±»å‹</span><span>
</span>    }

<span>    </span><span>// 2. åˆ›å»ºçº¿ç¨‹æ‰§è¡Œ lambda</span><span>
</span><span>    threads.emplace_back(lambda_task, </span><span>"Worker A"</span><span>);
</span><span>    threads.emplace_back(lambda_task, </span><span>"Worker B"</span><span>);
</span>
<span>    </span><span>// 3. åˆ›å»ºçº¿ç¨‹ä¿®æ”¹å…±äº«å˜é‡ï¼ˆæ¼”ç¤ºæ•°æ®ç«äº‰é˜²æŠ¤ï¼‰</span><span>
</span><span>    </span><span>for</span><span> (</span><span>int</span><span> i = </span>0<span>; i < </span>2<span>; ++i) {
</span><span>        threads.emplace_back(increment_counter, </span>3<span>);
</span>    }

<span>    </span><span>// 4. ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span><span>
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"\nç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ...\n"</span><span>;
</span><span>    </span><span>for</span><span> (</span><span>auto</span><span>& t : threads) {
</span><span>        </span><span>if</span><span> (t.joinable()) {  </span><span>// æ£€æŸ¥æ˜¯å¦å¯ join</span><span>
</span>            t.join();
        }
    }

<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"\nâœ… æ‰€æœ‰çº¿ç¨‹å·²å®Œæˆã€‚\n"</span><span>;
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"æœ€ç»ˆ shared_counter å€¼: "</span><span> << shared_counter << </span><span>"\n"</span><span>;
</span>
<span>    </span><span>// 5. æ¼”ç¤º detachï¼šåˆ†ç¦»çº¿ç¨‹ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰</span><span>
</span><span>    </span>std::thread detached_thread([]() {
        std::cout << "\n--- åˆ†ç¦»çº¿ç¨‹å¼€å§‹ ---\n";
        for (int i = 0; i < 3; ++i) {
            std::cout << "Detached thread: " << i << "\n";
            std::this_thread::sleep_for(std::chrono::milliseconds(200));
        }
        std::cout << "--- åˆ†ç¦»çº¿ç¨‹ç»“æŸ ---\n";
    })<span>;
</span>
<span>    detached_thread.detach();  </span><span>// åˆ†ç¦»ï¼Œä¸å†ç­‰å¾…</span><span>
</span>
<span>    </span><span>// ä¸»çº¿ç¨‹ä¼‘çœ ä¸€ä¼šå„¿ï¼Œç¡®ä¿èƒ½çœ‹åˆ°è¾“å‡º</span><span>
</span><span>    </span><span>std</span><span>::this_thread::sleep_for(</span><span>std</span><span>::chrono::seconds(</span>2<span>));
</span>
<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"\nğŸ‰ ä¸»å‡½æ•°ç»“æŸï¼Œç¨‹åºé€€å‡ºã€‚\n"</span><span>;
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

## å…­ã€ç¼–è¯‘ä¸è¿è¡Œ

âš ï¸ å¿…é¡»é“¾æ¥çº¿ç¨‹åº“ï¼ˆå°¤å…¶æ˜¯ Linux ä¸Šçš„ GCCï¼‰ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class="" data-spm-anchor-id="5176.28103460.0.i67.228c2e31FrabiA"><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>g++ -std=c++11 -pthread -o thread_example thread.cpp
</span>./thread_example</code></pre></div></div></pre>

> `-pthread` æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™å¯èƒ½æŠ¥é”™ï¼š`undefined reference to 'pthread_create'`

## ä¸ƒã€è¾“å‡ºç¤ºä¾‹ï¼ˆé¡ºåºå¯èƒ½ä¸åŒï¼‰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>=== ä¸»çº¿ç¨‹ ID: 140289378299456 ===
</span>
Thread 1: Hello 0
Thread 2: Hello 0
Thread 3: Hello 0
[Lambda] Worker A - Step 0
[Lambda] Worker B - Step 0
Thread 140289365382912 incremented counter to 1
Thread 140289356990208 incremented counter to 2
Thread 1: Hello 1
Thread 2: Hello 1
...
ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ...

âœ… æ‰€æœ‰çº¿ç¨‹å·²å®Œæˆã€‚
æœ€ç»ˆ shared_counter å€¼: 6

--- åˆ†ç¦»çº¿ç¨‹å¼€å§‹ ---
Detached thread: 0
Detached thread: 1
ğŸ‰ ä¸»å‡½æ•°ç»“æŸï¼Œç¨‹åºé€€å‡ºã€‚
Detached thread: 2
--- åˆ†ç¦»çº¿ç¨‹ç»“æŸ ---</code></pre></div></div></pre>

> æ³¨æ„ï¼šåˆ†ç¦»çº¿ç¨‹å¯èƒ½åœ¨ä¸»å‡½æ•°ç»“æŸåæ‰æ‰“å°å®Œæœ€åä¸€è¡Œï¼

## å…«ã€æœ€ä½³å®è·µå»ºè®®


| æ¨èåšæ³•                           | è¯´æ˜                                                               |
| ---------------------------------- | ------------------------------------------------------------------ |
| âœ…**ä¼˜å…ˆä½¿ç”¨ `join()`**            | ç¡®ä¿èµ„æºå›æ”¶ï¼Œé¿å…æ‚¬ç©ºçº¿ç¨‹                                         |
| âœ…**é¿å… `detach()`**              | å¾ˆéš¾ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œå®¹æ˜“é€ æˆèµ„æºæ³„æ¼æˆ–è®¿é—®æ— æ•ˆå†…å­˜                   |
| âœ…**ä½¿ç”¨ RAII ç®¡ç†çº¿ç¨‹**           | å¦‚å°†çº¿ç¨‹æ”¾å…¥å®¹å™¨æˆ–æ™ºèƒ½æŒ‡é’ˆï¼ˆè™½ç„¶`std::thread` æœ¬èº«ä¸æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼‰   |
| âœ…**å…±äº«æ•°æ®åŠ é”**                 | ä½¿ç”¨`std::mutex` + `std::lock_guard` é˜²æ­¢æ•°æ®ç«äº‰                  |
| âœ…**ä¸è¦åœ¨çº¿ç¨‹ä¸­è¿”å›å±€éƒ¨å˜é‡å¼•ç”¨** | ç”Ÿå‘½å‘¨æœŸé—®é¢˜                                                       |
| âœ…**è€ƒè™‘æ›´é«˜å±‚å¹¶å‘æ¨¡å‹**           | å¦‚`std::async`, `std::future`, çº¿ç¨‹æ± ç­‰ï¼Œæ¯”è£¸ `std::thread` æ›´å®‰å…¨ |

## ä¹ã€å¸¸è§é”™è¯¯æ’æŸ¥


| é”™è¯¯ç°è±¡                                        | å¯èƒ½åŸå›                   | è§£å†³æ–¹æ¡ˆ                          |
| ----------------------------------------------- | ------------------------- | --------------------------------- |
| ç¨‹åºå´©æºƒæˆ–å¼‚å¸¸é€€å‡º                              | çº¿ç¨‹æœª`join()` å°±ææ„     | æ·»åŠ `join()` æˆ– `detach()`        |
| æ•°æ®æ··ä¹±ã€ç»“æœä¸ä¸€è‡´                            | å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«å˜é‡  | ä½¿ç”¨`std::mutex` åŠ é”             |
| ç¼–è¯‘æŠ¥é”™`undefined reference to pthread_create` | ç¼ºå°‘`-pthread` ç¼–è¯‘é€‰é¡¹   | åŠ ä¸Š`-pthread`                    |
| çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œå°±é€€å‡º                            | ä¸»çº¿ç¨‹å¤ªå¿«ç»“æŸ            | åœ¨`main()` ç»“å°¾åŠ  `join()` æˆ–å»¶æ—¶ |
| å‚æ•°ä¼ é€’å‡ºé”™                                    | å¿˜è®°ç”¨`std::ref()` ä¼ å¼•ç”¨ | ä½¿ç”¨`std::ref(my_var)`            |

## åã€æ€»ç»“


| ç‰¹æ€§             | è¯´æ˜                                               |
| ---------------- | -------------------------------------------------- |
| **ç”¨é€”**         | å®ç°çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œ                                 |
| **ä¼˜ç‚¹**         | è·¨å¹³å°ã€æ€§èƒ½é«˜ã€ç›´æ¥æ§åˆ¶çº¿ç¨‹                       |
| **ç¼ºç‚¹**         | å®¹æ˜“å‡ºé”™ï¼ˆæ­»é”ã€ç«æ€æ¡ä»¶ï¼‰ã€éœ€æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ     |
| **é€‚ç”¨åœºæ™¯**     | è®¡ç®—å¯†é›†å‹ä»»åŠ¡ã€I/O å¹¶å‘ã€æ¸¸æˆå¼•æ“ã€æœåŠ¡å™¨åå°å¤„ç† |
| **è¿›é˜¶æ›¿ä»£æ–¹æ¡ˆ** | `std::async`, `std::future`, ç¬¬ä¸‰æ–¹çº¿ç¨‹æ± åº“        |

> ğŸ’¡ **ç»™ Python å·¥ç¨‹å¸ˆçš„æç¤º**ï¼š
> è¿™ç±»ä¼¼äº Python çš„ `threading.Thread`ï¼Œä½† C++ æ›´æ¥è¿‘ç³»ç»Ÿåº•å±‚ï¼Œæ²¡æœ‰ GILï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰ï¼Œå› æ­¤çœŸæ­£æ”¯æŒå¤šæ ¸å¹¶è¡Œï¼è¿™æ˜¯æ€§èƒ½ä¼˜åŠ¿æ‰€åœ¨ã€‚

# ç†è§£

## joinçš„ä½œç”¨

### å¸¸è§è¯¯è§£æ¾„æ¸…


| è¯¯è§£                              | æ­£ç¡®äº‹å®                                                                          |
| --------------------------------- | --------------------------------------------------------------------------------- |
| `join()` æ˜¯â€œå¼€å§‹è¿è¡Œâ€çº¿ç¨‹       | âŒ`join()` æ˜¯â€œç­‰å¾…çº¿ç¨‹ç»“æŸâ€                                                     |
| ä¸è°ƒç”¨`join()` çº¿ç¨‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œå®Œ | âŒ å¦‚æœä¸`join()` æˆ– `detach()`ï¼Œç¨‹åºä¼šåœ¨ `thread` ææ„æ—¶å´©æºƒï¼ˆ`std::terminate`ï¼‰ |
| `join()` ä¼šè®©çº¿ç¨‹æ›´å¿«å®Œæˆ         | âŒ`join()` åªæ˜¯ç­‰å¾…ï¼Œä¸å½±å“ç›®æ ‡çº¿ç¨‹é€Ÿåº¦                                           |

---

### âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> **`std::thread` æ„é€ æ—¶ â†’ çº¿ç¨‹å¯åŠ¨å¹¶å¼€å§‹è¿è¡Œ**
> **`.join()` è°ƒç”¨æ—¶ â†’ å½“å‰çº¿ç¨‹åœä¸‹æ¥ç­‰å®ƒè·‘å®Œ**
>
> * `join()` ä¸æ˜¯â€œå¯åŠ¨â€ï¼Œè€Œæ˜¯â€œåŒæ­¥ç­‰å¾…â€ã€‚
> * å¤šçº¿ç¨‹çš„å¹¶å‘æ€§ä½“ç°åœ¨ï¼š**ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä»åˆ›å»ºé‚£ä¸€åˆ»èµ·å°±åœ¨åŒæ—¶è¿è¡Œ**ã€‚

## é¡ºåº

### ä¸æ˜¯æŒ‰ç…§åˆ›å»ºé¡ºåº

ä¸ºä»€ä¹ˆæ‰§è¡Œé¡ºåºä¸æ˜¯æŒ‰åˆ›å»ºé¡ºåºï¼Ÿ
è™½ç„¶çº¿ç¨‹åˆ›å»ºåä¼šç«‹å³è¢«åŠ å…¥åˆ°ç³»ç»Ÿçš„å°±ç»ªé˜Ÿåˆ—ï¼Œä½† çº¿ç¨‹çš„å®é™…æ‰§è¡Œé¡ºåºæ˜¯ç”±æ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨å†³å®šçš„ ï¼Œè€Œä¸æ˜¯ç”±åˆ›å»ºé¡ºåºå†³å®šçš„ã€‚è¿™å¯¼è‡´äº†å‡ ä¸ªé‡è¦ç‰¹æ€§ï¼š

1. ä¸ç¡®å®šæ€§ï¼ˆNondeterminismï¼‰ ï¼šæ¯æ¬¡è¿è¡Œç¨‹åºï¼Œçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºå¯èƒ½éƒ½ä¸åŒ
2. æŠ¢å å¼è°ƒåº¦ ï¼šé«˜ä¼˜å…ˆçº§çº¿ç¨‹å¯èƒ½ä¼šæ‰“æ–­ä½ä¼˜å…ˆçº§çº¿ç¨‹çš„æ‰§è¡Œ
3. å¹¶è¡Œæ‰§è¡Œ ï¼šå¦‚æœç³»ç»Ÿæœ‰å¤šä¸ªCPUæ ¸å¿ƒï¼Œå¤šä¸ªçº¿ç¨‹ä¼šçœŸæ­£åŒæ—¶æ‰§è¡Œ ä¸ºä»€ä¹ˆincrement_counterå…ˆæ‰“å°ï¼Ÿ
   åœ¨ä½ è§‚å¯Ÿåˆ°çš„è¾“å‡ºä¸­ï¼Œ increment_counter å…ˆæ‰“å°ï¼Œç„¶åæ˜¯ lambda_task ï¼Œæœ€åæ‰æ˜¯ print_hello ï¼Œè¿™å¯èƒ½æœ‰å‡ ä¸ªåŸå› ï¼š
4. çº¿ç¨‹åˆ›å»ºå¼€é”€ ï¼š print_hello çº¿ç¨‹è™½ç„¶å…ˆåˆ›å»ºï¼Œä½†å¯èƒ½éœ€è¦æ›´å¤šçš„åˆå§‹åŒ–å¼€é”€
5. å‡½æ•°æ‰§è¡Œé€Ÿåº¦ ï¼š increment_counter å‡½æ•°å¯èƒ½æ¯” print_hello æ‰§è¡Œå¾—æ›´å¿«
6. è°ƒåº¦å™¨å†³ç­– ï¼šæ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨å¯èƒ½åŸºäºå½“å‰ç³»ç»Ÿè´Ÿè½½å’Œçº¿ç¨‹ä¼˜å…ˆçº§åšå‡ºäº†è¿™æ ·çš„è°ƒåº¦å†³ç­–
7. é”çš„å½±å“ ï¼š increment_counter ä¸­æœ‰äº’æ–¥é”ï¼Œä½†åˆå§‹é˜¶æ®µé”ç«äº‰ä¸æ¿€çƒˆ

### å¤šçº¿ç¨‹çš„æ‰§è¡Œé¡ºåº

ä½†çº¿ç¨‹ä½•æ—¶å¼€å§‹æ‰§è¡Œå®Œå…¨ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚å¯èƒ½å‘ç”Ÿçš„æƒ…å†µæ˜¯ï¼š

- å³ä½¿ä½ å…ˆåˆ›å»ºäº† print_hello çº¿ç¨‹ï¼Œå®ƒå¯èƒ½è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œè¾“å‡ºè¯­å¥ï¼Œå°±è¢«æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨æŒ‚èµ·äº†
- è€Œä¹‹ååˆ›å»ºçš„ increment_counter çº¿ç¨‹å¯èƒ½å¾ˆå¿«è·å¾—äº†CPUæ—¶é—´ç‰‡å¹¶æ‰§è¡Œäº†è¾“å‡º
- lambda_task çº¿ç¨‹ä¹Ÿå¯èƒ½åœ¨ä¸åŒçš„æ—¶é—´ç‚¹è¢«è°ƒåº¦æ‰§è¡Œ å¦‚ä½•æ§åˆ¶çº¿ç¨‹æ‰§è¡Œé¡ºåºï¼Ÿ
  å¦‚æœä½ éœ€è¦çº¿ç¨‹æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œæœ‰å‡ ç§æ–¹æ³•ï¼š

1. ä½¿ç”¨ åŒæ­¥åŸè¯­ ï¼šå¦‚äº’æ–¥é”ã€æ¡ä»¶å˜é‡ã€ä¿¡å·é‡ç­‰
2. ä½¿ç”¨ join() ï¼šåœ¨å…³é”®ç‚¹ç­‰å¾…ç‰¹å®šçº¿ç¨‹å®Œæˆ
3. ä½¿ç”¨ åŸå­æ“ä½œ ï¼šæ§åˆ¶æ‰§è¡Œé¡ºåºçš„æ ‡å¿—ä½
   ä½†æ˜¯ï¼Œåœ¨å¤§å¤šæ•°å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹çš„å¹¶è¡Œæ€§ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶é¡ºåºæ‰§è¡Œã€‚

æ€»ç»“ï¼šçº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œç”±æ“ä½œç³»ç»Ÿè°ƒåº¦å™¨å†³å®šï¼Œè¿™æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹çš„åŸºæœ¬ç‰¹æ€§ä¹‹ä¸€ã€‚æ¯æ¬¡è¿è¡Œç¨‹åºéƒ½å¯èƒ½çœ‹åˆ°ä¸åŒçš„æ‰§è¡Œé¡ºåºï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚

## emplace\_backçš„ä½¿ç”¨

`emplace_back` æ˜¯ç°ä»£ C++ ä¸­æ¨èä½¿ç”¨çš„å®¹å™¨æ’å…¥æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†åƒ `std::thread` è¿™æ ·çš„å¤æ‚å¯¹è±¡æ—¶ã€‚ä¸‹é¢æˆ‘ä»¬ä»**ä¸ºä»€ä¹ˆç”¨å®ƒã€å®ƒå’Œ `push_back` æœ‰ä»€ä¹ˆåŒºåˆ«ã€ä»¥åŠæ€§èƒ½å’Œå®‰å…¨ä¸Šçš„ä¼˜åŠ¿**æ¥å½»åº•è®²æ¸…æ¥šã€‚

## ä¸€ã€å…ˆçœ‹å¯¹æ¯”ï¼š`push_back` vs `emplace_back`

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª `std::vector<std::thread>`ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]" data-spm-anchor-id="5176.28103460.0.i84.228c2e31FrabiA"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>std</span><span>::</span><span>vector</span><span><</span><span>std</span><span>::thread> threads;</span></code></pre></div></div></pre>

### âŒ æ–¹æ³•1ï¼šä½¿ç”¨ `push_back`ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// æ­¥éª¤1ï¼šæ„é€ ä¸€ä¸ªä¸´æ—¶ thread å¯¹è±¡ï¼ˆå¯åŠ¨çº¿ç¨‹ï¼‰</span><span>
</span><span></span>std::thread temp(print_hello, 1)<span>;
</span>
<span></span><span>// æ­¥éª¤2ï¼šå°† temp ç§»åŠ¨åˆ° vector ä¸­</span><span>
</span><span>threads.push_back(</span><span>std</span><span>::move(temp));</span></code></pre></div></div></pre>

æˆ–è€…æ›´ç®€æ´åœ°å†™æˆä¸€è¡Œï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>threads.push_back(</span><span>std</span><span>::thread(print_hello, </span>1<span>)); </span><span>// å³å€¼ï¼Œè‡ªåŠ¨ç§»åŠ¨</span></code></pre></div></div></pre>

### âœ… æ–¹æ³•2ï¼šä½¿ç”¨ `emplace_back`ï¼ˆç°ä»£ C++ æ¨èï¼‰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>threads.emplace_back(print_hello, 1);</span></code></pre></div></div></pre>

## äºŒã€å…³é”®åŒºåˆ«ï¼šæ„é€ å‘ç”Ÿåœ¨å“ªé‡Œï¼Ÿ


| æ–¹æ³•                          | æ„é€ è¿‡ç¨‹                                                        |
| ----------------------------- | --------------------------------------------------------------- |
| `push_back(std::thread(...))` | å…ˆåœ¨â€œå¤–é¢â€æ„é€ ä¸´æ—¶å¯¹è±¡ â†’ ç„¶å\*\*ç§»åŠ¨ï¼ˆmoveï¼‰\*\*è¿› vector   |
| `emplace_back(args...)`       | ç›´æ¥åœ¨ vector çš„å†…å­˜ç©ºé—´ä¸­**åŸåœ°æ„é€ ï¼ˆin-place constructionï¼‰** |

ğŸ‘‰ æ¢å¥è¯è¯´ï¼š

> * `push_back`ï¼šå…ˆé€ å¥½å†æ¬è¿›å»
> * `emplace_back`ï¼šç›´æ¥åœ¨ç°åœºæ­å»ºï¼Œä¸æ¬å®¶

## ä¸‰ã€ä¸ºä»€ä¹ˆæ¨è `emplace_back`ï¼Ÿä¸‰å¤§ä¼˜åŠ¿

### âœ… 1. **æ€§èƒ½æ›´é«˜ï¼šé¿å…ä¸å¿…è¦çš„ç§»åŠ¨æˆ–æ‹·è´**

* `std::thread` æ˜¯**ä¸å¯å¤åˆ¶**çš„ï¼ˆæ²¡æœ‰æ‹·è´æ„é€ å‡½æ•°ï¼‰ï¼Œåªèƒ½**ç§»åŠ¨**ã€‚
* è™½ç„¶ `push_back(std::move(t))` æˆ– `push_back(std::thread(...))` å¯ä»¥å·¥ä½œï¼Œä½†å®ƒä»ç„¶æ¶‰åŠä¸€æ¬¡â€œç§»åŠ¨â€æ“ä½œã€‚
* è€Œ `emplace_back` æ ¹æœ¬ä¸éœ€è¦ç§»åŠ¨ â€”â€” å®ƒç›´æ¥åœ¨å®¹å™¨å†…éƒ¨æ„é€ å¯¹è±¡ï¼Œ**é›¶å¼€é”€**ã€‚

#### ğŸ’¡ ç±»æ¯”ç†è§£ï¼ˆPython å·¥ç¨‹å¸ˆè§†è§’ï¼‰ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">python</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span># push_back å°±åƒï¼š</span><span>
</span><span>temp = Thread(target=task, args=(</span>1<span>,))
</span><span>threads.append(temp)  </span><span># æŠŠåšå¥½çš„ä¸œè¥¿æ”¾è¿›å»</span><span>
</span>
<span></span><span># emplace_back æ›´åƒï¼š</span><span>
</span><span>threads.append_new(target=task, args=(</span>1<span>,))  </span><span># ç›´æ¥åœ¨é‡Œé¢åˆ›å»º</span></code></pre></div></div></pre>

---

### âœ… 2. **è¯­æ³•æ›´ç®€æ´ã€æ›´ç›´è§‚**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// å†—é•¿</span><span>
</span><span>threads.push_back(</span><span>std</span><span>::thread(print_hello, </span>1<span>));
</span>
<span></span><span>// ç®€æ´æ¸…æ™°</span><span>
</span><span>threads.emplace_back(print_hello, </span>1<span>);</span></code></pre></div></div></pre>

å‚æ•°ç›´æ¥è½¬å‘ç»™ `std::thread` çš„æ„é€ å‡½æ•°ï¼Œæ— éœ€åŒ…è£…æˆä¸´æ—¶å¯¹è±¡ã€‚

---

### âœ… 3. **ç±»å‹æ¨å¯¼æ›´å®‰å…¨ï¼Œæ”¯æŒå®Œç¾è½¬å‘**

`emplace_back` ä½¿ç”¨**å®Œç¾è½¬å‘ï¼ˆperfect forwardingï¼‰**ï¼Œèƒ½æŠŠä½ çš„å‚æ•°åŸå°ä¸åŠ¨åœ°ä¼ ç»™ç›®æ ‡ç±»å‹çš„æ„é€ å‡½æ•°ã€‚

è¿™å¯¹äºå¸¦æœ‰å¼•ç”¨ã€å³å€¼å¼•ç”¨çš„å¤æ‚ç±»å‹ç‰¹åˆ«é‡è¦ã€‚

#### ğŸŒ° ä¾‹å­ï¼šä¼ é€’å¼•ç”¨éœ€è¦ `std::ref`

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>int</span><span> counter = </span>0<span>;
</span>
<span></span><span>// âŒ é”™è¯¯ï¼šæ™®é€šä¼ å‚ä¼šè¢«å¤åˆ¶</span><span>
</span><span></span><span>// threads.push_back(std::thread(increment, counter)); // counter æ˜¯å‰¯æœ¬ï¼</span><span>
</span>
<span></span><span>// âœ… æ­£ç¡®åšæ³•ï¼šç”¨ std::ref ä¼ å¼•ç”¨</span><span>
</span><span>threads.emplace_back(increment, </span><span>std</span><span>::ref(counter)); </span><span>// å‚æ•°ç›´æ¥è½¬å‘ï¼Œæ”¯æŒ ref</span></code></pre></div></div></pre>

`emplace_back` èƒ½æ­£ç¡®å¤„ç† `std::ref(counter)` å¹¶å°†å…¶å®Œç¾è½¬å‘ç»™ `std::thread` æ„é€ å‡½æ•°ã€‚



## å››ã€ä»€ä¹ˆæ—¶å€™ä¸èƒ½ç”¨ `emplace_back`ï¼Ÿ

è™½ç„¶ `emplace_back` å¾ˆå¥½ï¼Œä½†ä¹Ÿæœ‰å°‘æ•°æƒ…å†µè¦å°å¿ƒï¼š


| åœºæ™¯                               | è¯´æ˜                                                     |
| ---------------------------------- | -------------------------------------------------------- |
| å®¹å™¨å·²æœ‰ç›¸åŒå…ƒç´ ï¼ˆå¦‚`set`, `map`ï¼‰ | `emplace` å¯èƒ½å› æ’å…¥å¤±è´¥è€Œå¿½ç•¥æ„é€ ï¼Œéœ€æ£€æŸ¥è¿”å›å€¼         |
| å‚æ•°æ­§ä¹‰å¯¼è‡´é”™è¯¯æ¨å¯¼               | æå°‘æ•°æƒ…å†µä¸‹æ¨¡æ¿æ¨å¯¼å‡ºé”™ï¼Œå¯ç”¨`push_back` + æ˜¾å¼æ„é€ å›é¿ |
| éœ€è¦é¢„å…ˆåˆ¤æ–­æ˜¯å¦æ„é€                | å¦‚æœä½ æƒ³â€œå…ˆæ„é€ å†å†³å®šè¦ä¸è¦åŠ â€ï¼Œå°±ä¸èƒ½ç”¨`emplace_back` |

ä½†åœ¨ `std::vector<std::thread>` è¿™ç§åœºæ™¯ä¸‹ï¼Œ**`emplace_back` æ˜¯æœ€ä½³é€‰æ‹©**ã€‚



## äº”ã€æ€»ç»“ï¼šä¸ºä»€ä¹ˆè¦ç”¨ `threads.emplace_back(...)`ï¼Ÿ


| åŸå›                 | è¯´æ˜                                        |
| ------------------- | ------------------------------------------- |
| âœ…**é«˜æ•ˆ**          | é¿å…ç§»åŠ¨å¼€é”€ï¼Œç›´æ¥åœ¨å®¹å™¨å†…æ„é€               |
| âœ…**ç®€æ´**          | å°‘å†™`std::thread(...)` å’Œ `std::move`       |
| âœ…**å®‰å…¨**          | æ”¯æŒ`std::ref`ã€lambda ç­‰å¤æ‚å‚æ•°çš„å®Œç¾è½¬å‘ |
| âœ…**ç°ä»£ C++ é£æ ¼** | æ˜¯ C++11 åæ¨èçš„æƒ¯ç”¨æ³•ï¼ˆidiomatic C++ï¼‰    |
| âœ…**è¯­ä¹‰æ¸…æ™°**      | â€œæˆ‘è¦åœ¨è¿™é‡Œæ„é€ ä¸€ä¸ªæ–°å¯¹è±¡â€                |

---

## ğŸ“ æœ€ä½³å®è·µå»ºè®®

âœ… åœ¨ä»¥ä¸‹æƒ…å†µä¼˜å…ˆä½¿ç”¨ `emplace_back`ï¼š

* æ’å…¥ä¸å¯å¤åˆ¶çš„å¯¹è±¡ï¼ˆå¦‚ `std::thread`, `std::unique_ptr`ï¼‰
* æ’å…¥å¤§å‹å¯¹è±¡ï¼ˆé¿å…æ‹·è´/ç§»åŠ¨ï¼‰
* æƒ³ç®€åŒ–ä»£ç ã€æé«˜å¯è¯»æ€§

ğŸš« é¿å…åœ¨æœ‰æ­§ä¹‰æˆ–éœ€è¦æ§åˆ¶ç”Ÿå‘½å‘¨æœŸçš„å¤æ‚é€»è¾‘ä¸­ç›²ç›®æ›¿æ¢ã€‚

---

### âœ… ç»“è®ºä¸€å¥è¯ï¼š

> **`threads.emplace_back(func, args...)` ä¸ä»…ä¼šè®©çº¿ç¨‹ç«‹å³è¿è¡Œï¼ˆå› ä¸ºæ„é€ äº† `std::thread`ï¼‰ï¼Œè€Œä¸”æ˜¯ä»¥æœ€é«˜æ•ˆã€æœ€ç°ä»£çš„æ–¹å¼æŠŠå®ƒæ”¾è¿›å®¹å™¨ä¸­ã€‚**
>
