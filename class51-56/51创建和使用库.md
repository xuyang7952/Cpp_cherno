# **C++ 中创建与使用库**

## 一、核心目标

在大型 C++ 项目中，将通用代码（如引擎、工具类、数学库等）封装成独立的 **库（Library）**，供多个项目复用。这不仅能提高代码模块化程度，还能实现跨项目共享和混合语言开发。

本文以创建一个名为 `Engine` 的静态库，并在 `Game` 可执行项目中使用它为例。


## 二、创建与使用库的步骤

### ✅ 第一步：添加多个项目（Multiple Projects）

1. **创建主项目（如 Game）**
   * 使用 Visual Studio 创建一个常规的 C++ 可执行项目（`.exe`），命名为 `Game`。
   * 确保其配置类型为 **"Application (.exe)"**。
2. **添加库项目（如 Engine）**
   * 在解决方案（Solution）上右键 → **"Add" → "New Project"**。
   * 创建一个新的 **Static Library** 项目，命名为 `Engine`。
   * 注意**Engine文件夹是在Game文件夹里的**
   * 确保其配置类型为 **"Static Library (.lib)"**。
3. **项目结构示例**
   <pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>Solution (Game.sln)
   </span>├── Game (Executable)
   <span>└── Engine (</span><span>Static</span><span> Library)
   </span>    ├── src/Engine.cpp
   <span>    └── </span><span>include</span><span>/Engine.h</span></code></pre></div></div></pre>


### 第二步：配置头文件包含路径（Include Paths）

为了让 `Game` 项目能正确包含 `Engine` 的头文件，应避免使用**相对路径**（易因文件移动出错），而使用**绝对包含路径**。

#### ❌ 错误方式（相对路径）：

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span>"../../Engine/src/Engine.h"</code></pre></div></div></pre>

> 一旦项目结构调整，路径就会失效。

#### ✅ 正确方式（使用编译器包含目录）：

1. 在 `Game` 项目上右键 → **Properties** → **C/C++** → **General** → **Additional Include Directories**。
2. 添加 `Engine` 项目的头文件目录路径，例如：
   <pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>$(SolutionDir)Engine\include</span></code></pre></div></div></pre>
3. 之后即可使用简洁的包含方式：
   <pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span>"Engine.h"</code></pre></div></div></pre>


### 第三步：链接库文件（Linking）

Visual Studio 提供了便捷的项目依赖管理功能，无需手动指定 `.lib` 文件路径。

1. **添加项目引用（Add Reference）**

   * 在 `Game` 项目上右键 → **"Add" → "Reference"**。
   * 勾选 `Engine` 项目，点击 **OK**。
2. **自动链接机制**

   * VS 会自动将 `Engine.lib` 添加到 `Game` 的链接输入中。
   * 构建 `Game` 时，会自动先构建 `Engine`，生成 `Engine.lib`，再链接到 `Game.exe`。
3. **验证构建顺序** 执行 **Clean Solution** 后再构建 `Game`，输出日志应显示：

   <pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>1></span><span class="bash">------ Build started: Project: Engine, Configuration: Debug x64 ------</span><span>
   </span><span></span><span>1></span><span class="bash">Engine.vcxproj -> ...Engine.lib</span><span>
   </span><span></span><span>2></span><span class="bash">------ Build started: Project: Game, Configuration: Debug x64 ------</span><span>
   </span><span></span><span>2></span><span class="bash">Game.vcxproj -> ...Game.exe</span></code></pre></div></div></pre>

   > 这表明 `Game` 依赖于 `Engine`，构建顺序正确。
   >

---

## 🧩 三、代码使用示例

假设 `Engine.h` 定义了一个简单的函数：

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// Engine.h</span><span>
</span><span></span><span>#</span>pragma<span> once</span><span>
</span><span></span><span>namespace</span><span> engine {
</span><span>    </span>void PrintMessage()<span>;
</span>}</code></pre></div></div></pre>

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// Engine.cpp</span><span>
</span><span></span><span>#</span>include<span> </span>"Engine.h"<span>
</span><span></span><span>#</span>include<span> </span><iostream><span>
</span>
<span></span><span>namespace</span><span> engine {
</span><span>    </span>void PrintMessage() <span>{
</span><span>        </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Hello from Engine!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>    }
}</code></pre></div></div></pre>

在 `Game` 项目中调用：

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// Application.cpp</span><span>
</span><span></span><span>#</span>include<span> </span>"Engine.h"<span>
</span>
<span></span>int main() <span>{
</span><span>    engine::PrintMessage();  </span><span>// 调用库函数</span><span>
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>


## 四、关键优势总结


| 优势             | 说明                                                 |
| ---------------- | ---------------------------------------------------- |
| **模块化**       | 将通用功能封装为独立库，便于维护和升级。             |
| **代码复用**     | 多个项目可共享同一个库，避免重复代码。               |
| **自动构建依赖** | 通过“项目引用”，VS 自动处理构建顺序和链接。        |
| **避免路径问题** | 使用包含目录而非相对路径，提升项目可移植性。         |
| **静态链接**     | 库代码在编译时被嵌入可执行文件，无需额外分发`.dll`。 |

---

## 📝 五、总结

在 Visual Studio 中创建和使用 C++ 库（特别是静态库）的核心流程如下：

1. **创建多项目解决方案**：一个可执行项目（`.exe`）和一个静态库项目（`.lib`）。
2. **配置包含路径**：使用“附加包含目录”让主项目能找到库的头文件。
3. **添加项目引用**：通过“Add Reference”建立依赖关系，实现自动链接。
4. **享受自动构建**：修改库代码后，构建主项目会自动重新编译库并链接。

> 💡 **提示**：这种方法特别适用于游戏引擎、工具库、数学库等需要跨项目复用的场景。掌握此技能是迈向大型 C++ 项目开发的重要一步。
>
