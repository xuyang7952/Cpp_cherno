# **C++ 宏（Macros）**


## 一、什么是宏（Macros）？

在 C++ 中，**宏（Macro）** 是由预处理器（Preprocessor）处理的指令，它在编译之前对源代码进行**文本替换**。你可以把它理解为“在编译前执行的查找和替换操作”。

* 宏以 `#` 开头，如 `#define`, `#ifdef`, `#endif`
* 它发生在真正的编译之前，属于**预处理阶段**
* 宏不是 C++ 语言的一部分，而是预处理器的语法

> 💡 **核心思想**：用简单的符号或表达式，在编译前替换为更复杂的代码。



## 二、宏的基本用法

### 1️⃣ 简单宏定义（常量）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>define<span> PI 3.14159</span><span>
</span><span></span><span>#</span>define<span> MAX_SIZE 100</span></code></pre></div></div></pre>

使用时，预处理器会将所有 `PI` 替换为 `3.14159`。

### 2️⃣ 带参数的宏（宏函数）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>define<span> SQUARE(x) ((x) * (x))</span></code></pre></div></div></pre>

注意括号很重要，防止运算符优先级问题。


## 三、宏的实用场景（来自网页内容）

### 场景 1：调试日志控制（Debug vs Release）

这是宏最实用的用途之一：**在 Debug 版本中启用日志，Release 版本中自动移除**。

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// 根据编译模式决定是否输出日志</span><span>
</span><span></span><span>#</span>ifdef<span> PR_DEBUG</span><span>
</span><span>    </span><span>#</span>define<span> LOG(x) std::cout << x << std::endl;</span><span>
</span><span></span><span>#</span>else<span>
</span><span>    </span><span>#</span>define<span> LOG(x)</span><span>
</span><span></span><span>#</span>endif</code></pre></div></div></pre>

#### 完整可运行代码：

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]" data-spm-anchor-id="5176.28103460.0.i22.49f02e31fLl1zp"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class="" data-spm-anchor-id="5176.28103460.0.i21.49f02e31fLl1zp"><use xlink:href="#appicon-copy-line" data-spm-anchor-id="5176.28103460.0.i23.49f02e31fLl1zp"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><iostream><span>
</span>
<span></span><span>// 模拟编译器定义（实际中通过编译选项设置）</span><span>
</span><span></span><span>#</span>define<span> PR_DEBUG 1</span><span>
</span>
<span></span><span>#</span>if<span> PR_DEBUG == 1</span><span>
</span><span>    </span><span>#</span>define<span> LOG(x) std::cout << </span>"[DEBUG] "<span> << x << std::endl;</span><span>
</span><span></span><span>#</span>elif<span> defined(PR_RELEASE)</span><span>
</span><span>    </span><span>#</span>define<span> LOG(x)</span><span>
</span><span></span><span>#</span>else<span>
</span><span>    </span><span>#</span>define<span> LOG(x)</span><span>
</span><span></span><span>#</span>endif<span>
</span>
<span></span>int main() <span>{
</span><span>    LOG(</span><span>"程序启动"</span><span>);
</span><span>    </span><span>int</span><span> value = </span>42<span>;
</span><span>    LOG(</span><span>"当前值: "</span><span> << value);
</span><span>    LOG(</span><span>"程序结束"</span><span>);
</span>
<span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

> 🔁 如果你把 `#define PR_DEBUG 1` 改成 `#define PR_DEBUG 0`，所有 `LOG` 语句都会被替换成空，相当于删除了日志代码，**零运行时开销**。

---

### 场景 2：跨平台代码切换

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>ifdef<span> _WIN32</span><span>
</span><span>    </span><span>#</span>define<span> PLATFORM </span>"Windows"<span>
</span><span></span><span>#</span>elif<span> defined(__linux__)</span><span>
</span><span>    </span><span>#</span>define<span> PLATFORM </span>"Linux"<span>
</span><span></span><span>#</span>else<span>
</span><span>    </span><span>#</span>define<span> PLATFORM </span>"Unknown"<span>
</span><span></span><span>#</span>endif<span>
</span>
<span>LOG(</span><span>"运行平台: "</span><span> << PLATFORM);</span></code></pre></div></div></pre>

---

### 场景 3：简化重复代码

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>define<span> WAIT std::cin.get()</span><span>
</span>
<span></span>int main() <span>{
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"按回车键继续..."</span><span>;
</span><span>    WAIT; </span><span>// 实际被替换为 std::cin.get();</span><span>
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

> ⚠️ 注意：虽然可以这么做，但作者认为这“很愚蠢”，只是为了理解预处理机制。




## 四、宏的特殊用法

### 1️⃣ 多行宏（使用 `\` 续行）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#define LOG_INFO(x, y) \</span><span>
</span><span>    std::cout << </span><span>"File: "</span><span> << </span><span>__FILE__</span><span> << </span><span>", "</span><span> \
</span><span>              << </span><span>"Line: "</span><span> << </span><span>__LINE__</span><span> << </span><span>", "</span><span> \
</span><span>              << </span><span>"Var "</span><span> << </span><span>#x << " = " << x << ", " \</span><span>
</span><span>              << </span><span>"Func: "</span><span> << y << std::endl
</span>
<span></span><span>int</span><span> main() {
</span><span>    </span><span>int</span><span> age = </span>25<span>;
</span><span>    LOG_INFO(age, </span><span>"main"</span><span>);
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

> 🔍 输出示例：
>
> <pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>File: main.cpp, Line: </span>10<span>, </span><span>Var</span><span> age = </span>25<span>, Func: main</span></code></pre></div></div></pre>

* `__FILE__` 和 `__LINE__` 是预定义宏
* `#x` 表示将参数 `x` 转为字符串（字符串化）

---

### 2️⃣ 字符串化（Stringification）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>define<span> STR(x) #x</span><span>
</span><span></span><span>#</span>define<span> CONCAT(a, b) a ## b  </span><span>// 连接两个符号</span><span>
</span>
<span></span>int main() <span>{
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << STR(Hello World) << </span><span>std</span><span>::</span><span>endl</span><span>; </span><span>// 输出: Hello World</span><span>
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>




## 六、宏的缺点与注意事项


| 缺点                   | 说明                                             |
| ---------------------- | ------------------------------------------------ |
| **没有类型检查**       | 宏是纯文本替换，不会检查类型错误                 |
| **调试困难**           | 编译器看到的是替换后的代码，报错可能指向错误位置 |
| **作用域混乱**         | 宏是全局的，容易命名冲突                         |
| **容易出错**           | 如`SQUARE(x)` 忘记括号会导致优先级错误           |
| **过度使用降低可读性** | 代码像“魔法”，难以理解                         |

> 💬 **Cherno 的观点**： “不要滥用宏。用太多特性不代表你厉害。写清晰、可维护的代码才是好代码。”
>

## 五、完整可运行代码（包含所有示例）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><iostream><span>
</span>
<span></span><span>// ==================== 1. 调试日志宏 ====================</span><span>
</span><span></span><span>#</span>define<span> PR_DEBUG 1</span><span>
</span>
<span></span><span>#</span>if<span> PR_DEBUG == 1</span><span>
</span><span>    </span><span>#</span>define<span> LOG(x) std::cout << </span>"[DEBUG] "<span> << x << std::endl;</span><span>
</span><span></span><span>#</span>elif<span> defined(PR_RELEASE)</span><span>
</span><span>    </span><span>#</span>define<span> LOG(x)</span><span>
</span><span></span><span>#</span>else<span>
</span><span>    </span><span>#</span>define<span> LOG(x)</span><span>
</span><span></span><span>#</span>endif<span>
</span>
<span></span><span>// ==================== 2. 多行日志宏 ====================</span><span>
</span><span></span><span>#</span>define<span> LOG_INFO(x, func) \
</span><span>    std::cout << </span>"File: "<span> << __FILE__ << </span>", "<span> \
</span><span>              << </span>"Line: "<span> << __LINE__ << </span>", "<span> \
</span><span>              << </span>"Var "<span> << #x << </span>" = "<span> << x << </span>", "<span> \
</span><span>              << </span>"Func: "<span> << func << std::endl</span><span>
</span>
<span></span><span>// ==================== 3. 简单宏 ====================</span><span>
</span><span></span><span>#</span>define<span> PI 3.14159</span><span>
</span><span></span><span>#</span>define<span> SQUARE(x) ((x) * (x))</span><span>
</span>
<span></span><span>// ==================== 4. 平台检测 ====================</span><span>
</span><span></span><span>#</span>ifdef<span> _WIN32</span><span>
</span><span>    </span><span>#</span>define<span> PLATFORM </span>"Windows"<span>
</span><span></span><span>#</span>elif<span> defined(__linux__)</span><span>
</span><span>    </span><span>#</span>define<span> PLATFORM </span>"Linux"<span>
</span><span></span><span>#</span>elif<span> defined(__APPLE__)</span><span>
</span><span>    </span><span>#</span>define<span> PLATFORM </span>"macOS"<span>
</span><span></span><span>#</span>else<span>
</span><span>    </span><span>#</span>define<span> PLATFORM </span>"Unknown"<span>
</span><span></span><span>#</span>endif<span>
</span>
<span></span><span>// ==================== 主函数测试 ====================</span><span>
</span><span></span>int main() <span>{
</span><span>    LOG(</span><span>"程序开始"</span><span>);
</span>
<span>    </span><span>double</span><span> radius = </span>5.0<span>;
</span><span>    </span><span>double</span><span> area = PI * SQUARE(radius);
</span><span>    LOG(</span><span>"圆面积: "</span><span> << area);
</span>
<span>    </span><span>int</span><span> value = </span>42<span>;
</span><span>    LOG_INFO(value, </span><span>"main"</span><span>);
</span>
<span>    LOG(</span><span>"运行平台: "</span><span> << PLATFORM);
</span>
<span>    LOG(</span><span>"程序结束"</span><span>);
</span><span>    </span><span>return</span><span> </span>0<span>;</span></code></pre></div></div></pre>


## 七、现代 C++ 替代方案

对于很多宏的用途，现代 C++ 提供了更安全的替代：


| 宏用途                               | 推荐替代方案                                   |
| ------------------------------------ | ---------------------------------------------- |
| `#define PI 3.14`                    | `constexpr double PI = 3.14;`                  |
| `#define MAX(a,b) ((a)>(b)?(a):(b))` | `std::max(a, b)` 或 `constexpr` 函数           |
| `LOG(x)`                             | 内联函数 + 条件编译，或使用日志库（如 spdlog） |


## 八、总结


| 特性         | 说明                                           |
| ------------ | ---------------------------------------------- |
| **本质**     | 预处理器的文本替换                             |
| **时机**     | 编译前                                         |
| **优点**     | 零开销、条件编译、代码生成                     |
| **缺点**     | 无类型检查、难调试、易误用                     |
| **最佳实践** | 仅用于条件编译（如 Debug/Release）、跨平台切换 |
