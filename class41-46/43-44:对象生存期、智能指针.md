# C++ å¯¹è±¡ç”Ÿå­˜æœŸï¼ˆæ ˆä½œç”¨åŸŸç”Ÿå­˜æœŸï¼‰å…¨é¢æ€»ç»“

### ä¸€ã€æ ¸å¿ƒæ¦‚å¿µï¼ˆå›¾ç‰‡1ã€2ï¼‰

#### 1. **æ ˆä½œç”¨åŸŸç”Ÿå­˜æœŸçš„æœ¬è´¨**

* **ç±»æ¯”**ï¼šå°±åƒæŠŠä¹¦æ”¾åˆ°ä¹¦æ¶ä¸Šï¼Œä½œç”¨åŸŸç»“æŸæ—¶ä¹¦è¢«æ‰”æ‰ï¼ˆå›¾ç‰‡1çš„ä¹¦ç±æ¯”å–»ï¼‰
* **è‡ªåŠ¨ç®¡ç†**ï¼šæ ˆä¸Šå¯¹è±¡åœ¨ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨é”€æ¯
* **ç¡®å®šæ€§**ï¼šç”Ÿå­˜æœŸå®Œå…¨ç”±ä»£ç ç»“æ„å†³å®šï¼Œå¯é¢„æµ‹

#### 2. **åŸºæœ¬ç¤ºä¾‹ï¼ˆå›¾ç‰‡1ä»£ç ï¼‰**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class Entity {
public:
    Entity() { std::cout << "Created Entity\n"; }
    ~Entity() { std::cout << "Destroyed Entity\n"; }
};

int main() {
    { // å¼€å§‹ä½œç”¨åŸŸ
        Entity e;  // æ ˆä¸Šåˆ›å»º
    } // ç»“æŸä½œç”¨åŸŸï¼Œeè‡ªåŠ¨é”€æ¯
  
    return 0;
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

**è¾“å‡º**ï¼š

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-markdown">Created Entity
Destroyed Entity</code></div></div></pre></div></pre>

## äºŒã€å¸¸è§é—®é¢˜ä¸é™·é˜±ï¼ˆå›¾ç‰‡2ã€3ï¼‰

### 1. **è¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆçš„é”™è¯¯ï¼ˆå›¾ç‰‡2ï¼‰**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">// âŒ é”™è¯¯ç¤ºä¾‹
int* CreateArray() {
    int array[50];  // æ ˆä¸Šåˆ†é…
    return array;   // è¿”å›æŒ‡å‘å³å°†é”€æ¯å†…å­˜çš„æŒ‡é’ˆï¼
}

int main() {
    int* a = CreateArray();  // æ‚¬ç©ºæŒ‡é’ˆï¼
    // aæŒ‡å‘çš„å†…å­˜å·²è¢«é‡Šæ”¾
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 2. **æ­£ç¡®è§£å†³æ–¹æ¡ˆï¼ˆå›¾ç‰‡3ï¼‰**

#### æ–¹æ¡ˆAï¼šå †ä¸Šåˆ†é…

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">int* CreateArray() {
    int* array = new int[50];  // å †ä¸Šåˆ†é…
    return array;  // å®‰å…¨ï¼šç”Ÿå­˜æœŸä¸å—ä½œç”¨åŸŸé™åˆ¶
}

int main() {
    int* a = CreateArray();
    // ä½¿ç”¨åå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼
    delete[] a;
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

#### æ–¹æ¡ˆBï¼šä¼ å…¥å¤–éƒ¨æ•°ç»„

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">void CreateArray(int* array) {
    // å¡«å……å·²å­˜åœ¨çš„æ•°ç»„
}

int main() {
    int array[50];  // åœ¨è°ƒç”¨è€…ä½œç”¨åŸŸå†…
    CreateArray(array);  // ä¼ é€’æŒ‡é’ˆï¼Œä¸æ¶‰åŠç”Ÿå­˜æœŸé—®é¢˜
}</code></div><div class="hyc-code-scrollbar__track"><br class="Apple-interchange-newline"/></div></div></pre></div></pre>

## ä¸‰ã€åˆ©ç”¨æ ˆç”Ÿå­˜æœŸçš„æ™ºèƒ½æ¨¡å¼ï¼ˆå›¾ç‰‡4ï¼‰

### 1. **ä½œç”¨åŸŸæŒ‡é’ˆï¼ˆScoped Pointerï¼‰**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class ScopedPtr {
private:
    Entity* m_Ptr;
public:
    ScopedPtr(Entity* ptr) : m_Ptr(ptr) {}
    ~ScopedPtr() { delete m_Ptr; }  // è‡ªåŠ¨é‡Šæ”¾ï¼
};

int main() {
    {
        ScopedPtr e = new Entity();  // å †åˆ†é…ï¼Œä½†è‡ªåŠ¨ç®¡ç†
    } // ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨è°ƒç”¨delete
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

**è¾“å‡º**ï¼š

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-markdown">Created Entity
Destroyed Entity  // è‡ªåŠ¨è°ƒç”¨ï¼</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 2. **å®é™…åº”ç”¨åœºæ™¯ï¼ˆå›¾ç‰‡4ï¼‰**

#### ğŸ•’ è®¡æ—¶å™¨ï¼ˆTimerï¼‰

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class Timer {
public:
    Timer() { start = std::chrono::high_resolution_clock::now(); }
    ~Timer() {
        auto end = std::chrono::high_resolution_clock::now();
        auto duration = end - start;
        std::cout << "è€—æ—¶: " << duration.count() << "ns\n";
    }
private:
    std::chrono::time_point<std::chrono::high_resolution_clock> start;
};

void expensiveFunction() {
    Timer timer;  // æ„é€ æ—¶å¼€å§‹è®¡æ—¶
    // æ‰§è¡Œæ˜‚è´µæ“ä½œ...
} // ææ„æ—¶è‡ªåŠ¨æ‰“å°è€—æ—¶</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

#### ğŸ”’ äº’æ–¥é”ï¼ˆMutex Lockingï¼‰

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class ScopedLock {
public:
    ScopedLock(std::mutex& mtx) : mutex(mtx) { mutex.lock(); }
    ~ScopedLock() { mutex.unlock(); }
private:
    std::mutex& mutex;
};

std::mutex g_mutex;

void threadSafeFunction() {
    ScopedLock lock(g_mutex);  // è‡ªåŠ¨åŠ é”
    // ä¸´ç•ŒåŒºä»£ç ...
} // è‡ªåŠ¨è§£é”ï¼Œå³ä½¿å¼‚å¸¸ä¹Ÿèƒ½ä¿è¯è§£é”ï¼</code></div></div></pre></div></pre>

## å››ã€æ ˆç”Ÿå­˜æœŸ vs å †ç”Ÿå­˜æœŸå¯¹æ¯”


| **ç‰¹æ€§**     | **æ ˆç”Ÿå­˜æœŸ**       | **å †ç”Ÿå­˜æœŸ**       |
| ------------ | ------------------ | ------------------ |
| **ç®¡ç†æ–¹å¼** | è‡ªåŠ¨ï¼ˆä½œç”¨åŸŸç»“æŸï¼‰ | æ‰‹åŠ¨ï¼ˆnew/deleteï¼‰ |
| **æ€§èƒ½**     | å¿«é€Ÿï¼ˆç§»åŠ¨æ ˆæŒ‡é’ˆï¼‰ | è¾ƒæ…¢ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰   |
| **å®‰å…¨æ€§**   | é«˜ï¼ˆæ— å†…å­˜æ³„æ¼ï¼‰   | ä½ï¼ˆéœ€æ‰‹åŠ¨ç®¡ç†ï¼‰   |
| **çµæ´»æ€§**   | å›ºå®šå¤§å°/ç”Ÿå­˜æœŸ    | åŠ¨æ€å¤§å°/ç”Ÿå­˜æœŸ    |
| **é€‚ç”¨åœºæ™¯** | å±€éƒ¨ä¸´æ—¶å¯¹è±¡       | é•¿æœŸå­˜åœ¨çš„å¤§å¯¹è±¡   |

---

## ğŸ’¡ äº”ã€ç°ä»£C++çš„æœ€ä½³å®è·µ

### 1. **ä¼˜å…ˆä½¿ç”¨æ ˆå¯¹è±¡**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">// âœ… æ¨èï¼šæ ˆä¸Šå°å¯¹è±¡
void processData() {
    std::vector<int> data(1000);  // æ ˆä¸Švectorï¼ˆå…ƒç´ åœ¨å †ï¼Œæ§åˆ¶å—åœ¨æ ˆï¼‰
    // ä½¿ç”¨æ•°æ®...
} // è‡ªåŠ¨æ¸…ç†ï¼Œæ— å†…å­˜æ³„æ¼é£é™©</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 2. **ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ›¿ä»£è£¸new/delete**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">#include <memory>

void modernApproach() {
    // ç±»ä¼¼å›¾ç‰‡4çš„ScopedPtrï¼Œä½†æ›´å®‰å…¨
    auto ptr = std::make_unique<Entity>();  // C++11æ™ºèƒ½æŒ‡é’ˆ
    // æ— éœ€æ‰‹åŠ¨deleteï¼Œç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 3. **RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰æ¨¡å¼**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class FileHandler {
public:
    FileHandler(const std::string& filename) : file(std::fopen(filename.c_str(), "r")) {}
    ~FileHandler() { if (file) std::fclose(file); }
private:
    FILE* file;
};

void readFile() {
    FileHandler fh("data.txt");  // è‡ªåŠ¨æ‰“å¼€æ–‡ä»¶
    // ä½¿ç”¨æ–‡ä»¶...
} // è‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼</code></div></div></pre></div></pre>

## å…­ã€å…³é”®æ€»ç»“

### 1. **æ ˆç”Ÿå­˜æœŸçš„æ ¸å¿ƒä¼˜åŠ¿**

* **è‡ªåŠ¨ç®¡ç†**ï¼šé¿å…å†…å­˜æ³„æ¼
* **æ€§èƒ½ä¼˜å¼‚**ï¼šåˆ†é…/é‡Šæ”¾æå¿«
* **å¼‚å¸¸å®‰å…¨**ï¼šå³ä½¿æŠ›å‡ºå¼‚å¸¸ä¹Ÿèƒ½ä¿è¯æ¸…ç†
* **å¯é¢„æµ‹æ€§**ï¼šç”Ÿå­˜æœŸä¸ä»£ç ç»“æ„å¯¹åº”

### 2. **é€‚ç”¨åœºæ™¯**

* **çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡**ï¼šå‡½æ•°å†…ä¸´æ—¶å˜é‡
* **èµ„æºç®¡ç†ç±»**ï¼šé”ã€æ–‡ä»¶å¥æŸ„ã€è®¡æ—¶å™¨
* **æ€§èƒ½æ•æ„Ÿä»£ç **ï¼šé¿å…ä¸å¿…è¦çš„å †åˆ†é…

### 3. **è®¾è®¡åŸåˆ™**

> "åŸºäºæ ˆçš„å˜é‡åœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é”€æ¯ï¼Œè¿™ä¸€ç‰¹æ€§æ˜¯C++ RAIIç†å¿µçš„åŸºçŸ³ï¼Œä¹Ÿæ˜¯ç¼–å†™å®‰å…¨ã€é«˜æ•ˆC++ä»£ç çš„å…³é”®ã€‚"

### 4. **ç°ä»£å‘å±•**

å›¾ç‰‡4ä¸­çš„`ScopedPtr`å®é™…ä¸Šæ˜¯ç°ä»£`std::unique_ptr`çš„åŸå‹ï¼Œä½“ç°äº†C++"èµ„æºç®¡ç†åº”ä¸å¯¹è±¡ç”Ÿå­˜æœŸç»‘å®š"çš„æ ¸å¿ƒå“²å­¦ã€‚

# C++ æ™ºèƒ½æŒ‡é’ˆè¯¦è§£ï¼š`unique_ptr`, `shared_ptr`, `weak_ptr`

> **ç›®æ ‡**ï¼šç†è§£ä¸‰ç§æ™ºèƒ½æŒ‡é’ˆçš„ä½œç”¨ã€åŸç†å’Œä½¿ç”¨æ–¹æ³•ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

## âœ… ä¸€ã€ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ

æ™ºèƒ½æŒ‡é’ˆæ˜¯ C++ ä¸­çš„ä¸€ç§**ç±»æ¨¡æ¿**ï¼Œå®ƒå°è£…äº†åŸå§‹æŒ‡é’ˆï¼ˆ`T*`ï¼‰ï¼Œå¹¶è‡ªåŠ¨ç®¡ç†åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚

### âœ… æ ¸å¿ƒæ€æƒ³ï¼š

* å½“æ™ºèƒ½æŒ‡é’ˆè¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ `delete`ã€‚
* é¿å…æ‰‹åŠ¨ `new/delete` å¯¼è‡´çš„å†…å­˜æ³„æ¼æˆ–æ‚¬ç©ºæŒ‡é’ˆã€‚
* å®ç° RAIIï¼ˆResource Acquisition Is Initializationï¼‰â€”â€”èµ„æºè·å–å³åˆå§‹åŒ–ã€‚

## âœ… äºŒã€ä¸‰å¤§æ™ºèƒ½æŒ‡é’ˆå¯¹æ¯”


| ç±»å‹         | æ‰€æœ‰æƒ     | å¯å¤åˆ¶ï¼Ÿ    | å¼•ç”¨è®¡æ•°       | ä½¿ç”¨åœºæ™¯           |
| ------------ | ---------- | ----------- | -------------- | ------------------ |
| `unique_ptr` | å”¯ä¸€æ‰€æœ‰æƒ | âŒ ä¸å¯å¤åˆ¶ | æ—              | å•ä¸€æ‰€æœ‰è€…ï¼Œæ ˆå¯¹è±¡ |
| `shared_ptr` | å…±äº«æ‰€æœ‰æƒ | âœ… å¯å¤åˆ¶   | æœ‰ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰ | å¤šä¸ªå¯¹è±¡å…±äº«èµ„æº   |
| `weak_ptr`   | æ— æ‰€æœ‰æƒ   | âœ… å¯å¤åˆ¶   | æœ‰ï¼ˆå¼±å¼•ç”¨ï¼‰   | é˜²æ­¢å¾ªç¯å¼•ç”¨       |

---

## âœ… ä¸‰ã€è¯¦ç»†è¯´æ˜ä¸ä»£ç ç¤ºä¾‹

### ğŸ”¹ 1. `unique_ptr` â€”â€” ç‹¬å å¼æ™ºèƒ½æŒ‡é’ˆ

#### âœ… ç‰¹ç‚¹ï¼š

* ä¸€ä¸ªå¯¹è±¡åªèƒ½è¢«ä¸€ä¸ª `unique_ptr` æ‹¥æœ‰ã€‚
* ä¸å¯å¤åˆ¶ï¼Œä½†å¯ä»¥ç§»åŠ¨ï¼ˆ`std::move`ï¼‰ã€‚
* è‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼Œå¼‚å¸¸å®‰å…¨ã€‚
* æ€§èƒ½é«˜ï¼Œæ— é¢å¤–å¼€é”€ï¼ˆé™¤äº†æŒ‡é’ˆæœ¬èº«ï¼‰ã€‚

#### âœ… åˆ›å»ºæ–¹å¼ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><iostream><span>
</span><span></span><span>#</span>include<span> </span><memory><span>
</span>
<span></span>class Entity {<span>
</span><span></span><span>public</span><span>:
</span><span>    Entity() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Created Entity\n"</span><span>; }
</span><span>    ~Entity() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Destroyed Entity\n"</span><span>; }
</span><span>    </span>void Print() const <span>{ </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Entity is alive!\n"</span><span>; }
</span>};

<span></span>int main() <span>{
</span><span>    </span><span>// æ–¹æ³•1ï¼šç›´æ¥æ„é€ </span><span>
</span><span>    </span><span>std</span><span>::</span><span>unique_ptr</span><span><Entity> entity = </span><span>std</span><span>::make_unique<Entity>();
</span>    entity->Print();

<span>    </span><span>// æ–¹æ³•2ï¼šä½¿ç”¨ move è½¬ç§»æ‰€æœ‰æƒ</span><span>
</span><span>    </span><span>auto</span><span> ptr1 = </span><span>std</span><span>::make_unique<Entity>();
</span><span>    </span><span>auto</span><span> ptr2 = </span><span>std</span><span>::move(ptr1); </span><span>// ptr1 å˜ä¸ºç©ºï¼Œptr2 æ‹¥æœ‰å¯¹è±¡</span><span>
</span>    ptr2->Print();

<span>    </span><span>// é”™è¯¯ï¼šä¸èƒ½å¤åˆ¶</span><span>
</span><span>    </span><span>// auto ptr3 = ptr2; // ç¼–è¯‘é”™è¯¯ï¼</span><span>
</span>
<span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

> ğŸ’¡ æ¨èä½¿ç”¨ `std::make_unique<T>()`ï¼Œæ›´å®‰å…¨ã€å¼‚å¸¸å®‰å…¨ã€‚

### ğŸ”¹ 2. `shared_ptr` â€”â€” å…±äº«å¼æ™ºèƒ½æŒ‡é’ˆ

#### âœ… ç‰¹ç‚¹ï¼š

* æ”¯æŒå¤šä¸ª `shared_ptr` å…±äº«åŒä¸€ä¸ªå¯¹è±¡ã€‚
* ä½¿ç”¨**å¼•ç”¨è®¡æ•°**ï¼šå½“å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œè‡ªåŠ¨é”€æ¯å¯¹è±¡ã€‚
* å¯ä»¥å¤åˆ¶ï¼Œé€‚åˆå¤šçº¿ç¨‹ã€å®¹å™¨ä¸­å­˜å‚¨å¯¹è±¡ã€‚

#### âœ… åˆ›å»ºæ–¹å¼ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><iostream><span>
</span><span></span><span>#</span>include<span> </span><memory><span>
</span><span></span><span>#</span>include<span> </span><vector><span>
</span>
<span></span>class Entity {<span>
</span><span></span><span>public</span><span>:
</span><span>    Entity() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Created Entity\n"</span><span>; }
</span><span>    ~Entity() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Destroyed Entity\n"</span><span>; }
</span><span>    </span>void Print() const <span>{ </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Entity is alive!\n"</span><span>; }
</span>};

<span></span>int main() <span>{
</span><span>    </span><span>auto</span><span> sharedEntity = </span><span>std</span><span>::make_shared<Entity>();
</span>
    {
<span>        </span><span>auto</span><span> e0 = sharedEntity;  </span><span>// å¼•ç”¨è®¡æ•° +1</span><span>
</span><span>        </span><span>auto</span><span> e1 = sharedEntity;  </span><span>// å¼•ç”¨è®¡æ•° +1</span><span>
</span>        e0->Print();
<span>    } </span><span>// e0, e1 å‡ºä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•° -2</span><span>
</span>
<span>    </span><span>// æ­¤æ—¶å¼•ç”¨è®¡æ•°ä¸º 1ï¼Œå¯¹è±¡ä»ç„¶å­˜æ´»</span><span>
</span>    sharedEntity->Print();

<span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

> âš ï¸ æ³¨æ„ï¼š`std::make_shared<T>()` æ˜¯æ¨èæ–¹å¼ï¼Œæ¯” `new T()` æ›´é«˜æ•ˆï¼ˆä¸€æ¬¡å†…å­˜åˆ†é…ï¼‰ã€‚

### ğŸ”¹ 3. `weak_ptr` â€”â€” å¼±å¼•ç”¨æ™ºèƒ½æŒ‡é’ˆ

#### âœ… ç‰¹ç‚¹ï¼š

* ä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚
* ç”¨äºè§£å†³ `shared_ptr` çš„**å¾ªç¯å¼•ç”¨é—®é¢˜**ã€‚
* ä¸èƒ½ç›´æ¥è§£å¼•ç”¨ï¼Œå¿…é¡»å…ˆè½¬æ¢ä¸º `shared_ptr`ã€‚
* ä½¿ç”¨ `lock()` æ£€æŸ¥æ˜¯å¦ä»æœ‰æ•ˆã€‚

#### âœ… ç¤ºä¾‹ï¼šé˜²æ­¢å¾ªç¯å¼•ç”¨

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><iostream><span>
</span><span></span><span>#</span>include<span> </span><memory><span>
</span>
<span></span>class Child;<span>
</span><span></span>class Parent {<span>
</span><span></span><span>public</span><span>:
</span><span>    </span><span>std</span><span>::</span><span>shared_ptr</span><span><Child> child;
</span><span>    ~Parent() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Parent destroyed\n"</span><span>; }
</span>};

<span></span>class Child {<span>
</span><span></span><span>public</span><span>:
</span><span>    </span><span>std</span><span>::weak_ptr<Parent> parent; </span><span>// ä½¿ç”¨ weak_ptr</span><span>
</span><span>    ~Child() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Child destroyed\n"</span><span>; }
</span>};

<span></span>int main() <span>{
</span><span>    </span><span>auto</span><span> parent = </span><span>std</span><span>::make_shared<Parent>();
</span><span>    </span><span>auto</span><span> child = </span><span>std</span><span>::make_shared<Child>();
</span>
    parent->child = child;
    child->parent = parent;

<span>    </span><span>// æ­¤æ—¶ parent å’Œ child å½¼æ­¤æŒæœ‰å¯¹æ–¹çš„ shared_ptr â†’ å¾ªç¯å¼•ç”¨ï¼</span><span>
</span><span>    </span><span>// å¦‚æœä¸ä½¿ç”¨ weak_ptrï¼Œå¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º 0ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼</span><span>
</span>
<span>    </span><span>// ä½†æ˜¯æˆ‘ä»¬ç”¨äº† weak_ptrï¼Œæ‰€ä»¥ä¸ä¼šå½±å“å¼•ç”¨è®¡æ•°</span><span>
</span><span>    </span><span>// å½“ parent å’Œ child éƒ½å‡ºä½œç”¨åŸŸåï¼Œä¼šæ­£å¸¸ææ„</span><span>
</span>
<span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

#### âœ… `weak_ptr` çš„ä½¿ç”¨æ–¹å¼ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>auto</span><span> sharedEntity = </span><span>std</span><span>::make_shared<Entity>();
</span><span></span><span>std</span><span>::weak_ptr<Entity> weakEntity = sharedEntity;
</span>
<span></span><span>// æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ•ˆ</span><span>
</span><span></span><span>if</span><span> (</span><span>auto</span><span> ptr = weakEntity.lock()) {
</span><span>    ptr->Print();  </span><span>// å®‰å…¨è®¿é—®</span><span>
</span><span>} </span><span>else</span><span> {
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Entity has been destroyed\n"</span><span>;
</span>}</code></pre></div></div></pre>

## âœ… å››ã€æ™ºèƒ½æŒ‡é’ˆæ€»ç»“è¡¨


| æŒ‡é’ˆç±»å‹     | æ˜¯å¦ç‹¬å  | æ˜¯å¦å¯å¤åˆ¶ | æ˜¯å¦å¢åŠ å¼•ç”¨è®¡æ•° | æ˜¯å¦æ”¯æŒå¼‚å¸¸å®‰å…¨ | é€‚ç”¨åœºæ™¯               |
| ------------ | -------- | ---------- | ---------------- | ---------------- | ---------------------- |
| `unique_ptr` | âœ… æ˜¯    | âŒ å¦      | âŒ å¦            | âœ… æ˜¯            | å•ä¸€æ‹¥æœ‰è€…ï¼Œæ ˆå¯¹è±¡     |
| `shared_ptr` | âŒ å¦    | âœ… æ˜¯      | âœ… æ˜¯            | âœ… æ˜¯            | å¤šä¸ªå¯¹è±¡å…±äº«èµ„æº       |
| `weak_ptr`   | âŒ å¦    | âœ… æ˜¯      | âŒ å¦            | âœ… æ˜¯            | é˜²æ­¢å¾ªç¯å¼•ç”¨ï¼Œä¸´æ—¶è§‚å¯Ÿ |

---

## âœ… äº”ã€æœ€ä½³å®è·µå»ºè®®

1. âœ… **ä¼˜å…ˆä½¿ç”¨ `unique_ptr`**ï¼Œé™¤ééœ€è¦å…±äº«ã€‚
2. âœ… **ä½¿ç”¨ `make_unique` / `make_shared`**ï¼Œé¿å…è£¸ `new`ã€‚
3. âœ… **é¿å… `shared_ptr` çš„å¾ªç¯å¼•ç”¨**ï¼Œç”¨ `weak_ptr` æ–­å¼€ã€‚
4. âœ… **ä¸è¦æ··åˆä½¿ç”¨åŸå§‹æŒ‡é’ˆå’Œæ™ºèƒ½æŒ‡é’ˆ**ã€‚
5. âœ… **å°½é‡åœ¨æ ˆä¸Šåˆ›å»ºå¯¹è±¡**ï¼Œå‡å°‘å †åˆ†é…ã€‚

## âœ… å…­ã€å®Œæ•´å¯è¿è¡Œä»£ç ï¼ˆç»¼åˆç¤ºä¾‹ï¼‰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>#</span>include<span> </span><iostream><span>
</span><span></span><span>#</span>include<span> </span><memory><span>
</span><span></span><span>#</span>include<span> </span><vector><span>
</span>
<span></span>class Entity {<span>
</span><span></span><span>public</span><span>:
</span><span>    Entity() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Created Entity\n"</span><span>; }
</span><span>    ~Entity() { </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Destroyed Entity\n"</span><span>; }
</span><span>    </span>void Print() const <span>{ </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Entity is alive!\n"</span><span>; }
</span>};

<span></span>int main() <span>{
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"=== unique_ptr ===\n"</span><span>;
</span>    {
<span>        </span><span>auto</span><span> unique = </span><span>std</span><span>::make_unique<Entity>();
</span>        unique->Print();
<span>    } </span><span>// unique å‡ºä½œç”¨åŸŸï¼Œè‡ªåŠ¨é”€æ¯</span><span>
</span>
<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"\n=== shared_ptr ===\n"</span><span>;
</span>    {
<span>        </span><span>auto</span><span> shared = </span><span>std</span><span>::make_shared<Entity>();
</span><span>        </span><span>auto</span><span> shared2 = shared;  </span><span>// å…±äº«æ‰€æœ‰æƒ</span><span>
</span>        shared->Print();
<span>    } </span><span>// å¼•ç”¨è®¡æ•°ä¸º0ï¼Œè‡ªåŠ¨é”€æ¯</span><span>
</span>
<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"\n=== weak_ptr ===\n"</span><span>;
</span>    {
<span>        </span><span>auto</span><span> shared = </span><span>std</span><span>::make_shared<Entity>();
</span><span>        </span><span>std</span><span>::weak_ptr<Entity> weak = shared;
</span>
<span>        </span><span>if</span><span> (</span><span>auto</span><span> ptr = weak.lock()) {
</span>            ptr->Print();
        }

<span>        </span><span>// shared å‡ºä½œç”¨åŸŸï¼Œå¯¹è±¡è¢«é”€æ¯</span><span>
</span><span>        </span><span>// å†æ¬¡æ£€æŸ¥ weak</span><span>
</span><span>        </span><span>if</span><span> (</span><span>auto</span><span> ptr = weak.lock()) {
</span>            ptr->Print();
<span>        } </span><span>else</span><span> {
</span><span>            </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Entity already destroyed\n"</span><span>;
</span>        }
    }

<span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

### ğŸ“Œ è¾“å‡ºç»“æœï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>=== unique_ptr ===
</span>Created Entity
<span>Entity </span><span>is</span><span> alive!
</span>Destroyed Entity

=== shared_ptr ===
Created Entity
<span>Entity </span><span>is</span><span> alive!
</span>Destroyed Entity

=== weak_ptr ===
Created Entity
<span>Entity </span><span>is</span><span> alive!
</span>Entity already destroyed
Destroyed Entity</code></pre></div></div></pre>

---

## âœ… ä¸ƒã€å¸¸è§è¯¯åŒºæé†’


| è¯¯åŒº                                 | è¯´æ˜                           |
| ------------------------------------ | ------------------------------ |
| `shared_ptr` ç›´æ¥èµ‹å€¼ç»™ `unique_ptr` | âŒ ä¸å…è®¸ï¼Œæ‰€æœ‰æƒå†²çª          |
| `unique_ptr` å¤åˆ¶                    | âŒ ç¼–è¯‘é”™è¯¯ï¼Œåº”ä½¿ç”¨`std::move` |
| å¿˜è®°`make_shared`                    | âŒ ä¸¤æ¬¡å†…å­˜åˆ†é…ï¼Œæ•ˆç‡ä½        |
| å¾ªç¯å¼•ç”¨æœªç”¨`weak_ptr`               | âŒ å†…å­˜æ³„æ¼                    |

---

## âœ… å…«ã€å°ç»“

> **æ™ºèƒ½æŒ‡é’ˆä¸æ˜¯â€œä¸‡èƒ½è¯â€ï¼Œè€Œæ˜¯â€œç°ä»£ C++ çš„å®‰å…¨å«å£«â€**ã€‚

* `unique_ptr`ï¼šä½ çš„ç¬¬ä¸€é€‰æ‹©ï¼Œç®€å•å®‰å…¨ã€‚
* `shared_ptr`ï¼šå½“ä½ éœ€è¦å…±äº«æ—¶ï¼Œè®°å¾—é˜²å¾ªç¯ã€‚
* `weak_ptr`ï¼šç”¨æ¥â€œè§‚å¯Ÿâ€è€Œä¸â€œæ‹¥æœ‰â€ã€‚

# åˆ›å»ºæ–¹å¼çš„åŒºåˆ«

## ä¸€ã€ä¸ºä»€ä¹ˆæ¨è `std::make_unique<T>()`ï¼Ÿæ¯” `new` å¥½åœ¨å“ªï¼Ÿ

### âŒ ä¼ ç»Ÿå†™æ³•ï¼ˆä¸æ¨èï¼‰ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>auto</span><span> ptr = </span><span>std</span><span>::</span><span>unique_ptr</span><span><Entity>(</span><span>new</span><span> Entity());</span></code></pre></div></div></pre>

### âœ… æ¨èå†™æ³•ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>auto</span><span> ptr = </span><span>std</span><span>::make_unique<Entity>();</span></code></pre></div></div></pre>

### âœ… ä¼˜åŠ¿1ï¼š**å¼‚å¸¸å®‰å…¨ï¼ˆException Safetyï¼‰**

#### é—®é¢˜åœºæ™¯ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// å‡è®¾æœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°</span><span>
</span><span></span>void func(std::unique_ptr<A>, std::unique_ptr<B>)<span>;
</span>
<span>func(</span><span>std</span><span>::</span><span>unique_ptr</span><span><A>(</span><span>new</span><span> A()), </span><span>std</span><span>::</span><span>unique_ptr</span><span><B>(</span><span>new</span><span> B()));</span></code></pre></div></div></pre>

[C++ **ä¸ä¿è¯å‚æ•°æ±‚å€¼é¡ºåº**ï¼å¯èƒ½çš„æ‰§è¡Œé¡ºåºï¼š]()

1. [`new A()` â†’ æˆåŠŸï¼Œè¿”å›æŒ‡é’ˆ]()
2. [`new B()` â†’ æˆåŠŸï¼Œè¿”å›æŒ‡é’ˆ]()
3. [æ„é€  `unique_ptr<B>` â†’ æˆåŠŸ]()
4. [æ„é€  `unique_ptr<A>` â†’ æŠ›å¼‚å¸¸ï¼ğŸ’¥]()

[æ­¤æ—¶ï¼š]()

* [`A` çš„å†…å­˜å·²åˆ†é…ï¼ˆ`new A()` æˆåŠŸï¼‰]()
* [ä½† `unique_ptr<A>` æ²¡æ„é€ æˆåŠŸ â†’ **å†…å­˜æ³„æ¼ï¼**]()

[ğŸ‘‰ å› ä¸º `unique_ptr` æ²¡æ‹¿åˆ°æ‰€æœ‰æƒï¼Œ`delete` ä¸ä¼šè¢«è°ƒç”¨ã€‚]()

#### [âœ… `make_unique` è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š]()

[`std::make_unique<A>()` æ˜¯ä¸€ä¸ª**åŸå­æ“ä½œ**ï¼š]()

* [è¦ä¹ˆæˆåŠŸè¿”å› `unique_ptr<A>`]()
* [è¦ä¹ˆæŠ›å¼‚å¸¸ï¼Œä½†ä¸ä¼šç•™ä¸‹â€œåŠæˆå“â€]()

[æ‰€ä»¥ä¸ä¼šæ³„æ¼ã€‚]()

> [ğŸ¯ **ç»“è®ºï¼š`make_unique` æ˜¯å¼‚å¸¸å®‰å…¨çš„ï¼Œ`new` + æ„é€  `unique_ptr` ä¸æ˜¯ã€‚**]()

### [âœ… ä¼˜åŠ¿2ï¼š**ç®€æ´ã€é¿å…é‡å¤ç±»å‹**]()

[æ›´çŸ­ã€æ›´æ¸…æ™°ã€ä¸æ˜“å‡ºé”™ã€‚]()

---

### [âœ… ä¼˜åŠ¿3ï¼š**é˜²æ­¢æ„é€ æ—¶çš„èµ„æºæ³„æ¼**]()

[`make_unique` å†…éƒ¨ä½¿ç”¨å®Œç¾è½¬å‘ï¼ˆperfect forwardingï¼‰ï¼Œç¡®ä¿å¯¹è±¡æ„é€ å’ŒæŒ‡é’ˆåŒ…è£…æ˜¯â€œåŸå­â€çš„ã€‚]()

## [äºŒã€ä¸ºä»€ä¹ˆ `std::make_shared<T>()` æ¯” `new T()` æ›´é«˜æ•ˆï¼Ÿ]()

[è¿™æ˜¯ä¸ª**æ€§èƒ½é—®é¢˜**ï¼Œå…³é”®åœ¨äºï¼š**å†…å­˜åˆ†é…æ¬¡æ•°**ã€‚]()

### [âŒ ä¼ ç»Ÿå†™æ³•ï¼š]()

[è¿™ä¸ªæ“ä½œéœ€è¦ **ä¸¤æ¬¡å†…å­˜åˆ†é…**ï¼š]()


| æ­¥éª¤  | åˆ†é…å†…å®¹          | è¯´æ˜                                                          |
| ----- | ----------------- | ------------------------------------------------------------- |
| 1ï¸âƒ£ | `new Entity()`    | åˆ†é…å¯¹è±¡æœ¬èº«ï¼ˆæ¯”å¦‚ 16 å­—èŠ‚ï¼‰                                  |
| 2ï¸âƒ£ | `shared_ptr` å†…éƒ¨ | åˆ†é…**æ§åˆ¶å—ï¼ˆcontrol blockï¼‰**ï¼ˆå­˜å‚¨å¼•ç”¨è®¡æ•°ã€å¼±å¼•ç”¨è®¡æ•°ç­‰ï¼‰ |

[ğŸ‘‰ ä¸¤æ¬¡ç‹¬ç«‹çš„ `malloc`ï¼Œæ€§èƒ½å·®ï¼Œç¼“å­˜ä¸å‹å¥½ã€‚]()

---

### [âœ… `std::make_shared<T>()` çš„ä¼˜åŒ–ï¼š]()

[å®ƒä¼š**ä¸€æ¬¡æ€§åˆ†é…ä¸€å—è¿ç»­å†…å­˜**ï¼ŒåŒ…å«ï¼š]()

[ğŸ‘‰ **ä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œæå®šå¯¹è±¡å’Œæ§åˆ¶å—**ã€‚]()

### [âœ… å¥½å¤„ï¼š]()


| ä¼˜åŠ¿              | è¯´æ˜                                     |
| ----------------- | ---------------------------------------- |
| âš¡ æ›´å¿«           | å‡å°‘`malloc` è°ƒç”¨æ¬¡æ•°                    |
| ğŸ’¾ æ›´å¥½ç¼“å­˜å±€éƒ¨æ€§ | å¯¹è±¡å’Œæ§åˆ¶å—åœ¨å†…å­˜ä¸­è¿ç»­ï¼ŒCPU ç¼“å­˜æ›´å‹å¥½ |
| ğŸ“‰ å‡å°‘å†…å­˜ç¢ç‰‡   | ä¸€æ¬¡åˆ†é…ï¼Œä¸€æ¬¡é‡Šæ”¾                       |

---

### [ğŸ”¬ éªŒè¯ï¼š`make_shared` åªåˆ†é…ä¸€æ¬¡]()

[è¾“å‡ºï¼š]()

[è™½ç„¶ä½ çœ‹ä¸åˆ°å†…å­˜åˆ†é…ï¼Œä½†åº•å±‚ç¡®å®åªè°ƒç”¨äº†ä¸€æ¬¡ `operator new`ï¼ˆåˆ†é…æ€»å¤§å° = `sizeof(Entity) + æ§åˆ¶å—å¤§å°`ï¼‰ã€‚]()

## [ä¸‰ã€å¯¹æ¯”æ€»ç»“è¡¨]()


| å†™æ³•                   | å†…å­˜åˆ†é…æ¬¡æ•° | å¼‚å¸¸å®‰å…¨              | æ€§èƒ½ | æ¨èåº¦      |
| ---------------------- | ------------ | --------------------- | ---- | ----------- |
| `shared_ptr<T>(new T)` | 2 æ¬¡         | âŒ ä¸å®‰å…¨             | è¾ƒæ…¢ | âŒ ä¸æ¨è   |
| `make_shared<T>()`     | 1 æ¬¡         | âœ… å®‰å…¨               | æ›´å¿« | âœ… å¼ºçƒˆæ¨è |
| `unique_ptr<T>(new T)` | 1 æ¬¡ï¼ˆå¯¹è±¡ï¼‰ | âŒ ä¸å®‰å…¨ï¼ˆå¤šå‚æ•°æ—¶ï¼‰ | æ­£å¸¸ | âŒ ä¸æ¨è   |
| `make_unique<T>()`     | 1 æ¬¡         | âœ… å®‰å…¨               | æ­£å¸¸ | âœ… å¼ºçƒˆæ¨è |

---

## [âœ… å››ã€ç‰¹æ®Šæƒ…å†µï¼š`make_shared` çš„é™åˆ¶]()

[è™½ç„¶ `make_shared` å¾ˆå¥½ï¼Œä½†æœ‰**ä¸¤ä¸ªé™åˆ¶**ï¼š]()

### [1. ä¸èƒ½è‡ªå®šä¹‰åˆ é™¤å™¨ï¼ˆdeleterï¼‰]()

### [2. å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¯èƒ½å»¶é•¿]()

* [`make_shared` æŠŠå¯¹è±¡å’Œæ§åˆ¶å—æ”¾åœ¨ä¸€èµ·ã€‚]()
* [å³ä½¿å¼•ç”¨è®¡æ•°ä¸º 0ï¼Œ**å¯¹è±¡å’Œæ§åˆ¶å—è¦ä¸€èµ·é‡Šæ”¾**ã€‚]()
* [å¦‚æœ `weak_ptr` è¿˜å­˜åœ¨ï¼Œå¯¹è±¡å†…å­˜ä¸èƒ½é‡Šæ”¾ï¼ˆå³ä½¿æ²¡äººç”¨äº†ï¼‰ã€‚]()

[ğŸ‘‰ åœ¨å†…å­˜æ•æ„Ÿåœºæ™¯éœ€æ³¨æ„ã€‚]()

---

## [âœ… äº”ã€æœ€ç»ˆç»“è®ºï¼šä¸ºä»€ä¹ˆæ¨èï¼Ÿ]()


| æ¨èè¯­                   | åŸå›                                |
| ------------------------ | ---------------------------------- |
| **`make_unique` æ›´å®‰å…¨** | é¿å…å¼‚å¸¸å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œä»£ç æ›´ç®€æ´ |
| **`make_shared` æ›´é«˜æ•ˆ** | ä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œæ€§èƒ½æ›´å¥½ï¼Œç¼“å­˜å‹å¥½   |

---

### [ğŸ¯ æœ€ä½³å®è·µå£è¯€ï¼š]()

> [**â€œèƒ½ç”¨ `make_unique` å°±ä¸ç”¨ `new`ï¼Œ
> èƒ½ç”¨ `make_shared` å°±ä¸ç”¨ `shared_ptr(new T)`ã€‚â€**]()

[è¿™æ˜¯ç°ä»£ C++ çš„**é»„é‡‘å‡†åˆ™**ï¼Œèƒ½è®©ä½ å†™å‡ºæ›´å®‰å…¨ã€æ›´é«˜æ•ˆçš„ä»£ç ã€‚]()

# [æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„æ˜¯å †ä¸Šçš„å¯¹è±¡]()


## ä¸€ã€æ™ºèƒ½æŒ‡é’ˆçš„è®¾è®¡ç›®çš„

æ™ºèƒ½æŒ‡é’ˆï¼ˆ`unique_ptr`, `shared_ptr`, `weak_ptr`ï¼‰çš„æ ¸å¿ƒèŒè´£æ˜¯ï¼š

> **è‡ªåŠ¨ç®¡ç†åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼ˆå³å †å†…å­˜ï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚**

è€Œå †å†…å­˜çš„ç‰¹ç‚¹æ˜¯ï¼š

* é€šè¿‡ `new` / `malloc` åˆ†é…
* å¿…é¡»æ‰‹åŠ¨æˆ–è‡ªåŠ¨ `delete` / `free`
* ç”Ÿå‘½å‘¨æœŸä¸ä¾èµ–ä½œç”¨åŸŸï¼ˆä¸åƒæ ˆå˜é‡ï¼‰

æ‰€ä»¥ï¼Œ**æ™ºèƒ½æŒ‡é’ˆå°±æ˜¯ä¸ºäº†è§£å†³â€œå †å¯¹è±¡â€çš„å†…å­˜ç®¡ç†é—®é¢˜è€Œå­˜åœ¨çš„**ã€‚

---

## âœ… äºŒã€æ™ºèƒ½æŒ‡é’ˆå¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ

### 1. `std::make_unique<T>()` å’Œ `std::make_shared<T>()`

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>auto</span><span> ptr1 = </span><span>std</span><span>::make_unique<Entity>();  </span><span>// åœ¨å †ä¸Š new ä¸€ä¸ª Entity</span><span>
</span><span></span><span>auto</span><span> ptr2 = </span><span>std</span><span>::make_shared<Entity>();  </span><span>// åœ¨å †ä¸Š new ä¸€ä¸ª Entity</span></code></pre></div></div></pre>

* è¿™ä¸¤ä¸ªå‡½æ•°å†…éƒ¨éƒ½ä¼šè°ƒç”¨ `new T(...)`ã€‚
* å¯¹è±¡è¢«åˆ†é…åœ¨**å †ä¸Š**ã€‚
* æ™ºèƒ½æŒ‡é’ˆæŒæœ‰è¿™ä¸ªå †å¯¹è±¡çš„æŒ‡é’ˆï¼Œå¹¶åœ¨é€‚å½“æ—¶å€™è°ƒç”¨ `delete`ã€‚

ğŸ‘‰ æ‰€ä»¥ï¼š**æ˜¯çš„ï¼Œå¯¹è±¡åœ¨å †ä¸Šã€‚**

---

### 2. `shared_ptr` ä¹Ÿå¯ä»¥åŒ…è£…å·²æœ‰çš„å †å¯¹è±¡

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>Entity* raw_ptr = </span><span>new</span><span> Entity();
</span><span></span><span>auto</span><span> sp = </span><span>std</span><span>::</span><span>shared_ptr</span><span><Entity>(raw_ptr);  </span><span>// sp ç®¡ç†è¿™ä¸ªå †å¯¹è±¡</span></code></pre></div></div></pre>

* `raw_ptr` æŒ‡å‘å †å¯¹è±¡ã€‚
* `sp` æ¥ç®¡æ‰€æœ‰æƒï¼Œåç»­è‡ªåŠ¨é‡Šæ”¾ã€‚

---

## âœ… ä¸‰ã€é‚£èƒ½ä¸èƒ½è®©æ™ºèƒ½æŒ‡é’ˆç®¡ç†æ ˆå¯¹è±¡ï¼Ÿ

### âŒ ç›´æ¥ç®¡ç†æ ˆå¯¹è±¡æ˜¯**å±é™©ä¸”é”™è¯¯çš„**ï¼

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>Entity entity;  </span><span>// æ ˆå¯¹è±¡</span><span>
</span><span></span><span>auto</span><span> sp = </span><span>std</span><span>::</span><span>shared_ptr</span><span><Entity>(&entity);  </span><span>// âŒ å±é™©ï¼</span></code></pre></div></div></pre>

### âŒ ä¸ºä»€ä¹ˆé”™ï¼Ÿ

* `entity` æ˜¯æ ˆå¯¹è±¡ï¼Œå‡½æ•°è¿”å›æ—¶ä¼šè‡ªåŠ¨é”€æ¯ã€‚
* `sp` ä¸çŸ¥é“è¿™ä¸€ç‚¹ï¼Œå®ƒä¼šåœ¨è‡ªå·±é”€æ¯æ—¶å°è¯• `delete &entity`ã€‚
* ä½† `&entity` ä¸æ˜¯ `new` å‡ºæ¥çš„ï¼Œ**ä¸èƒ½ `delete`**ï¼
* ç»“æœï¼š**æœªå®šä¹‰è¡Œä¸ºï¼ˆUndefined Behaviorï¼‰**ï¼Œç¨‹åºå´©æºƒã€‚

---

### âœ… ä¾‹å¤–ï¼šå¯ä»¥ç”¨è‡ªå®šä¹‰åˆ é™¤å™¨é¿å… `delete`

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>Entity entity;
</span><span></span><span>auto</span><span> sp = </span><span>std</span><span>::</span><span>shared_ptr</span><span><Entity>(&entity, [](Entity*){});  </span><span>// ç©ºåˆ é™¤å™¨</span></code></pre></div></div></pre>

* è¿™æ · `sp` ä¸ä¼šè°ƒç”¨ `delete`ï¼Œé¿å…å´©æºƒã€‚
* ä½†ä½ å¿…é¡»ç¡®ä¿ `sp` çš„ç”Ÿå‘½å‘¨æœŸ **ä¸è¶…è¿‡ `entity` çš„ç”Ÿå‘½å‘¨æœŸ**ï¼Œå¦åˆ™å˜æˆæ‚¬ç©ºæŒ‡é’ˆã€‚

ğŸ‘‰ è¿™ç§ç”¨æ³•**æå°‘è§ï¼Œä¸æ¨è**ï¼Œå®¹æ˜“å‡ºé”™ã€‚

---

## âœ… å››ã€æ™ºèƒ½æŒ‡é’ˆ vs æ ˆå¯¹è±¡ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ


| åœºæ™¯                       | æ¨èæ–¹å¼                                               |
| -------------------------- | ------------------------------------------------------ |
| å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œå‡½æ•°å†…ä½¿ç”¨ | âœ… ç›´æ¥æ ˆä¸Šåˆ›å»ºï¼š`Entity e;`                           |
| éœ€è¦è¿”å›å¯¹è±¡ç»™è°ƒç”¨è€…       | âœ… è¿”å›å€¼ï¼ˆRVO/NRVO ä¼˜åŒ–ï¼‰æˆ–`std::make_unique<Entity>` |
| å¤šä¸ªæ‰€æœ‰è€…å…±äº«å¯¹è±¡         | âœ…`std::shared_ptr<Entity>`                            |
| å¯¹è±¡è¾ƒå¤§ï¼Œé¿å…æ‹·è´         | âœ…`std::unique_ptr<Entity>` ä¼ é€’æ‰€æœ‰æƒ                 |

---

## âœ… äº”ã€å›¾è§£ï¼šæ™ºèƒ½æŒ‡é’ˆä¸å†…å­˜ä½ç½®

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>æ ˆï¼ˆStackï¼‰             å †ï¼ˆHeapï¼‰
</span>+-------------+       +------------------+
|  ptr         |----â†’ |   Entity å¯¹è±¡     |
<span>| (æ™ºèƒ½æŒ‡é’ˆ)    |       | (ç”± </span><span>new</span><span> åˆ›å»º)     |
</span>+-------------+       +------------------+</code></pre></div></div></pre>

* **æ™ºèƒ½æŒ‡é’ˆæœ¬èº«**ï¼šé€šå¸¸åœ¨æ ˆä¸Šï¼ˆå±€éƒ¨å˜é‡ï¼‰ã€‚
* **æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„å¯¹è±¡**ï¼šåœ¨å †ä¸Šã€‚
* æ™ºèƒ½æŒ‡é’ˆææ„æ—¶ï¼Œè‡ªåŠ¨ `delete` å †å¯¹è±¡ã€‚

---

## âœ… å…­ã€æ€»ç»“


| é—®é¢˜                               | ç­”æ¡ˆ                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| **æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„å¯¹è±¡æ˜¯åœ¨å †ä¸Šå—ï¼Ÿ** | âœ… æ˜¯çš„ï¼Œå‡ ä¹æ€»æ˜¯ã€‚                                          |
| **ä¸ºä»€ä¹ˆï¼Ÿ**                       | å› ä¸ºæ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸ºäº†ç®¡ç†åŠ¨æ€å†…å­˜ï¼ˆ`new` å‡ºæ¥çš„å¯¹è±¡ï¼‰è€Œè®¾è®¡çš„ã€‚ |
| **èƒ½ä¸èƒ½ç®¡ç†æ ˆå¯¹è±¡ï¼Ÿ**             | âŒ ä¸æ¨èï¼Œå±é™©ï¼›é™¤éç”¨ç©ºåˆ é™¤å™¨ï¼Œä½†ä»éœ€æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚    |
| **æ™ºèƒ½æŒ‡é’ˆæœ¬èº«åœ¨å“ªï¼Ÿ**             | é€šå¸¸åœ¨æ ˆä¸Šï¼Œåƒæ™®é€šå±€éƒ¨å˜é‡ä¸€æ ·ã€‚                             |

---

### ğŸ¯ ä¸€å¥è¯æ€»ç»“ï¼š

> **â€œæ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ ˆä¸Šçš„å¯¹è±¡ï¼Œå®ƒè´Ÿè´£ç®¡ç†ä¸€ä¸ªå †ä¸Šçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚â€**

å®ƒå°±åƒä¸€ä¸ªâ€œè‡ªåŠ¨æ”¶åƒåœ¾çš„ç®¡å®¶â€ï¼š

* å®ƒè‡ªå·±ä½åœ¨å°å±‹é‡Œï¼ˆæ ˆï¼‰
* å®ƒç®¡ç†çš„æˆ¿å­åœ¨éƒŠåŒºï¼ˆå †ï¼‰
* æˆ¿å­æ²¡äººä½äº†ï¼Œå®ƒå°±è‡ªåŠ¨æ‹†æ‰ï¼ˆ`delete`ï¼‰

---

### âœ… æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code>void func() <span>{
</span><span>    </span><span>auto</span><span> ptr = </span><span>std</span><span>::make_unique<Entity>();  </span><span>// ptr åœ¨æ ˆä¸Šï¼ŒEntity åœ¨å †ä¸Š</span><span>
</span>    ptr->DoSomething();
<span>} </span><span>// ptr ææ„ â†’ è‡ªåŠ¨ delete Entity</span></code></pre></div></div></pre>

è¿™æ‰æ˜¯æ™ºèƒ½æŒ‡é’ˆçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼ğŸ‘

å¦‚æœä½ çœ‹åˆ°æœ‰äººè¯´â€œç”¨æ™ºèƒ½æŒ‡é’ˆä»£æ›¿æ‰€æœ‰æŒ‡é’ˆâ€ï¼Œè®°ä½ï¼š**å®ƒæ›¿ä»£çš„æ˜¯â€œæ‰‹åŠ¨ç®¡ç†å †å†…å­˜çš„åŸå§‹æŒ‡é’ˆâ€**ï¼Œè€Œä¸æ˜¯è¯´â€œæ‰€æœ‰å¯¹è±¡éƒ½è¦ä¸Šå †â€ã€‚æ ˆå¯¹è±¡ä¾ç„¶é«˜æ•ˆã€å®‰å…¨ã€é¦–é€‰ã€‚
