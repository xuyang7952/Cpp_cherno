# C++ å¯¹è±¡ç”Ÿå­˜æœŸï¼ˆæ ˆä½œç”¨åŸŸç”Ÿå­˜æœŸï¼‰å…¨é¢æ€»ç»“

### ä¸€ã€æ ¸å¿ƒæ¦‚å¿µï¼ˆå›¾ç‰‡1ã€2ï¼‰

#### 1. **æ ˆä½œç”¨åŸŸç”Ÿå­˜æœŸçš„æœ¬è´¨**

* **ç±»æ¯”**ï¼šå°±åƒæŠŠä¹¦æ”¾åˆ°ä¹¦æ¶ä¸Šï¼Œä½œç”¨åŸŸç»“æŸæ—¶ä¹¦è¢«æ‰”æ‰ï¼ˆå›¾ç‰‡1çš„ä¹¦ç±æ¯”å–»ï¼‰
* **è‡ªåŠ¨ç®¡ç†**ï¼šæ ˆä¸Šå¯¹è±¡åœ¨ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨é”€æ¯
* **ç¡®å®šæ€§**ï¼šç”Ÿå­˜æœŸå®Œå…¨ç”±ä»£ç ç»“æ„å†³å®šï¼Œå¯é¢„æµ‹

#### 2. **åŸºæœ¬ç¤ºä¾‹ï¼ˆå›¾ç‰‡1ä»£ç ï¼‰**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class Entity {
public:
    Entity() { std::cout << "Created Entity\n"; }
    ~Entity() { std::cout << "Destroyed Entity\n"; }
};

int main() {
    { // å¼€å§‹ä½œç”¨åŸŸ
        Entity e;  // æ ˆä¸Šåˆ›å»º
    } // ç»“æŸä½œç”¨åŸŸï¼Œeè‡ªåŠ¨é”€æ¯
  
    return 0;
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

**è¾“å‡º**ï¼š

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-markdown">Created Entity
Destroyed Entity</code></div></div></pre></div></pre>

## äºŒã€å¸¸è§é—®é¢˜ä¸é™·é˜±ï¼ˆå›¾ç‰‡2ã€3ï¼‰

### 1. **è¿”å›å±€éƒ¨å˜é‡æŒ‡é’ˆçš„é”™è¯¯ï¼ˆå›¾ç‰‡2ï¼‰**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">// âŒ é”™è¯¯ç¤ºä¾‹
int* CreateArray() {
    int array[50];  // æ ˆä¸Šåˆ†é…
    return array;   // è¿”å›æŒ‡å‘å³å°†é”€æ¯å†…å­˜çš„æŒ‡é’ˆï¼
}

int main() {
    int* a = CreateArray();  // æ‚¬ç©ºæŒ‡é’ˆï¼
    // aæŒ‡å‘çš„å†…å­˜å·²è¢«é‡Šæ”¾
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 2. **æ­£ç¡®è§£å†³æ–¹æ¡ˆï¼ˆå›¾ç‰‡3ï¼‰**

#### æ–¹æ¡ˆAï¼šå †ä¸Šåˆ†é…

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">int* CreateArray() {
    int* array = new int[50];  // å †ä¸Šåˆ†é…
    return array;  // å®‰å…¨ï¼šç”Ÿå­˜æœŸä¸å—ä½œç”¨åŸŸé™åˆ¶
}

int main() {
    int* a = CreateArray();
    // ä½¿ç”¨åå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼
    delete[] a;
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

#### æ–¹æ¡ˆBï¼šä¼ å…¥å¤–éƒ¨æ•°ç»„

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">void CreateArray(int* array) {
    // å¡«å……å·²å­˜åœ¨çš„æ•°ç»„
}

int main() {
    int array[50];  // åœ¨è°ƒç”¨è€…ä½œç”¨åŸŸå†…
    CreateArray(array);  // ä¼ é€’æŒ‡é’ˆï¼Œä¸æ¶‰åŠç”Ÿå­˜æœŸé—®é¢˜
}</code></div><div class="hyc-code-scrollbar__track"><br class="Apple-interchange-newline"/></div></div></pre></div></pre>

## ä¸‰ã€åˆ©ç”¨æ ˆç”Ÿå­˜æœŸçš„æ™ºèƒ½æ¨¡å¼ï¼ˆå›¾ç‰‡4ï¼‰

### 1. **ä½œç”¨åŸŸæŒ‡é’ˆï¼ˆScoped Pointerï¼‰**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class ScopedPtr {
private:
    Entity* m_Ptr;
public:
    ScopedPtr(Entity* ptr) : m_Ptr(ptr) {}
    ~ScopedPtr() { delete m_Ptr; }  // è‡ªåŠ¨é‡Šæ”¾ï¼
};

int main() {
    {
        ScopedPtr e = new Entity();  // å †åˆ†é…ï¼Œä½†è‡ªåŠ¨ç®¡ç†
    } // ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨è°ƒç”¨delete
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

**è¾“å‡º**ï¼š

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-markdown">Created Entity
Destroyed Entity  // è‡ªåŠ¨è°ƒç”¨ï¼</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 2. **å®é™…åº”ç”¨åœºæ™¯ï¼ˆå›¾ç‰‡4ï¼‰**

#### ğŸ•’ è®¡æ—¶å™¨ï¼ˆTimerï¼‰

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class Timer {
public:
    Timer() { start = std::chrono::high_resolution_clock::now(); }
    ~Timer() {
        auto end = std::chrono::high_resolution_clock::now();
        auto duration = end - start;
        std::cout << "è€—æ—¶: " << duration.count() << "ns\n";
    }
private:
    std::chrono::time_point<std::chrono::high_resolution_clock> start;
};

void expensiveFunction() {
    Timer timer;  // æ„é€ æ—¶å¼€å§‹è®¡æ—¶
    // æ‰§è¡Œæ˜‚è´µæ“ä½œ...
} // ææ„æ—¶è‡ªåŠ¨æ‰“å°è€—æ—¶</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

#### ğŸ”’ äº’æ–¥é”ï¼ˆMutex Lockingï¼‰

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class ScopedLock {
public:
    ScopedLock(std::mutex& mtx) : mutex(mtx) { mutex.lock(); }
    ~ScopedLock() { mutex.unlock(); }
private:
    std::mutex& mutex;
};

std::mutex g_mutex;

void threadSafeFunction() {
    ScopedLock lock(g_mutex);  // è‡ªåŠ¨åŠ é”
    // ä¸´ç•ŒåŒºä»£ç ...
} // è‡ªåŠ¨è§£é”ï¼Œå³ä½¿å¼‚å¸¸ä¹Ÿèƒ½ä¿è¯è§£é”ï¼</code></div></div></pre></div></pre>

## å››ã€æ ˆç”Ÿå­˜æœŸ vs å †ç”Ÿå­˜æœŸå¯¹æ¯”


| **ç‰¹æ€§**     | **æ ˆç”Ÿå­˜æœŸ**       | **å †ç”Ÿå­˜æœŸ**       |
| ------------ | ------------------ | ------------------ |
| **ç®¡ç†æ–¹å¼** | è‡ªåŠ¨ï¼ˆä½œç”¨åŸŸç»“æŸï¼‰ | æ‰‹åŠ¨ï¼ˆnew/deleteï¼‰ |
| **æ€§èƒ½**     | å¿«é€Ÿï¼ˆç§»åŠ¨æ ˆæŒ‡é’ˆï¼‰ | è¾ƒæ…¢ï¼ˆç³»ç»Ÿè°ƒç”¨ï¼‰   |
| **å®‰å…¨æ€§**   | é«˜ï¼ˆæ— å†…å­˜æ³„æ¼ï¼‰   | ä½ï¼ˆéœ€æ‰‹åŠ¨ç®¡ç†ï¼‰   |
| **çµæ´»æ€§**   | å›ºå®šå¤§å°/ç”Ÿå­˜æœŸ    | åŠ¨æ€å¤§å°/ç”Ÿå­˜æœŸ    |
| **é€‚ç”¨åœºæ™¯** | å±€éƒ¨ä¸´æ—¶å¯¹è±¡       | é•¿æœŸå­˜åœ¨çš„å¤§å¯¹è±¡   |

---

## ğŸ’¡ äº”ã€ç°ä»£C++çš„æœ€ä½³å®è·µ

### 1. **ä¼˜å…ˆä½¿ç”¨æ ˆå¯¹è±¡**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">// âœ… æ¨èï¼šæ ˆä¸Šå°å¯¹è±¡
void processData() {
    std::vector<int> data(1000);  // æ ˆä¸Švectorï¼ˆå…ƒç´ åœ¨å †ï¼Œæ§åˆ¶å—åœ¨æ ˆï¼‰
    // ä½¿ç”¨æ•°æ®...
} // è‡ªåŠ¨æ¸…ç†ï¼Œæ— å†…å­˜æ³„æ¼é£é™©</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 2. **ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ›¿ä»£è£¸new/delete**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">#include <memory>

void modernApproach() {
    // ç±»ä¼¼å›¾ç‰‡4çš„ScopedPtrï¼Œä½†æ›´å®‰å…¨
    auto ptr = std::make_unique<Entity>();  // C++11æ™ºèƒ½æŒ‡é’ˆ
    // æ— éœ€æ‰‹åŠ¨deleteï¼Œç¦»å¼€ä½œç”¨åŸŸè‡ªåŠ¨é‡Šæ”¾
}</code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### 3. **RAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰æ¨¡å¼**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="hyc-common-markdown__code__hd"></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-cpp">class FileHandler {
public:
    FileHandler(const std::string& filename) : file(std::fopen(filename.c_str(), "r")) {}
    ~FileHandler() { if (file) std::fclose(file); }
private:
    FILE* file;
};

void readFile() {
    FileHandler fh("data.txt");  // è‡ªåŠ¨æ‰“å¼€æ–‡ä»¶
    // ä½¿ç”¨æ–‡ä»¶...
} // è‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼</code></div></div></pre></div></pre>

## å…­ã€å…³é”®æ€»ç»“

### 1. **æ ˆç”Ÿå­˜æœŸçš„æ ¸å¿ƒä¼˜åŠ¿**

* **è‡ªåŠ¨ç®¡ç†**ï¼šé¿å…å†…å­˜æ³„æ¼
* **æ€§èƒ½ä¼˜å¼‚**ï¼šåˆ†é…/é‡Šæ”¾æå¿«
* **å¼‚å¸¸å®‰å…¨**ï¼šå³ä½¿æŠ›å‡ºå¼‚å¸¸ä¹Ÿèƒ½ä¿è¯æ¸…ç†
* **å¯é¢„æµ‹æ€§**ï¼šç”Ÿå­˜æœŸä¸ä»£ç ç»“æ„å¯¹åº”

### 2. **é€‚ç”¨åœºæ™¯**

* **çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡**ï¼šå‡½æ•°å†…ä¸´æ—¶å˜é‡
* **èµ„æºç®¡ç†ç±»**ï¼šé”ã€æ–‡ä»¶å¥æŸ„ã€è®¡æ—¶å™¨
* **æ€§èƒ½æ•æ„Ÿä»£ç **ï¼šé¿å…ä¸å¿…è¦çš„å †åˆ†é…

### 3. **è®¾è®¡åŸåˆ™**

> "åŸºäºæ ˆçš„å˜é‡åœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é”€æ¯ï¼Œè¿™ä¸€ç‰¹æ€§æ˜¯C++ RAIIç†å¿µçš„åŸºçŸ³ï¼Œä¹Ÿæ˜¯ç¼–å†™å®‰å…¨ã€é«˜æ•ˆC++ä»£ç çš„å…³é”®ã€‚"

### 4. **ç°ä»£å‘å±•**

å›¾ç‰‡4ä¸­çš„`ScopedPtr`å®é™…ä¸Šæ˜¯ç°ä»£`std::unique_ptr`çš„åŸå‹ï¼Œä½“ç°äº†C++"èµ„æºç®¡ç†åº”ä¸å¯¹è±¡ç”Ÿå­˜æœŸç»‘å®š"çš„æ ¸å¿ƒå“²å­¦ã€‚
