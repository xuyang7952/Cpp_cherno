# C++ åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkingï¼‰


## ä¸€ã€ä»€ä¹ˆæ˜¯åŸºå‡†æµ‹è¯•ï¼Ÿ

**åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkingï¼‰** æ˜¯æŒ‡é€šè¿‡ç²¾ç¡®è®¡æ—¶ï¼Œ**æµ‹é‡ä¸€æ®µä»£ç çš„å®é™…æ‰§è¡Œæ—¶é—´**ï¼Œç”¨äºï¼š

* æ¯”è¾ƒä¸åŒå®ç°çš„æ€§èƒ½ï¼ˆå¦‚ `vector` vs `list`ï¼‰
* éªŒè¯ä¼˜åŒ–æ˜¯å¦æœ‰æ•ˆ
* å‘ç°æ€§èƒ½ç“¶é¢ˆ


## äºŒã€å…³é”®åŸåˆ™ï¼ˆæ¥è‡ª Chernoï¼‰

### 1. **åœ¨ Release æ¨¡å¼ä¸‹æµ‹è¯•**

* Debug æ¨¡å¼åŒ…å«å¤§é‡å®‰å…¨æ£€æŸ¥ã€æ— ä¼˜åŒ–ï¼Œ**ä¸èƒ½åæ˜ çœŸå®æ€§èƒ½**
* ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆå¦‚ `-O2` / `/O2`ï¼‰ä¼šå¤§å¹…æ”¹å˜ä»£ç è¡Œä¸º

### 2. **ç¡®ä¿è¢«æµ‹ä»£ç â€œç¡®å®è¢«æ‰§è¡Œâ€**

* ç¼–è¯‘å™¨å¯èƒ½**ä¼˜åŒ–æ‰â€œæ— ç”¨â€ä»£ç **ï¼ˆå¦‚è®¡ç®—ç»“æœæœªè¢«ä½¿ç”¨ï¼‰
* è§£å†³æ–¹æ¡ˆï¼šå°†ç»“æœè¾“å‡ºã€æˆ–æ ‡è®°ä¸º `volatile`

### 3. **å¤šæ¬¡è¿è¡Œå–å¹³å‡å€¼**

* å•æ¬¡æµ‹é‡å—ç³»ç»Ÿè°ƒåº¦ã€ç¼“å­˜ç­‰å› ç´ å¹²æ‰°
* åº”è¿è¡Œå¤šæ¬¡ï¼ˆå¦‚ 1000 æ¬¡ï¼‰å–å¹³å‡æˆ–ä¸­ä½æ•°

## ä¸‰ã€åŸºç¡€è®¡æ—¶å·¥å…·ï¼š`std::chrono`

C++11 æä¾›é«˜ç²¾åº¦è®¡æ—¶åº“ `<chrono>`ï¼Œæ¨èä½¿ç”¨ `high_resolution_clock`ã€‚

### âœ… æ¨èå°è£…ï¼šä½œç”¨åŸŸè®¡æ—¶å™¨ï¼ˆScope Timerï¼‰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><iostream></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><chrono></span><span>
</span>
<span></span><span class="token">class</span><span> </span><span class="token">Timer</span><span> </span><span class="token">{</span><span>
</span><span></span><span class="token">public</span><span class="token">:</span><span>
</span><span>    </span><span class="token">Timer</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        m_Start </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    </span><span class="token">~</span><span class="token">Timer</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        </span><span class="token">auto</span><span> end </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">auto</span><span> duration </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span class="token generic-function">duration_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">chrono</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">microseconds</span><span class="token generic-function generic">></span><span class="token">(</span><span>end </span><span class="token">-</span><span> m_Start</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Elapsed: "</span><span> </span><span class="token"><<</span><span> duration</span><span class="token">.</span><span class="token">count</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">" Âµs ("</span><span> 
</span><span>                  </span><span class="token"><<</span><span> duration</span><span class="token">.</span><span class="token">count</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">/</span><span> </span><span class="token">1000.0</span><span> </span><span class="token"><<</span><span> </span><span class="token">" ms)\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span></span><span class="token">private</span><span class="token">:</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>time_point</span><span class="token"><</span><span>std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token">></span><span> m_Start</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span class="token">;</span></code></pre></div></div></pre>

> ğŸ’¡ ä½¿ç”¨æ–¹å¼ï¼šåˆ›å»º `Timer` å¯¹è±¡ï¼Œå…¶ææ„æ—¶è‡ªåŠ¨æ‰“å°è€—æ—¶ã€‚



## å››ã€å®Œæ•´å¯è¿è¡ŒåŸºå‡†æµ‹è¯•ç¤ºä¾‹

ä»¥ä¸‹ä»£ç æ¼”ç¤ºï¼š

1. å¦‚ä½•é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æ‰è¢«æµ‹ä»£ç 
2. æ¯”è¾ƒä¸¤ç§å¾ªç¯å†™æ³•çš„æ€§èƒ½
3. åœ¨ Release æ¨¡å¼ä¸‹è¿è¡Œæ‰æœ‰æ„ä¹‰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><iostream></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><vector></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><chrono></span><span>
</span>
<span></span><span class="token">// ä½œç”¨åŸŸè®¡æ—¶å™¨</span><span>
</span><span></span><span class="token">class</span><span> </span><span class="token">Timer</span><span> </span><span class="token">{</span><span>
</span><span></span><span class="token">public</span><span class="token">:</span><span>
</span><span>    </span><span class="token">Timer</span><span class="token">(</span><span class="token">const</span><span> </span><span class="token">char</span><span class="token">*</span><span> name</span><span class="token">)</span><span> </span><span class="token">:</span><span> </span><span class="token">m_Name</span><span class="token">(</span><span>name</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        m_Start </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    </span><span class="token">~</span><span class="token">Timer</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        </span><span class="token">auto</span><span> end </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">auto</span><span> duration </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span class="token generic-function">duration_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">chrono</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">microseconds</span><span class="token generic-function generic">></span><span class="token">(</span><span>end </span><span class="token">-</span><span> m_Start</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"["</span><span> </span><span class="token"><<</span><span> m_Name </span><span class="token"><<</span><span> </span><span class="token">"] Elapsed: "</span><span> 
</span><span>                  </span><span class="token"><<</span><span> duration</span><span class="token">.</span><span class="token">count</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">" Âµs\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span></span><span class="token">private</span><span class="token">:</span><span>
</span><span>    </span><span class="token">const</span><span> </span><span class="token">char</span><span class="token">*</span><span> m_Name</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>time_point</span><span class="token"><</span><span>std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token">></span><span> m_Start</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span class="token">;</span><span>
</span>
<span></span><span class="token">// é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–ï¼šå£°æ˜ä¸º volatile æˆ–è¾“å‡ºç»“æœ</span><span>
</span><span></span><span class="token">template</span><span class="token"><</span><span class="token">typename</span><span> </span><span class="token">T</span><span class="token">></span><span>
</span><span></span><span class="token">void</span><span> </span><span class="token">doNotOptimizeAway</span><span class="token">(</span><span>T</span><span class="token">&&</span><span> value</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">// ç®€å•æ–¹æ¡ˆï¼šè¾“å‡ºåˆ° cerrï¼ˆä¸å½±å“ stdoutï¼‰</span><span>
</span><span>    </span><span class="token generic-function">static_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">void</span><span class="token generic-function generic">></span><span class="token">(</span><span>value</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// é˜²æ­¢ warning</span><span>
</span><span>    </span><span class="token">// æ›´ä¸¥è°¨å¯ç”¨ Google Benchmark çš„ DoNotOptimize</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">int</span><span> </span><span class="token">main</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">constexpr</span><span> </span><span class="token">int</span><span> N </span><span class="token">=</span><span> </span><span class="token">1000000</span><span class="token">;</span><span>
</span>
<span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"=== æµ‹è¯•1ï¼šç®€å•ç´¯åŠ  ===\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">{</span><span>
</span><span>        Timer </span><span class="token">t</span><span class="token">(</span><span class="token">"Accumulate"</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">volatile</span><span> </span><span class="token">long</span><span> </span><span class="token">long</span><span> sum </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span> </span><span class="token">// volatile é˜²æ­¢ä¼˜åŒ–</span><span>
</span><span>        </span><span class="token">for</span><span> </span><span class="token">(</span><span class="token">int</span><span> i </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span> i </span><span class="token"><</span><span> N</span><span class="token">;</span><span> </span><span class="token">++</span><span>i</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>            sum </span><span class="token">+=</span><span> i</span><span class="token">;</span><span>
</span><span>        </span><span class="token">}</span><span>
</span><span>        </span><span class="token">doNotOptimizeAway</span><span class="token">(</span><span>sum</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// ç¡®ä¿ sum è¢«â€œä½¿ç”¨â€</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"\n=== æµ‹è¯•2ï¼šstd::vector push_back ===\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">{</span><span>
</span><span>        Timer </span><span class="token">t</span><span class="token">(</span><span class="token">"Vector Push"</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>vector</span><span class="token"><</span><span class="token">int</span><span class="token">></span><span> vec</span><span class="token">;</span><span>
</span><span>        vec</span><span class="token">.</span><span class="token">reserve</span><span class="token">(</span><span>N</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// é¿å…é‡å¤åˆ†é…</span><span>
</span><span>        </span><span class="token">for</span><span> </span><span class="token">(</span><span class="token">int</span><span> i </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span> i </span><span class="token"><</span><span> N</span><span class="token">;</span><span> </span><span class="token">++</span><span>i</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>            vec</span><span class="token">.</span><span class="token">push_back</span><span class="token">(</span><span>i</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">}</span><span>
</span><span>        </span><span class="token">doNotOptimizeAway</span><span class="token">(</span><span>vec</span><span class="token">.</span><span class="token">size</span><span class="token">(</span><span class="token">)</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"\n=== æµ‹è¯•3ï¼šæœª reserve çš„ vector ===\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">{</span><span>
</span><span>        Timer </span><span class="token">t</span><span class="token">(</span><span class="token">"Vector No Reserve"</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>vector</span><span class="token"><</span><span class="token">int</span><span class="token">></span><span> vec</span><span class="token">;</span><span>
</span><span>        </span><span class="token">for</span><span> </span><span class="token">(</span><span class="token">int</span><span> i </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span> i </span><span class="token"><</span><span> N</span><span class="token">;</span><span> </span><span class="token">++</span><span>i</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>            vec</span><span class="token">.</span><span class="token">push_back</span><span class="token">(</span><span>i</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">}</span><span>
</span><span>        </span><span class="token">doNotOptimizeAway</span><span class="token">(</span><span>vec</span><span class="token">.</span><span class="token">size</span><span class="token">(</span><span class="token">)</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    </span><span class="token">return</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span></code></pre></div></div></pre>


## äº”ã€ç¼–è¯‘ä¸è¿è¡Œå»ºè®®

### ğŸ”§ ç¼–è¯‘å‘½ä»¤ï¼ˆå¯ç”¨ä¼˜åŒ–ï¼ï¼‰ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span class="token"># GCC / Clang</span><span>
</span><span>g++ -O2 -std</span><span class="token">=</span><span>c++17 benchmark_demo.cpp -o benchmark_demo
</span>
<span></span><span class="token"># MSVC (Visual Studio)</span><span>
</span><span></span><span class="token"># é¡¹ç›®å±æ€§ â†’ C/C++ â†’ Optimization â†’ Maximize Speed (/O2)</span></code></pre></div></div></pre>

### ğŸ“Š å…¸å‹è¾“å‡ºï¼ˆRelease æ¨¡å¼ï¼‰ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span>=== æµ‹è¯•1ï¼šç®€å•ç´¯åŠ  ===
</span>[Accumulate] Elapsed: 180 Âµs

=== æµ‹è¯•2ï¼šstd::vector push_back ===
[Vector Push] Elapsed: 320 Âµs

=== æµ‹è¯•3ï¼šæœª reserve çš„ vector ===
[Vector No Reserve] Elapsed: 450 Âµs</code></pre></div></div></pre>

> âœ… å¯è§ `reserve()` æ˜¾è‘—å‡å°‘å†…å­˜é‡åˆ†é…å¼€é”€ã€‚


## å…­ã€é«˜çº§å»ºè®®ï¼ˆæ¥è‡ª Chernoï¼‰


| æŠ€å·§              | è¯´æ˜                                     |
| ----------------- | ---------------------------------------- |
| **é¿å… I/O å¹²æ‰°** | ä¸è¦åœ¨è¢«æµ‹ä»£ç ä¸­`cout`ï¼Œä¼šæå¤§æ‹–æ…¢é€Ÿåº¦   |
| **é¢„çƒ­ç¼“å­˜**      | å…ˆè¿è¡Œä¸€æ¬¡â€œçƒ­èº«â€ï¼Œå†æ­£å¼è®¡æ—¶ï¼ˆå¯é€‰ï¼‰   |
| **ä½¿ç”¨ä¸“ä¸šåº“**    | å¤æ‚åœºæ™¯æ¨è[Google Benchmark]()         |
| **å…³æ³¨ç›¸å¯¹æ€§èƒ½**  | ç»å¯¹æ—¶é—´å—ç¡¬ä»¶å½±å“ï¼Œé‡ç‚¹çœ‹ A vs B çš„æ¯”å€¼ |


## ä¸ƒã€å¸¸è§é™·é˜±


| é™·é˜±                   | åæœ                   | è§£å†³æ–¹æ¡ˆ                            |
| ---------------------- | ---------------------- | ----------------------------------- |
| åœ¨ Debug æ¨¡å¼æµ‹è¯•      | æ—¶é—´è™šé«˜ï¼Œç»“è®ºé”™è¯¯     | **åŠ¡å¿…ç”¨ Release**                  |
| ç»“æœæœªè¢«ä½¿ç”¨           | ç¼–è¯‘å™¨ç›´æ¥åˆ é™¤æ•´ä¸ªå¾ªç¯ | ç”¨`volatile` æˆ– `doNotOptimizeAway` |
| å•æ¬¡æµ‹é‡               | æ•°æ®æ³¢åŠ¨å¤§             | å¤šæ¬¡è¿è¡Œå–å¹³å‡                      |
| åŒ…å«æ— å…³æ“ä½œï¼ˆå¦‚æ‰“å°ï¼‰ | æµ‹çš„æ˜¯ I/O ä¸æ˜¯ç®—æ³•    | å°†`cout` ç§»å‡ºè®¡æ—¶èŒƒå›´               |


## âœ… æ€»ç»“

* **åŸºå‡†æµ‹è¯• = ç²¾ç¡®è®¡æ—¶ + é˜²æ­¢ä¼˜åŒ– + Release æ¨¡å¼**
* ä½¿ç”¨ `std::chrono` å’Œä½œç”¨åŸŸ `Timer` ç±»ç®€åŒ–æµ‹é‡
* **æ°¸è¿œä¸è¦ç›¸ä¿¡â€œæˆ‘è§‰å¾—å¿«â€â€”â€”ç”¨æ•°æ®è¯´è¯**
* ç®€å•åœºæ™¯æ‰‹å†™ `Timer` è¶³å¤Ÿï¼Œå¤æ‚é¡¹ç›®ç”¨ **Google Benchmark**
