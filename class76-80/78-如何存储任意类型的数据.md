# å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®std::variant


## æ ¸å¿ƒæ¦‚å¿µï¼š`std::any`

* `std::any` æ˜¯ä¸€ä¸ª**ç±»å‹å®‰å…¨çš„é€šç”¨å®¹å™¨**ï¼Œå¯ä»¥å­˜å‚¨ä»»æ„å•ä¸ªå€¼ã€‚
* å®ƒå†…éƒ¨å¯¹å°å¯¹è±¡ï¼ˆé€šå¸¸ â‰¤32 å­—èŠ‚ï¼‰ä½¿ç”¨æ ˆä¸Šå­˜å‚¨ï¼ˆç±»ä¼¼ `union`ï¼‰ï¼Œå¤§å¯¹è±¡åˆ™åŠ¨æ€åˆ†é…å †å†…å­˜ã€‚
* ä½¿ç”¨ `std::any_cast<T>(any_obj)` æå–å€¼ï¼›è‹¥ç±»å‹ä¸åŒ¹é…ï¼Œä¼šæŠ›å‡º `std::bad_any_cast` å¼‚å¸¸ã€‚
* å¯é€šè¿‡ `any.has_value()` æ£€æŸ¥æ˜¯å¦åŒ…å«å€¼ã€‚

> âš ï¸ æ³¨æ„ï¼š`std::any` çš„çµæ´»æ€§æ˜¯ä»¥**è¿è¡Œæ—¶å¼€é”€å’Œæ½œåœ¨åŠ¨æ€å†…å­˜åˆ†é…**ä¸ºä»£ä»·çš„ã€‚



## ä¸ `std::variant` çš„å¯¹æ¯”


| ç‰¹æ€§     | `std::any`                                         | `std::variant<T1, T2, ...>`                |
| -------- | -------------------------------------------------- | ------------------------------------------ |
| ç±»å‹é™åˆ¶ | âŒ æ— é™åˆ¶ï¼ˆä»»æ„ç±»å‹ï¼‰                              | âœ… å¿…é¡»é¢„å…ˆåˆ—å‡ºæ‰€æœ‰å¯èƒ½ç±»å‹                |
| ç±»å‹å®‰å…¨ | âœ… è¿è¡Œæ—¶æ£€æŸ¥ï¼ˆå¼‚å¸¸ï¼‰                              | âœ… ç¼–è¯‘æ—¶æ£€æŸ¥                              |
| æ€§èƒ½     | âš ï¸ å¯èƒ½å †åˆ†é…ï¼ˆå¤§å¯¹è±¡ï¼‰                          | âœ… æ— å †åˆ†é…ï¼Œæ ˆä¸Šå­˜å‚¨                      |
| é€‚ç”¨åœºæ™¯ | çœŸæ­£â€œæœªçŸ¥ç±»å‹â€çš„æ³›å‹å®¹å™¨ï¼ˆå¦‚æ’ä»¶ç³»ç»Ÿã€è„šæœ¬ç»‘å®šï¼‰ | å·²çŸ¥æœ‰é™ç±»å‹çš„å¤šæ€å€¼ï¼ˆå¦‚è§£æç»“æœã€çŠ¶æ€æœºï¼‰ |

> ğŸ“Œ Cherno è§‚ç‚¹ï¼ˆè§åŸæ–‡ï¼‰ï¼š**ä¼˜å…ˆä½¿ç”¨ `std::variant`**ï¼›ä»…å½“ç¡®å®æ— æ³•é¢„çŸ¥ç±»å‹æ—¶æ‰è€ƒè™‘ `std::any`ã€‚


## ç¤ºä¾‹ï¼šå¯è¿è¡Œä»£ç 

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><iostream></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><any></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><string></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><vector></span><span>
</span>
<span></span><span class="token">int</span><span> </span><span class="token">main</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>any data</span><span class="token">;</span><span>
</span>
<span>    </span><span class="token">// å­˜å‚¨ä¸åŒç±»å‹çš„å€¼</span><span>
</span><span>    data </span><span class="token">=</span><span> </span><span class="token">42</span><span class="token">;</span><span>                          </span><span class="token">// int</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Stored int: "</span><span> </span><span class="token"><<</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">any_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">int</span><span class="token generic-function generic">></span><span class="token">(</span><span>data</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span>
<span>    data </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token">string</span><span class="token">(</span><span class="token">"Hello, any!"</span><span class="token">)</span><span class="token">;</span><span>  </span><span class="token">// std::string</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Stored string: "</span><span> </span><span class="token"><<</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">any_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">string</span><span class="token generic-function generic">></span><span class="token">(</span><span>data</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span>
<span>    data </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>vector</span><span class="token"><</span><span class="token">int</span><span class="token">></span><span class="token">{</span><span class="token">1</span><span class="token">,</span><span> </span><span class="token">2</span><span class="token">,</span><span> </span><span class="token">3</span><span class="token">}</span><span class="token">;</span><span>   </span><span class="token">// std::vector<int></span><span>
</span><span>    </span><span class="token">auto</span><span class="token">&</span><span> vec </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">any_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">vector</span><span class="token generic-function generic"><</span><span class="token generic-function generic">int</span><span class="token generic-function generic">></span><span class="token generic-function generic">&</span><span class="token generic-function generic">></span><span class="token">(</span><span>data</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// ç”¨å¼•ç”¨é¿å…æ‹·è´</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Stored vector: "</span><span class="token">;</span><span>
</span><span>    </span><span class="token">for</span><span> </span><span class="token">(</span><span class="token">int</span><span> v </span><span class="token">:</span><span> vec</span><span class="token">)</span><span> std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> v </span><span class="token"><<</span><span> </span><span class="token">" "</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span>
<span>    </span><span class="token">// å®‰å…¨è®¿é—®ï¼šé¿å…å¼‚å¸¸</span><span>
</span><span>    </span><span class="token">if</span><span> </span><span class="token">(</span><span>data</span><span class="token">.</span><span class="token">type</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">==</span><span> </span><span class="token">typeid</span><span class="token">(</span><span>std</span><span class="token double-colon">::</span><span>vector</span><span class="token"><</span><span class="token">int</span><span class="token">></span><span class="token">)</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        </span><span class="token">const</span><span> </span><span class="token">auto</span><span class="token">&</span><span> safe_vec </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">any_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">const</span><span class="token generic-function generic"> std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">vector</span><span class="token generic-function generic"><</span><span class="token generic-function generic">int</span><span class="token generic-function generic">></span><span class="token generic-function generic">&</span><span class="token generic-function generic">></span><span class="token">(</span><span>data</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Safely accessed vector size: "</span><span> </span><span class="token"><<</span><span> safe_vec</span><span class="token">.</span><span class="token">size</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    </span><span class="token">// æ¸…ç©º</span><span>
</span><span>    data</span><span class="token">.</span><span class="token">reset</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Has value after reset? "</span><span> </span><span class="token"><<</span><span> std</span><span class="token double-colon">::</span><span>boolalpha </span><span class="token"><<</span><span> data</span><span class="token">.</span><span class="token">has_value</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span>
<span>    </span><span class="token">// é”™è¯¯ç¤ºä¾‹ï¼šç±»å‹ä¸åŒ¹é…ï¼ˆä¼šæŠ›å¼‚å¸¸ï¼‰</span><span>
</span><span>    </span><span class="token">try</span><span> </span><span class="token">{</span><span>
</span><span>        data </span><span class="token">=</span><span> </span><span class="token">3.14</span><span class="token">;</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span class="token generic-function">any_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">int</span><span class="token generic-function generic">></span><span class="token">(</span><span>data</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// å°è¯•æŠŠ double å½“ int è¯»</span><span>
</span><span>    </span><span class="token">}</span><span> </span><span class="token">catch</span><span> </span><span class="token">(</span><span class="token">const</span><span> std</span><span class="token double-colon">::</span><span>bad_any_cast</span><span class="token">&</span><span> e</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Caught exception: "</span><span> </span><span class="token"><<</span><span> e</span><span class="token">.</span><span class="token">what</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    </span><span class="token">return</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span></code></pre></div></div></pre>

### ğŸ”¸ è¾“å‡ºç¤ºä¾‹ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span>Stored int: 42
</span>Stored string: Hello, any!
Stored vector: 1 2 3 
Safely accessed vector size: 3
Has value after reset? false
Caught exception: bad any_cast</code></pre></div></div></pre>
