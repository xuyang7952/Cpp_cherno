# std::variant


## æ ¸å¿ƒæ¦‚å¿µï¼š`std::variant`

* `std::variant<T1, T2, ..., TN>` è¡¨ç¤ºä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼åªèƒ½æ˜¯ `T1` åˆ° `TN` ä¸­çš„ä¸€ç§ã€‚
* å®ƒå†…éƒ¨ä¼šè‡ªåŠ¨ç®¡ç†å½“å‰å­˜å‚¨çš„æ˜¯å“ªç§ç±»å‹ã€‚
* è®¿é—®æ—¶éœ€æ˜ç¡®æŒ‡å®šç±»å‹ï¼Œå¦åˆ™å¯èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚
* æ”¯æŒé€šè¿‡ `std::get_if` å®‰å…¨è®¿é—®ï¼Œé¿å…å¼‚å¸¸ã€‚


## ä¸ `union` çš„åŒºåˆ«


| ç‰¹æ€§                              | `union`                     | `std::variant`                     |
| --------------------------------- | --------------------------- | ---------------------------------- |
| ç±»å‹å®‰å…¨                          | âŒ ä¸å®‰å…¨ï¼ˆéœ€æ‰‹åŠ¨è·Ÿè¸ªç±»å‹ï¼‰ | âœ… å®‰å…¨ï¼ˆè‡ªåŠ¨è®°å½•å½“å‰ç±»å‹ï¼‰        |
| æ”¯æŒéå¹³å‡¡ç±»å‹ï¼ˆå¦‚`std::string`ï¼‰ | âŒ ä¸èƒ½ï¼ˆææ„/æ„é€ é—®é¢˜ï¼‰    | âœ… å¯ä»¥                            |
| å†…å­˜å ç”¨                          | æœ€å¤§æˆå‘˜å¤§å°                | ç•¥å¤§äºæœ€å¤§æˆå‘˜ï¼ˆé¢å¤–å­˜å‚¨ç±»å‹ç´¢å¼•ï¼‰ |
| ä½¿ç”¨éš¾åº¦                          | é«˜ï¼ˆæ˜“å‡ºé”™ï¼‰                | ä½ï¼ˆç°ä»£ C++ æ¨èï¼‰                |

> é™¤éå¯¹å†…å­˜æåº¦æ•æ„Ÿï¼ˆå¦‚åµŒå…¥å¼ã€é«˜é¢‘äº¤æ˜“ï¼‰ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨ `std::variant`ã€‚
>


## ç¤ºä¾‹ï¼šå¯è¿è¡Œä»£ç 

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><iostream></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><variant></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><string></span><span>
</span>
<span></span><span class="token">// æ¨¡æ‹Ÿè¯»å–æ–‡ä»¶ï¼šæˆåŠŸè¿”å›å†…å®¹ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç </span><span>
</span><span></span><span class="token">enum</span><span> </span><span class="token">class</span><span> </span><span class="token">ErrorCode</span><span> </span><span class="token">{</span><span>
</span><span>    None </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">,</span><span>
</span><span>    NotFound </span><span class="token">=</span><span> </span><span class="token">1</span><span class="token">,</span><span>
</span><span>    NoAccess </span><span class="token">=</span><span> </span><span class="token">2</span><span>
</span><span></span><span class="token">}</span><span class="token">;</span><span>
</span>
<span>std</span><span class="token double-colon">::</span><span>variant</span><span class="token"><</span><span>std</span><span class="token double-colon">::</span><span>string</span><span class="token">,</span><span> ErrorCode</span><span class="token">></span><span> </span><span class="token">ReadFileAsString</span><span class="token">(</span><span class="token">bool</span><span> success</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">if</span><span> </span><span class="token">(</span><span class="token">!</span><span>success</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        </span><span class="token">return</span><span> ErrorCode</span><span class="token double-colon">::</span><span>NotFound</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span><span>    </span><span class="token">return</span><span> std</span><span class="token double-colon">::</span><span class="token">string</span><span class="token">(</span><span class="token">"Hello, Cherno!"</span><span class="token">)</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">int</span><span> </span><span class="token">main</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">// 1. åŸºæœ¬ç”¨æ³•ï¼šå­˜å‚¨ä¸åŒç±»å‹çš„å€¼</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>variant</span><span class="token"><</span><span>std</span><span class="token double-colon">::</span><span>string</span><span class="token">,</span><span> </span><span class="token">int</span><span class="token">></span><span> data</span><span class="token">;</span><span>
</span>
<span>    data </span><span class="token">=</span><span> </span><span class="token">"Cherno"</span><span class="token">;</span><span>  </span><span class="token">// èµ‹å€¼ä¸º string</span><span>
</span><span>    </span><span class="token">if</span><span> </span><span class="token">(</span><span class="token">auto</span><span class="token">*</span><span> str </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">get_if</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">string</span><span class="token generic-function generic">></span><span class="token">(</span><span class="token">&</span><span>data</span><span class="token">)</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"String: "</span><span> </span><span class="token"><<</span><span> </span><span class="token">*</span><span>str </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    data </span><span class="token">=</span><span> </span><span class="token">42</span><span class="token">;</span><span>  </span><span class="token">// èµ‹å€¼ä¸º int</span><span>
</span><span>    </span><span class="token">if</span><span> </span><span class="token">(</span><span class="token">auto</span><span class="token">*</span><span> num </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">get_if</span><span class="token generic-function generic"><</span><span class="token generic-function generic">int</span><span class="token generic-function generic">></span><span class="token">(</span><span class="token">&</span><span>data</span><span class="token">)</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Number: "</span><span> </span><span class="token"><<</span><span> </span><span class="token">*</span><span>num </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    </span><span class="token">// 2. å®é™…åº”ç”¨ï¼šå‡½æ•°è¿”å›å¤šç±»å‹ç»“æœ</span><span>
</span><span>    </span><span class="token">auto</span><span> result </span><span class="token">=</span><span> </span><span class="token">ReadFileAsString</span><span class="token">(</span><span class="token">false</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// æ¨¡æ‹Ÿå¤±è´¥</span><span>
</span>
<span>    </span><span class="token">if</span><span> </span><span class="token">(</span><span class="token">auto</span><span class="token">*</span><span> err </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">get_if</span><span class="token generic-function generic"><</span><span class="token generic-function generic">ErrorCode</span><span class="token generic-function generic">></span><span class="token">(</span><span class="token">&</span><span>result</span><span class="token">)</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Error occurred: code "</span><span> </span><span class="token"><<</span><span> </span><span class="token generic-function">static_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">int</span><span class="token generic-function generic">></span><span class="token">(</span><span class="token">*</span><span>err</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span> </span><span class="token">else</span><span> </span><span class="token">if</span><span> </span><span class="token">(</span><span class="token">auto</span><span class="token">*</span><span> content </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token generic-function">get_if</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">string</span><span class="token generic-function generic">></span><span class="token">(</span><span class="token">&</span><span>result</span><span class="token">)</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"File content: "</span><span> </span><span class="token"><<</span><span> </span><span class="token">*</span><span>content </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span>
<span>    </span><span class="token">return</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span></code></pre></div></div></pre>

### ğŸ”¸ è¾“å‡ºç¤ºä¾‹ï¼š

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-bRKDuR jCSJQZ"><code><span>String: Cherno
</span>Number: 42
Error occurred: code 1</code></pre></div></div></pre>
