# C++ å¦‚ä½•è®©å­—ç¬¦ä¸²è¿è¡Œå¾—æ›´å¿«


## æ ¸å¿ƒé—®é¢˜ï¼š`std::string` çš„æ€§èƒ½ç“¶é¢ˆ

### âŒ `std::string` çš„ä¸»è¦é—®é¢˜ï¼š

1. **é¢‘ç¹å †å†…å­˜åˆ†é…**ï¼šæ¯æ¬¡åˆ›å»ºã€æ‹·è´ã€æ‹¼æ¥éƒ½å¯èƒ½è§¦å‘ `new`/`malloc`
2. **ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶**ï¼šå³ä½¿åªæ˜¯â€œè¯»å–â€å­ä¸²ï¼Œä¹Ÿä¼šå¤åˆ¶æ•´ä¸ªæ•°æ®
3. **å‡½æ•°å‚æ•°ä¼ é€’å¼€é”€å¤§**ï¼šä¼ å€¼æˆ–ä¼ å¼•ç”¨ä»å¯èƒ½æ„é€ ä¸´æ—¶å¯¹è±¡


## è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `std::string_view`ï¼ˆC++17ï¼‰

### ğŸ”‘ `std::string_view` çš„ä¼˜åŠ¿ï¼š


| ç‰¹æ€§                  | è¯´æ˜                                     |
| --------------------- | ---------------------------------------- |
| **é›¶æ‹·è´**            | åªå­˜å‚¨æŒ‡é’ˆ + é•¿åº¦ï¼Œä¸æ‹¥æœ‰æ•°æ®            |
| **è½»é‡çº§**            | é€šå¸¸åªæœ‰ 16 å­—èŠ‚ï¼ˆæŒ‡é’ˆ 8B + size\_t 8Bï¼‰ |
| **æŒ‰å€¼ä¼ é€’é«˜æ•ˆ**      | æ‹·è´æˆæœ¬ â‰ˆ æ‹·è´ä¸¤ä¸ªæ•´æ•°                 |
| **å…¼å®¹ C é£æ ¼å­—ç¬¦ä¸²** | å¯ç›´æ¥ä»`const char*` æ„é€                |


## å®Œæ•´å¯è¿è¡Œä»£ç ï¼ˆå«æ€§èƒ½å¯¹æ¯”ï¼‰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><iostream></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><string></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><string_view></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><chrono></span><span>
</span><span></span><span class="token macro directive-hash">#</span><span class="token macro">include</span><span class="token macro"> </span><span class="token macro"><vector></span><span>
</span>
<span></span><span class="token">// å…¨å±€è®¡æ•°å™¨ï¼šè·Ÿè¸ªå†…å­˜åˆ†é…æ¬¡æ•°</span><span>
</span><span></span><span class="token">static</span><span> </span><span class="token">uint32_t</span><span> s_AllocCount </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span>
<span></span><span class="token">// é‡è½½ new æ“ä½œç¬¦ä»¥ç›‘æ§å†…å­˜åˆ†é…</span><span>
</span><span></span><span class="token">void</span><span class="token">*</span><span> </span><span class="token">operator</span><span> </span><span class="token">new</span><span class="token">(</span><span>size_t size</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    s_AllocCount</span><span class="token">++</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Allocating "</span><span> </span><span class="token"><<</span><span> size </span><span class="token"><<</span><span> </span><span class="token">" bytes\n"</span><span class="token">;</span><span>
</span><span>    </span><span class="token">return</span><span> </span><span class="token">malloc</span><span class="token">(</span><span>size</span><span class="token">)</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">void</span><span> </span><span class="token">operator</span><span> </span><span class="token">delete</span><span class="token">(</span><span class="token">void</span><span class="token">*</span><span> ptr</span><span class="token">)</span><span> </span><span class="token">noexcept</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">free</span><span class="token">(</span><span>ptr</span><span class="token">)</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">// ä¼ ç»Ÿæ–¹å¼ï¼šä½¿ç”¨ const std::string&</span><span>
</span><span></span><span class="token">void</span><span> </span><span class="token">PrintName_StdString</span><span class="token">(</span><span class="token">const</span><span> std</span><span class="token double-colon">::</span><span>string</span><span class="token">&</span><span> name</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"[std::string] Name: "</span><span> </span><span class="token"><<</span><span> name </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">// æ–°æ–¹å¼ï¼šä½¿ç”¨ std::string_view</span><span>
</span><span></span><span class="token">void</span><span> </span><span class="token">PrintName_StringView</span><span class="token">(</span><span>std</span><span class="token double-colon">::</span><span>string_view name</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"[string_view] Name: "</span><span> </span><span class="token"><<</span><span> name </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">// æ€§èƒ½æµ‹è¯•ï¼šå¤§é‡å­—ç¬¦ä¸²æ“ä½œ</span><span>
</span><span></span><span class="token">void</span><span> </span><span class="token">PerformanceTest</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">const</span><span> std</span><span class="token double-colon">::</span><span>string baseName </span><span class="token">=</span><span> </span><span class="token">"Alexander Chernikov"</span><span class="token">;</span><span>
</span>  
<span>    </span><span class="token">// æµ‹è¯• 1: ç›´æ¥ä¼ é€’å­—é¢é‡</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"\n=== Test 1: Literal string ===\n"</span><span class="token">;</span><span>
</span><span>    s_AllocCount </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span>    </span><span class="token">PrintName_StdString</span><span class="token">(</span><span class="token">"Yan Chernikov"</span><span class="token">)</span><span class="token">;</span><span>  </span><span class="token">// è§¦å‘ä¸€æ¬¡åˆ†é…ï¼</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"std::string allocations: "</span><span> </span><span class="token"><<</span><span> s_AllocCount </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span>  
<span>    s_AllocCount </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span>    </span><span class="token">PrintName_StringView</span><span class="token">(</span><span class="token">"Yan Chernikov"</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// é›¶åˆ†é…ï¼</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"string_view allocations: "</span><span> </span><span class="token"><<</span><span> s_AllocCount </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span>  
<span>    </span><span class="token">// æµ‹è¯• 2: å­ä¸²æ“ä½œ</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"\n=== Test 2: Substring operations ===\n"</span><span class="token">;</span><span>
</span><span>    s_AllocCount </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span>    </span><span class="token">{</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>string firstName </span><span class="token">=</span><span> baseName</span><span class="token">.</span><span class="token">substr</span><span class="token">(</span><span class="token">0</span><span class="token">,</span><span> </span><span class="token">9</span><span class="token">)</span><span class="token">;</span><span>   </span><span class="token">// åˆ†é…</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>string lastName </span><span class="token">=</span><span> baseName</span><span class="token">.</span><span class="token">substr</span><span class="token">(</span><span class="token">10</span><span class="token">,</span><span> </span><span class="token">9</span><span class="token">)</span><span class="token">;</span><span>   </span><span class="token">// åˆ†é…</span><span>
</span><span>        </span><span class="token">PrintName_StdString</span><span class="token">(</span><span>firstName</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">PrintName_StdString</span><span class="token">(</span><span>lastName</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"std::string substr allocations: "</span><span> </span><span class="token"><<</span><span> s_AllocCount </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span>  
<span>    s_AllocCount </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span>    </span><span class="token">{</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>string_view </span><span class="token">firstName</span><span class="token">(</span><span>baseName</span><span class="token">.</span><span class="token">data</span><span class="token">(</span><span class="token">)</span><span class="token">,</span><span> </span><span class="token">9</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        std</span><span class="token double-colon">::</span><span>string_view </span><span class="token">lastName</span><span class="token">(</span><span>baseName</span><span class="token">.</span><span class="token">data</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">+</span><span> </span><span class="token">10</span><span class="token">,</span><span> </span><span class="token">9</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">PrintName_StringView</span><span class="token">(</span><span>firstName</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">PrintName_StringView</span><span class="token">(</span><span>lastName</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"string_view substr allocations: "</span><span> </span><span class="token"><<</span><span> s_AllocCount </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">// å¤§è§„æ¨¡æ€§èƒ½åŸºå‡†æµ‹è¯•</span><span>
</span><span></span><span class="token">void</span><span> </span><span class="token">Benchmark</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">const</span><span> </span><span class="token">int</span><span> N </span><span class="token">=</span><span> </span><span class="token">100000</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>vector</span><span class="token"><</span><span>std</span><span class="token double-colon">::</span><span>string</span><span class="token">></span><span> </span><span class="token">names</span><span class="token">(</span><span>N</span><span class="token">,</span><span> </span><span class="token">"Performance Test String"</span><span class="token">)</span><span class="token">;</span><span>
</span>  
<span>    </span><span class="token">// std::string ç‰ˆæœ¬</span><span>
</span><span>    </span><span class="token">auto</span><span> start </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">for</span><span> </span><span class="token">(</span><span class="token">int</span><span> i </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span> i </span><span class="token"><</span><span> N</span><span class="token">;</span><span> </span><span class="token">++</span><span>i</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        </span><span class="token">PrintName_StdString</span><span class="token">(</span><span>names</span><span class="token">[</span><span>i</span><span class="token">]</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">}</span><span>
</span><span>    </span><span class="token">auto</span><span> end </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">auto</span><span> duration_std </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span class="token generic-function">duration_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">chrono</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">milliseconds</span><span class="token generic-function generic">></span><span class="token">(</span><span>end </span><span class="token">-</span><span> start</span><span class="token">)</span><span class="token">;</span><span>
</span>  
<span>    </span><span class="token">// std::string_view ç‰ˆæœ¬</span><span>
</span><span>    start </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">for</span><span> </span><span class="token">(</span><span class="token">int</span><span> i </span><span class="token">=</span><span> </span><span class="token">0</span><span class="token">;</span><span> i </span><span class="token"><</span><span> N</span><span class="token">;</span><span> </span><span class="token">++</span><span>i</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>        </span><span class="token">PrintName_StringView</span><span class="token">(</span><span>names</span><span class="token">[</span><span>i</span><span class="token">]</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// è‡ªåŠ¨è½¬æ¢ä¸º string_view</span><span>
</span><span>    </span><span class="token">}</span><span>
</span><span>    end </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span>high_resolution_clock</span><span class="token double-colon">::</span><span class="token">now</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">auto</span><span> duration_view </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span>chrono</span><span class="token double-colon">::</span><span class="token generic-function">duration_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">std</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">chrono</span><span class="token generic-function generic double-colon">::</span><span class="token generic-function generic">milliseconds</span><span class="token generic-function generic">></span><span class="token">(</span><span>end </span><span class="token">-</span><span> start</span><span class="token">)</span><span class="token">;</span><span>
</span>  
<span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"\n=== Benchmark Results ("</span><span> </span><span class="token"><<</span><span> N </span><span class="token"><<</span><span> </span><span class="token">" iterations) ===\n"</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"std::string time: "</span><span> </span><span class="token"><<</span><span> duration_std</span><span class="token">.</span><span class="token">count</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">" ms\n"</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"string_view time: "</span><span> </span><span class="token"><<</span><span> duration_view</span><span class="token">.</span><span class="token">count</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">" ms\n"</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Speedup: "</span><span> </span><span class="token"><<</span><span> </span><span class="token generic-function">static_cast</span><span class="token generic-function generic"><</span><span class="token generic-function generic">double</span><span class="token generic-function generic">></span><span class="token">(</span><span>duration_std</span><span class="token">.</span><span class="token">count</span><span class="token">(</span><span class="token">)</span><span class="token">)</span><span> </span><span class="token">/</span><span> duration_view</span><span class="token">.</span><span class="token">count</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token"><<</span><span> </span><span class="token">"x\n"</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">// å®‰å…¨æ³¨æ„äº‹é¡¹ï¼šstring_view ä¸æ‹¥æœ‰æ•°æ®</span><span>
</span><span></span><span class="token">void</span><span> </span><span class="token">SafetyWarning</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"\n=== Safety Warning ===\n"</span><span class="token">;</span><span>
</span>  
<span>    </span><span class="token">// å±é™©ï¼ä¸´æ—¶ string è¢«é”€æ¯åï¼Œstring_view æŒ‡å‘æ— æ•ˆå†…å­˜</span><span>
</span><span>    </span><span class="token">// std::string_view bad_view = std::string("temporary").substr(0, 5); // DON'T DO THIS!</span><span>
</span>  
<span>    </span><span class="token">// æ­£ç¡®åšæ³•ï¼šç¡®ä¿åº•å±‚æ•°æ®ç”Ÿå‘½å‘¨æœŸè¶³å¤Ÿé•¿</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>string persistent </span><span class="token">=</span><span> </span><span class="token">"persistent data"</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>string_view </span><span class="token">good_view</span><span class="token">(</span><span>persistent</span><span class="token">.</span><span class="token">data</span><span class="token">(</span><span class="token">)</span><span class="token">,</span><span> </span><span class="token">5</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"Safe string_view: "</span><span> </span><span class="token"><<</span><span> good_view </span><span class="token"><<</span><span> </span><span class="token">"\n"</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span><span>
</span>
<span></span><span class="token">int</span><span> </span><span class="token">main</span><span class="token">(</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"C++ String Performance Optimization Demo\n"</span><span class="token">;</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>cout </span><span class="token"><<</span><span> </span><span class="token">"========================================\n"</span><span class="token">;</span><span>
</span>  
<span>    </span><span class="token">PerformanceTest</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">Benchmark</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span><span>    </span><span class="token">SafetyWarning</span><span class="token">(</span><span class="token">)</span><span class="token">;</span><span>
</span>  
<span>    </span><span class="token">return</span><span> </span><span class="token">0</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span></code></pre></div></div></pre>


## ä»£ç è¯¦è§£ä¸å…³é”®ç‚¹

### 1. **å†…å­˜åˆ†é…ç›‘æ§**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">void</span><span class="token">*</span><span> </span><span class="token">operator</span><span> </span><span class="token">new</span><span class="token">(</span><span>size_t size</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    s_AllocCount</span><span class="token">++</span><span class="token">;</span><span>  </span><span class="token">// è®¡æ•°æ¯æ¬¡åˆ†é…</span><span>
</span><span>    </span><span class="token">return</span><span> </span><span class="token">malloc</span><span class="token">(</span><span>size</span><span class="token">)</span><span class="token">;</span><span>
</span><span></span><span class="token">}</span></code></pre></div></div></pre>

* é€šè¿‡é‡è½½ `operator new`ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾ç¡®ç»Ÿè®¡å†…å­˜åˆ†é…æ¬¡æ•°
* è¿™æ˜¯ Cherno åœ¨è§†é¢‘ä¸­æ¼”ç¤ºçš„æ ¸å¿ƒæŠ€å·§

### 2. **é›¶åˆ†é…çš„ `string_view`**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">// ä¼ ç»Ÿæ–¹å¼ï¼šå³ä½¿åªæ˜¯è¯»å–ï¼Œä¹Ÿä¼šåˆ†é…å†…å­˜</span><span>
</span><span></span><span class="token">PrintName_StdString</span><span class="token">(</span><span class="token">"literal"</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// æ„é€ ä¸´æ—¶ std::string â†’ åˆ†é…ï¼</span><span>
</span>
<span></span><span class="token">// æ–°æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨å­—é¢é‡</span><span>
</span><span></span><span class="token">PrintName_StringView</span><span class="token">(</span><span class="token">"literal"</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// é›¶åˆ†é…ï¼</span></code></pre></div></div></pre>

### 3. **é«˜æ•ˆçš„å­ä¸²æ“ä½œ**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">// std::string::substr() è¿”å›æ–°å­—ç¬¦ä¸² â†’ å¤åˆ¶æ•°æ®</span><span>
</span><span>std</span><span class="token double-colon">::</span><span>string firstName </span><span class="token">=</span><span> name</span><span class="token">.</span><span class="token">substr</span><span class="token">(</span><span class="token">0</span><span class="token">,</span><span> </span><span class="token">9</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// åˆ†é… + å¤åˆ¶</span><span>
</span>
<span></span><span class="token">// string_view æ„é€ åªè®°å½•æŒ‡é’ˆå’Œé•¿åº¦</span><span>
</span><span>std</span><span class="token double-colon">::</span><span>string_view </span><span class="token">firstName</span><span class="token">(</span><span>name</span><span class="token">.</span><span class="token">data</span><span class="token">(</span><span class="token">)</span><span class="token">,</span><span> </span><span class="token">9</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// é›¶åˆ†é…ï¼</span></code></pre></div></div></pre>

### 4. **è‡ªåŠ¨ç±»å‹è½¬æ¢**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">// string_view æ„é€ å‡½æ•°æ¥å— std::string</span><span>
</span><span></span><span class="token">PrintName_StringView</span><span class="token">(</span><span>someStdString</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// è‡ªåŠ¨è½¬æ¢ï¼Œå®‰å…¨é«˜æ•ˆ</span></code></pre></div></div></pre>


## é¢„æœŸè¾“å‡ºç¤ºä¾‹

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span>C++ String Performance Optimization Demo
</span>========================================

=== Test 1: Literal string ===
Allocating 15 bytes
[std::string] Name: Yan Chernikov
std::string allocations: 1
[string_view] Name: Yan Chernikov
string_view allocations: 0

=== Test 2: Substring operations ===
Allocating 10 bytes
Allocating 10 bytes
[std::string] Name: Alexander
[std::string] Name: Chernikov
std::string substr allocations: 2
[string_view] Name: Alexander
[string_view] Name: Chernikov
string_view substr allocations: 0

=== Benchmark Results (100000 iterations) ===
std::string time: 45 ms
string_view time: 28 ms
Speedup: 1.61x

=== Safety Warning ===
Safe string_view: persi</code></pre></div></div></pre>


## é‡è¦æ³¨æ„äº‹é¡¹ï¼ˆæ¥è‡ª Cherno çš„è­¦å‘Šï¼‰

### 1. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">// âŒ å±é™©ï¼ä¸´æ—¶å¯¹è±¡è¢«é”€æ¯åï¼Œstring_view æ‚¬ç©º</span><span>
</span><span></span><span class="token">auto</span><span> bad </span><span class="token">=</span><span> std</span><span class="token double-colon">::</span><span class="token">string</span><span class="token">(</span><span class="token">"temp"</span><span class="token">)</span><span class="token">.</span><span class="token">substr</span><span class="token">(</span><span class="token">0</span><span class="token">,</span><span> </span><span class="token">4</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// ä¸´æ—¶ string ç«‹å³é”€æ¯</span><span>
</span>
<span></span><span class="token">// âœ… å®‰å…¨ï¼šç¡®ä¿åº•å±‚æ•°æ®å­˜æ´»</span><span>
</span><span>std</span><span class="token double-colon">::</span><span>string data </span><span class="token">=</span><span> </span><span class="token">"persistent"</span><span class="token">;</span><span>
</span><span>std</span><span class="token double-colon">::</span><span>string_view </span><span class="token">safe</span><span class="token">(</span><span>data</span><span class="token">.</span><span class="token">data</span><span class="token">(</span><span class="token">)</span><span class="token">,</span><span> </span><span class="token">4</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// data å­˜æ´»æœŸé—´ safe æœ‰æ•ˆ</span></code></pre></div></div></pre>

### 2. **ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½é€‚ç”¨**

* **éœ€è¦ä¿®æ”¹å­—ç¬¦ä¸²**ï¼šä»éœ€ `std::string`
* **éœ€è¦é•¿æœŸæŒæœ‰æ•°æ®**ï¼š`string_view` åªæ˜¯è§†å›¾ï¼Œä¸æ‹¥æœ‰æ•°æ®
* **C++14 åŠä»¥ä¸‹**ï¼šéœ€è¦è‡ªå·±å®ç°ç±»ä¼¼åŠŸèƒ½æˆ–ä½¿ç”¨ `boost::string_view`

### 3. **å°å­—ç¬¦ä¸²ä¼˜åŒ–ï¼ˆSSOï¼‰çš„å±€é™æ€§**

* è™½ç„¶ç°ä»£ `std::string` æœ‰ SSOï¼ˆé€šå¸¸ < 15-23 å­—ç¬¦ä¸åˆ†é…å †å†…å­˜ï¼‰
* ä½† `substr()`ã€å‡½æ•°å‚æ•°ä¼ é€’ç­‰ä»å¯èƒ½è§¦å‘åˆ†é…
* `string_view` åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½é¿å…åˆ†é…



## æœ€ä½³å®è·µå»ºè®®

### 1. **å‡½æ•°å‚æ•°é¦–é€‰ `string_view`**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">// æ¥å— stringã€char*ã€string_view çš„é€šç”¨æ¥å£</span><span>
</span><span></span><span class="token">void</span><span> </span><span class="token">ProcessName</span><span class="token">(</span><span>std</span><span class="token double-colon">::</span><span>string_view name</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">// å¤„ç†é€»è¾‘</span><span>
</span><span></span><span class="token">}</span></code></pre></div></div></pre>

### 2. **å†…éƒ¨å¤„ç†ç”¨ `string_view`ï¼Œå­˜å‚¨ç”¨ `string`**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">class</span><span> </span><span class="token">Parser</span><span> </span><span class="token">{</span><span>
</span><span>    std</span><span class="token double-colon">::</span><span>string m_storedData</span><span class="token">;</span><span> </span><span class="token">// æ‹¥æœ‰æ•°æ®</span><span>
</span>  
<span></span><span class="token">public</span><span class="token">:</span><span>
</span><span>    </span><span class="token">void</span><span> </span><span class="token">Parse</span><span class="token">(</span><span>std</span><span class="token double-colon">::</span><span>string_view input</span><span class="token">)</span><span> </span><span class="token">{</span><span> </span><span class="token">// åªè¯»è§†å›¾</span><span>
</span><span>        </span><span class="token">// è§£æé€»è¾‘ä½¿ç”¨ string_view</span><span>
</span><span>        </span><span class="token">auto</span><span> token </span><span class="token">=</span><span> input</span><span class="token">.</span><span class="token">substr</span><span class="token">(</span><span class="token">0</span><span class="token">,</span><span> </span><span class="token">5</span><span class="token">)</span><span class="token">;</span><span>
</span><span>        </span><span class="token">// ...</span><span>
</span><span>    </span><span class="token">}</span><span>
</span><span></span><span class="token">}</span><span class="token">;</span></code></pre></div></div></pre>

### 3. **ç»“åˆç§»åŠ¨è¯­ä¹‰**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[36px] sticky top-0 z-10 bg-primary"><div class="flex items-center h-[36px] px-3 text-12 align-middle border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-12 overflow-ellipsis whitespace-nowrap overflow-hidden text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">ç¼–è¾‘</span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-16 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-copy-line"></use></svg></span><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-moon-line"></use></svg></span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon text-16 size-4"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#pcicon-up-line"></use></svg></span></div></div></div></div><pre class="sc-gvqKNf fmGlXS"><code><span class="token">// å½“éœ€è¦è·å–æ‰€æœ‰æƒæ—¶</span><span>
</span><span>std</span><span class="token double-colon">::</span><span>string </span><span class="token">TakeOwnership</span><span class="token">(</span><span>std</span><span class="token double-colon">::</span><span>string_view view</span><span class="token">)</span><span> </span><span class="token">{</span><span>
</span><span>    </span><span class="token">return</span><span> std</span><span class="token double-colon">::</span><span class="token">string</span><span class="token">(</span><span>view</span><span class="token">)</span><span class="token">;</span><span> </span><span class="token">// æ˜¾å¼æ„é€ </span><span>
</span><span></span><span class="token">}</span></code></pre></div></div></pre>



## æ€»ç»“ï¼šä½•æ—¶ä½¿ç”¨ä»€ä¹ˆï¼Ÿ


| åœºæ™¯                 | æ¨èç±»å‹                                    | åŸå›                      |
| -------------------- | ------------------------------------------- | ------------------------ |
| **å‡½æ•°å‚æ•°ï¼ˆåªè¯»ï¼‰** | `std::string_view`                          | é›¶æ‹·è´ï¼Œæ”¯æŒå¤šç§è¾“å…¥ç±»å‹ |
| **éœ€è¦ä¿®æ”¹å­—ç¬¦ä¸²**   | `std::string`                               | `string_view` æ˜¯åªè¯»çš„   |
| **é•¿æœŸå­˜å‚¨å­—ç¬¦ä¸²**   | `std::string`                               | `string_view` ä¸æ‹¥æœ‰æ•°æ® |
| **ä¸´æ—¶å­ä¸²æ“ä½œ**     | `std::string_view`                          | é¿å…ä¸å¿…è¦çš„åˆ†é…å’Œå¤åˆ¶   |
| **C++14 åŠä»¥ä¸‹é¡¹ç›®** | è‡ªå®šä¹‰`string_view` æˆ– `const char* + size` | å‘åå…¼å®¹                 |
