# **C++ 中如何使用静态链接库（Static Linking）**

## 🎯 一、核心目标：掌握 C++ 静态链接

> **在 C++ 中使用第三方库（如 GLFW）进行静态链接，实现独立可执行文件。**

---

## ✅ 二、为什么 C++ 的库管理“看起来很难”？


| 语言   | 包管理             | 说明                         |
| ------ | ------------------ | ---------------------------- |
| Python | `pip install glfw` | 自动下载、安装、配置         |
| C#     | NuGet              | 图形化添加引用，自动处理依赖 |
| C++    | ❌ 无统一包管理    | 手动下载、配置路径、匹配架构 |

👉 **C++ 的“难”在于手动配置，而不是技术本身复杂。**

但一旦理解流程，其实**非常简单且可控**。

## 🔍 三、静态链接 vs 动态链接：本质区别


| 特性           | 静态链接（Static Linking） | 动态链接（Dynamic Linking） |
| -------------- | -------------------------- | --------------------------- |
| **链接时机**   | 编译时                     | 运行时                      |
| **库文件**     | `.lib`（静态库）           | `.dll` + `.lib`（导入库）   |
| **可执行文件** | 包含库代码，体积大         | 不包含库代码，体积小        |
| **运行依赖**   | 无需额外文件               | 需要`.dll` 文件同目录       |
| **性能**       | 略高（链接时优化）         | 略低（运行时加载）          |
| **调试支持**   | 更好（可调试库代码）       | 差（除非有 PDB）            |
| **推荐场景**   | 小型项目、独立发布         | 大型项目、共享库            |

> ✅ **Cherno 推荐：优先使用静态链接**，除非你有特殊需求。

## ✅ 四、选择正确的库版本：32位 vs 64位

### ❌ 常见误区：

> “我用的是 64 位 Windows，所以必须用 64 位库。”

### ✅ 正确做法：

> **根据你的项目目标平台选择库版本！**


| 项目配置    | 应使用的库  |
| ----------- | ----------- |
| Win32 / x86 | 32 位`.lib` |
| x64         | 64 位`.lib` |

> ⚠️ **不匹配会导致链接错误（LNK2019）**

## 📁 五、C++ 库的典型结构（以 GLFW 为例）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>GLFW/
</span><span>├── </span><span>include</span><span>/
</span>│   └── GLFW/
│       └── glfw3.h        ← 头文件（声明函数）
└── lib-vc2022/
    ├── glfw3.lib          ← 静态库（.obj 集合，大文件）
    ├── glfw3dll.lib       ← 导入库（小文件，用于动态链接）
    └── glfw3.dll          ← 动态库（运行时加载）</code></pre></div></div></pre>

> ✅ **静态链接只需：`glfw3.h` + `glfw3.lib`**

## 六、Visual Studio 配置步骤（静态链接）

### 1. **目录结构建议**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>MyProject/
</span>├── MyProject.sln
├── Dependencies/
│   └── GLFW/
<span>│       ├── </span><span>include</span><span>/
</span>│       └── lib-vc2022/
└── src/
    └── main.cpp</code></pre></div></div></pre>

---

### 2. **项目属性设置**


| 设置项                                                  | 值                                           | 说明                    |
| ------------------------------------------------------- | -------------------------------------------- | ----------------------- |
| **C/C++ → General → Additional Include Directories**  | `$(SolutionDir)Dependencies\GLFW\include`    | 让编译器找到`glfw3.h`   |
| **Linker → General → Additional Library Directories** | `$(SolutionDir)Dependencies\GLFW\lib-vc2022` | 让链接器找到`glfw3.lib` |
| **Linker → Input → Additional Dependencies**          | `glfw3.lib`                                  | 指定要链接的库文件      |

> ✅ 使用 `$(SolutionDir)` 实现**路径相对化**，便于团队协作和 GitHub 共享。

## 七、可运行代码（静态链接 GLFW）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// main.cpp</span><span>
</span><span></span><span>#</span>include<span> </span><iostream><span>
</span><span></span><span>#</span>include<span> </span><GLFW/glfw3.h><span>  </span><span>// 包含头文件</span><span>
</span>
<span></span>int main() <span>{
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Initializing GLFW..."</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>
<span>    </span><span>// 初始化 GLFW</span><span>
</span><span>    </span><span>if</span><span> (!glfwInit()) {
</span><span>        </span><span>std</span><span>::</span><span>cerr</span><span> << </span><span>"Failed to initialize GLFW!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span><span>        </span><span>return</span><span> </span>-1<span>;
</span>    }

<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"GLFW initialized successfully!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>
<span>    </span><span>// 创建窗口（可选）</span><span>
</span><span>    GLFWwindow* window = glfwCreateWindow(</span>800<span>, </span>600<span>, </span><span>"Hello GLFW"</span><span>, </span><span>nullptr</span><span>, </span><span>nullptr</span><span>);
</span><span>    </span><span>if</span><span> (!window) {
</span><span>        </span><span>std</span><span>::</span><span>cerr</span><span> << </span><span>"Failed to create window!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>        glfwTerminate();
<span>        </span><span>return</span><span> </span>-1<span>;
</span>    }

<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Window created!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>
<span>    </span><span>// 主循环</span><span>
</span><span>    </span><span>while</span><span> (!glfwWindowShouldClose(window)) {
</span>        glfwPollEvents();
    }

<span>    </span><span>// 清理</span><span>
</span>    glfwDestroyWindow(window);
    glfwTerminate();

<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"GLFW terminated. Press Enter to exit."</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span><span>    </span><span>std</span><span>::</span><span>cin</span><span>.get();
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

## 八、深入理解：头文件 vs 库文件

### 1. **头文件（glfw3.h）的作用**

* 提供函数声明：`int glfwInit();`
* 提供类型定义：`GLFWwindow`
* 提供宏定义：`GLFW_TRUE`

> ✅ **没有头文件，编译器不知道函数存在**

---

### 2. **库文件（glfw3.lib）的作用**

* 包含函数的实际实现（机器码）
* 链接器将 `.lib` 中的代码“粘贴”到 `.exe` 中

> ✅ **没有库文件，链接器找不到函数定义 → LNK2019**

---

### 3. **手动声明函数（不推荐但可行）**

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// 不包含头文件，手动声明</span><span>
</span><span></span><span>extern</span><span> </span><span>"C"</span><span> </span>int glfwInit()<span>;  </span><span>// 必须加 extern "C"！</span><span>
</span>
<span></span>int main() <span>{
</span><span>    </span><span>int</span><span> result = glfwInit();
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"glfwInit returned: "</span><span> << result << </span><span>std</span><span>::</span><span>endl</span><span>;
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

> ⚠️ **为什么必须 `extern "C"`？**

* C++ 会对函数名进行**名字修饰（Name Mangling）**
* C 语言库（如 GLFW）使用 C 链接，名字不变
* `extern "C"` 告诉编译器：“不要修饰这个名字！”

## ✅ 九、常见错误与解决方案


| 错误                                                          | 原因               | 解决方案                                               |
| ------------------------------------------------------------- | ------------------ | ------------------------------------------------------ |
| `fatal error C1083: Cannot open include file: 'GLFW/glfw3.h'` | 头文件路径未设置   | 检查`Additional Include Directories`                   |
| `LNK2019: unresolved external symbol _glfwInit`               | 库文件未链接       | 检查`Additional Dependencies` 和 `Library Directories` |
| `LNK1104: cannot open file 'glfw3.lib'`                       | 路径错误或文件缺失 | 检查路径、文件名、32/64 位匹配                         |
| 程序崩溃或返回 0                                              | 库版本不兼容       | 使用匹配编译器的`.lib`（如 `lib-vc2022`）              |

## 最终总结口诀

> **“C++ 加库不神秘，头文件声明库实现；
> 包含路径设正确，库路径名要匹配；
> 静态链接嵌入 exe，动态依赖 dll 一起；
> extern C 防混淆，名字修饰要牢记；
> 相对路径靠宏定，团队协作无障碍！”**

## 十、高级建议：源码编译 vs 二进制链接


| 方式           | 优点           | 缺点           | 适用场景           |
| -------------- | -------------- | -------------- | ------------------ |
| **二进制链接** | 快速、简单     | 无法调试库代码 | 快速原型、学习     |
| **源码编译**   | 可调试、可修改 | 构建复杂、耗时 | 大型项目、深度定制 |

> ✅ **Cherno 的建议**：时间充裕时，**优先编译源码**，便于调试和优化。

---

## ✅ 十一、最佳实践总结

### 📌 1. 目录结构清晰

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>Project/
</span>├── Dependencies/    ← 所有第三方库
├── src/             ← 源码
<span>├── </span><span>include</span><span>/         ← 自定义头文件
</span>└── build/           ← 编译输出</code></pre></div></div></pre>

### 📌 2. 使用相对路径

* 使用 `$(SolutionDir)`、`$(ProjectDir)` 等宏
* 避免硬编码绝对路径

### 📌 3. 选择正确的库

* 匹配平台（x86/x64）
* 匹配编译器（MSVC、MinGW）
* 优先静态链接

### 📌 4. 头文件包含规范

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// 自定义头文件用双引号</span><span>
</span><span></span><span>#</span>include<span> </span>"myheader.h"<span>
</span>
<span></span><span>// 第三方库用尖括号</span><span>
</span><span></span><span>#</span>include<span> </span><GLFW/glfw3.h><span>
</span><span></span><span>#</span>include<span> </span><iostream></code></pre></div></div></pre>

# vscode中的静态链接

## 一、Linux 环境准备

### ✅ 前提条件

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span># 1. 安装编译器（g++）</span><span>
</span>sudo apt update
sudo apt install build-essential

<span></span><span># 2. 安装 GLFW 开发包（包含头文件和动态库）</span><span>
</span>sudo apt install libglfw3-dev

<span></span><span># 3. 安装 OpenGL 相关库</span><span>
</span>sudo apt install libgl1-mesa-dev libx11-dev libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev</code></pre></div></div></pre>

> ⚠️ 注意：`libglfw3-dev` 默认安装的是 **动态库**（`.so`）和头文件，但我们需要 **静态库**（`.a`），所以稍后要自己编译或下载。

---

## 📁 二、项目结构（推荐）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>HelloGLFW/
</span><span>├── </span><span>include</span><span>/              </span><span># 自定义或第三方头文件</span><span>
</span><span>├── lib/                  </span><span># 静态库文件 (.a)</span><span>
</span>├── src/
│   └── main.cpp
<span>├── CMakeLists.txt        </span><span># 构建配置</span><span>
</span><span>└── .vscode/              </span><span># VS Code 配置（可选）</span></code></pre></div></div></pre>

---

## 🧱 三、获取 GLFW 静态库（`.a` 文件）

Linux 上默认没有提供 `.a` 文件，所以我们需要：

### ✅ 方法 1：自己编译 GLFW 源码（推荐）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span># 1. 下载 GLFW 源码</span><span>
</span><span>git </span><span>clone</span><span> https://github.com/glfw/glfw.git
</span><span></span><span>cd</span><span> glfw
</span>
<span></span><span># 2. 创建构建目录</span><span>
</span>mkdir build
<span></span><span>cd</span><span> build
</span>
<span></span><span># 3. 使用 CMake 配置为静态库</span><span>
</span>cmake .. \
    -D BUILD_SHARED_LIBS=OFF \
    -D CMAKE_BUILD_TYPE=Release \
<span>    -D CMAKE_INSTALL_PREFIX=/usr/</span><span>local</span><span>
</span>
<span></span><span># 4. 编译</span><span>
</span>make -j$(nproc)

<span></span><span># 5. 安装（可选，会把 libglfw3.a 和头文件放到系统目录）</span><span>
</span>sudo make install</code></pre></div></div></pre>

> ✅ 编译完成后，静态库在 `src/libglfw.a`（你可以复制到你的项目 `lib/` 目录）

---

### ✅ 方法 2：直接复制静态库到项目

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span># 假设你已经编译好了 GLFW</span><span>
</span>cp glfw/src/libglfw.a HelloGLFW/lib/libglfw3.a
cp -r glfw/include/GLFW HelloGLFW/include/</code></pre></div></div></pre>

现在你的项目结构是：

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>HelloGLFW/
</span><span>├── </span><span>include</span><span>/
</span>│   └── GLFW/           ← glfw3.h
├── lib/
│   └── libglfw3.a      ← 静态库
├── src/main.cpp
└── CMakeLists.txt</code></pre></div></div></pre>

---

## 📜 四、编写 `main.cpp`

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>// src/main.cpp</span><span>
</span><span></span><span>#</span>include<span> </span><iostream><span>
</span><span></span><span>#</span>include<span> </span><GLFW/glfw3.h><span>
</span>
<span></span>int main() <span>{
</span><span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Initializing GLFW..."</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>
<span>    </span><span>if</span><span> (!glfwInit()) {
</span><span>        </span><span>std</span><span>::</span><span>cerr</span><span> << </span><span>"Failed to initialize GLFW!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span><span>        </span><span>return</span><span> </span>-1<span>;
</span>    }

<span>    GLFWwindow* window = glfwCreateWindow(</span>800<span>, </span>600<span>, </span><span>"Hello Linux!"</span><span>, </span><span>nullptr</span><span>, </span><span>nullptr</span><span>);
</span><span>    </span><span>if</span><span> (!window) {
</span><span>        </span><span>std</span><span>::</span><span>cerr</span><span> << </span><span>"Failed to create window!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>        glfwTerminate();
<span>        </span><span>return</span><span> </span>-1<span>;
</span>    }

<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Window created! Close window to exit."</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span>
<span>    </span><span>while</span><span> (!glfwWindowShouldClose(window)) {
</span>        glfwPollEvents();
    }

    glfwTerminate();
<span>    </span><span>std</span><span>::</span><span>cout</span><span> << </span><span>"Goodbye!"</span><span> << </span><span>std</span><span>::</span><span>endl</span><span>;
</span><span>    </span><span>return</span><span> </span>0<span>;
</span>}</code></pre></div></div></pre>

---

## 🧰 五、编写 `CMakeLists.txt`（推荐方式）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cmake</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>cmake_minimum_required(VERSION </span>3.10<span>)
</span>project(HelloGLFW)

<span>set(CMAKE_CXX_STANDARD </span>17<span>)
</span>
<span></span><span># 添加可执行文件</span><span>
</span>add_executable(HelloGLFW src/main.cpp)

<span></span><span># 包含头文件路径</span><span>
</span><span>target_include_directories(HelloGLFW </span><span>PRIVATE</span><span> </span><span>include</span><span>)
</span>
<span></span><span># 链接静态库</span><span>
</span>target_link_libraries(HelloGLFW
    lib/libglfw3.a
<span>    GL        </span><span># OpenGL</span><span>
</span><span>    X11       </span><span># X Window System</span><span>
</span><span>    Xrandr    </span><span># 窗口大小调整</span><span>
</span><span>    Xinerama  </span><span># 多显示器</span><span>
</span><span>    Xcursor   </span><span># 鼠标光标</span><span>
</span><span>    Xi        </span><span># 输入设备</span><span>
</span><span>    pthread   </span><span># 线程支持</span><span>
</span><span>    dl        </span><span># 动态加载（GLFW 内部使用）</span><span>
</span>)</code></pre></div></div></pre>

---

## ⚙️ 六、在 VS Code 中构建和运行

### 1. 打开项目

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>code HelloGLFW</span></code></pre></div></div></pre>

### 2. 安装 VS Code 插件

* **C/C++**（by Microsoft）
* **CMake Tools**
* **CMake Tools Helper**（可选）

### 3. 构建项目

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span># 在终端中执行</span><span>
</span>mkdir build
<span></span><span>cd</span><span> build
</span>cmake ..
make</code></pre></div></div></pre>

### 4. 运行

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>./HelloGLFW</span></code></pre></div></div></pre>

👉 你应该能看到一个 800x600 的窗口弹出！

---

## 🧪 七、直接使用 `g++` 命令行（不推荐，但可理解原理）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>g++ src/main.cpp \
</span>    -Iinclude \
    -Llib \
    -lglfw3 \
    -lGL -lX11 -lXrandr -lXinerama -lXcursor -lXi -lpthread -ldl \
    -o HelloGLFW</code></pre></div></div></pre>

> ⚠️ 注意：`-lglfw3` 会查找 `libglfw3.a` 或 `libglfw3.so`，优先静态库（如果存在）

---

## 🛠️ 八、VS Code 配置（可选）

### `.vscode/tasks.json`：构建任务

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">json</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>{
</span><span>    </span><span>"version"</span><span>: </span><span>"2.0.0"</span><span>,
</span><span>    </span><span>"tasks"</span><span>: [
</span>        {
<span>            </span><span>"label"</span><span>: </span><span>"Build HelloGLFW"</span><span>,
</span><span>            </span><span>"type"</span><span>: </span><span>"shell"</span><span>,
</span><span>            </span><span>"command"</span><span>: </span><span>"cmake"</span><span>,
</span><span>            </span><span>"args"</span><span>: [
</span><span>                </span><span>"--build"</span><span>,
</span><span>                </span><span>"build"</span><span>,
</span><span>                </span><span>"--config"</span><span>,
</span><span>                </span><span>"Release"</span><span>
</span>            ],
<span>            </span><span>"group"</span><span>: </span><span>"build"</span><span>,
</span><span>            </span><span>"presentation"</span><span>: {
</span><span>                </span><span>"echo"</span><span>: </span><span>true</span><span>,
</span><span>                </span><span>"reveal"</span><span>: </span><span>"always"</span><span>
</span>            },
<span>            </span><span>"problemMatcher"</span><span>: [</span><span>"</span><span>$gcc</span><span>"</span><span>]
</span>        }
    ]
}</code></pre></div></div></pre>

### `.vscode/launch.json`：调试配置

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">json</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>{
</span><span>    </span><span>"version"</span><span>: </span><span>"0.2.0"</span><span>,
</span><span>    </span><span>"configurations"</span><span>: [
</span>        {
<span>            </span><span>"name"</span><span>: </span><span>"Debug HelloGLFW"</span><span>,
</span><span>            </span><span>"type"</span><span>: </span><span>"cppdbg"</span><span>,
</span><span>            </span><span>"request"</span><span>: </span><span>"launch"</span><span>,
</span><span>            </span><span>"program"</span><span>: </span><span>"</span><span>${workspaceFolder}</span><span>/build/HelloGLFW"</span><span>,
</span><span>            </span><span>"args"</span><span>: [],
</span><span>            </span><span>"stopAtEntry"</span><span>: </span><span>false</span><span>,
</span><span>            </span><span>"cwd"</span><span>: </span><span>"</span><span>${workspaceFolder}</span><span>"</span><span>,
</span><span>            </span><span>"environment"</span><span>: [],
</span><span>            </span><span>"externalConsole"</span><span>: </span><span>false</span><span>,
</span><span>            </span><span>"MIMode"</span><span>: </span><span>"gdb"</span><span>,
</span><span>            </span><span>"setupCommands"</span><span>: [
</span>                {
<span>                    </span><span>"description"</span><span>: </span><span>"Enable pretty-printing"</span><span>,
</span><span>                    </span><span>"text"</span><span>: </span><span>"-enable-pretty-printing"</span><span>,
</span><span>                    </span><span>"ignoreFailures"</span><span>: </span><span>true</span><span>
</span>                }
            ],
<span>            </span><span>"preLaunchTask"</span><span>: </span><span>"Build HelloGLFW"</span><span>,
</span><span>            </span><span>"miDebuggerPath"</span><span>: </span><span>"/usr/bin/gdb"</span><span>
</span>        }
    ]
}</code></pre></div></div></pre>

---

## ✅ 九、关键总结：Linux 上 VS Code 静态链接要点


| 要点           | 说明                                        |
| -------------- | ------------------------------------------- |
| **静态库后缀** | `.a`（如 `libglfw3.a`）                     |
| **头文件路径** | `-Iinclude` 或 `target_include_directories` |
| **库路径**     | `-Llib`                                     |
| **链接库**     | `-lglfw3`                                   |
| **依赖库**     | `GL`, `X11`, `pthread`, `dl` 等             |
| **构建方式**   | 推荐使用**CMake**                           |
| **编译器**     | `g++`（GCC）                                |
| **调试器**     | `gdb`                                       |

---

## 🚀 十、最佳实践建议

1. **使用 CMake**：它是跨平台的事实标准
2. **自己编译 GLFW**：获得静态库 `.a` 文件
3. **使用 `libglfw3.a`**：确保是静态链接
4. **不要依赖系统 `libglfw3-dev` 的 `.so`**：那是动态库
5. **VS Code 只是编辑器**：真正的构建靠 `cmake` + `make`



# C++ 中使用动态库：核心概念与实践总结

该网页内容是 **The Cherno C++ 教程系列** 的第 50 集笔记，专注于讲解 **动态链接（Dynamic Linking）** 的原理和实践，特别是以 **GLFW** 库为例。

---

### 一、动态链接的核心概念


| 特性         | 说明                                                                                                                          |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------- |
| **链接时机** | **运行时（Runtime）**。与静态链接在编译时完成不同，动态链接发生在程序启动或运行过程中。                                       |
| **文件形式** | 生成 **独立的文件**，在 Windows 上是 `.dll` (Dynamic Link Library)，在 Linux 上是 `.so` (Shared Object)。                     |
| **加载方式** | 可执行文件（`.exe`）在启动时或运行中，由操作系统加载器将 `.dll` 文件加载到内存。                                              |
| **依赖关系** | 可执行文件依赖于外部的`.dll` 文件。如果 `.dll` 缺失或路径错误，程序将无法启动，并可能弹出“缺少 DLL”或“找不到 DLL”的错误。 |

> 💡 **关键比喻**：静态链接是把图书馆的书“复印”并装订进你的书里；动态链接是只在书里写个“参考文献”，等你真正需要时再去图书馆借那本书。


### 二、动态链接的两种模式

该笔记提到了使用动态库的两种不同方式：

#### 1. **隐式链接 (Implicit Linking) - “静态的”动态链接**

* **描述**：这是最常见的方式。你的应用程序**明确知道**它需要哪个动态库（如 `glfw3.dll`），并且知道库中有哪些函数。
* **实现**：
  1. 包含库的头文件（如 `#include <GLFW/glfw3.h>`）来获得函数声明。
  2. 在链接阶段，链接器使用一个 **导入库（Import Library）**，通常是 `.lib` 文件（如 `glfw3dll.lib`）。
  3. 这个 `.lib` 文件不包含函数的实际代码，而是包含了指向 `.dll` 中函数的“地址簿”（符号信息）。
  4. 链接器利用这个 `.lib` 文件来解析函数调用，生成一个依赖于 `.dll` 的可执行文件。
* **特点**：
  * 代码编写简单，和使用静态库非常相似。
  * 程序启动时，操作系统必须能找到对应的 `.dll` 文件（通常放在 `.exe` 同目录下）。
  * 如果 `.dll` 找不到，程序会直接崩溃，无法启动。

#### 2. **显式链接 (Explicit Linking) - 完全动态加载**

* **描述**：你的应用程序在运行时**动态地、任意地**加载一个 `.dll` 文件，甚至可能事先不知道里面有什么函数。
* **实现**：
  1. 使用操作系统 API（如 Windows 的 `LoadLibrary` 和 `GetProcAddress`）在运行时加载 `.dll`。
  2. 通过函数名查找，获取函数的内存地址（即函数指针）。
  3. 通过函数指针调用该函数。
* **特点**：
  * 更加灵活，可以实现插件系统、延迟加载等功能。
  * 代码更复杂，需要处理加载失败、函数查找失败等异常情况。
  * 可执行文件本身不直接依赖 `.dll`，只有在调用 `LoadLibrary` 时才产生依赖。


### 三、关键实践步骤（以 GLFW 为例）

1. **获取正确的二进制文件**：
   * 下载 GLFW 的预编译二进制文件包。
   * 确保 `.dll` 文件（如 `glfw3.dll`）和其对应的 **导入库 `.lib` 文件**（如 `glfw3dll.lib`）**同时存在且版本匹配**。
   * **重要警告**：不能用 `glfw3.lib`（静态库）去链接 `glfw3.dll`（动态库），这会导致链接错误或运行时崩溃。必须使用 `glfw3dll.lib`。
2. **配置 Visual Studio 项目**：
   * **包含目录 (Include Directories)**：添加 `glfw3.h` 所在的 `include` 目录。
   * **库目录 (Library Directories)**：添加 `glfw3dll.lib` 所在的 `lib` 目录（如 `lib-vc2022`）。
   * **附加依赖项 (Additional Dependencies)**：添加 `glfw3dll.lib`。
3. **部署 `.dll` 文件**：
   * 将 `glfw3.dll` 文件复制到你的可执行文件（`.exe`）的输出目录（通常是 `Debug` 或 `Release` 文件夹）。
   * 这样当程序运行时，操作系统就能在可执行文件旁边找到所需的 `.dll`。
4. **运行程序**：
   * 如果一切配置正确，程序可以成功运行。
   * 如果 `glfw3.dll` 缺失，程序会立即崩溃并弹出错误对话框。


### 四、与静态链接的对比


| 特性               | 静态链接                 | 动态链接                                  |
| ------------------ | ------------------------ | ----------------------------------------- |
| **链接时机**       | 编译时                   | 运行时                                    |
| **可执行文件大小** | 大（包含库代码）         | 小（不包含库代码）                        |
| **运行依赖**       | 无（独立运行）           | 有（需要`.dll` 文件）                     |
| **性能**           | 理论上更快（链接时优化） | 理论上稍慢（运行时加载）                  |
| **更新**           | 需要重新编译整个程序     | 只需替换`.dll` 文件                       |
| **内存使用**       | 每个进程都有一份库的副本 | 多个进程可共享同一份`.dll` 在内存中的副本 |
| **部署复杂度**     | 低（单个`.exe`）         | 高（需分发`.dll`）                        |

---

### 五、核心要点总结

1. **动态链接 = 运行时加载**：`.dll` 文件在程序启动时被加载到内存。
2. **依赖问题**：`.dll` 文件必须与 `.exe` 文件在同一目录或系统路径中，否则程序无法启动。
3. **正确的库对**：使用动态库时，必须使用与 `.dll` 配套的 **导入库（`.lib`）**，而不是静态库的 `.lib`。
4. **两种模式**：
   * **隐式链接**：通过头文件和导入库 `.lib`，像使用静态库一样调用函数。
   * **显式链接**：在运行时用 `LoadLibrary` 等 API 动态加载，更灵活但更复杂。
5. **部署是关键**：编译成功不代表能运行，必须确保 `.dll` 文件随 `.exe` 一起部署。



### 六、为什么需要 `extern "C"`？（补充说明）

虽然本页笔记没有重点强调，但在使用 C 语言编写的库（如 GLFW）时，如果直接在 C++ 中声明函数，可能会遇到 **名字修饰（Name Mangling）** 问题。

* C++ 编译器会对函数名进行修饰以支持重载，而 C 编译器不会。
* 为了确保 C++ 代码能正确链接到 C 库的函数，需要使用 `extern "C"` 来告诉编译器：“请使用 C 语言的链接规则，不要修饰这个名字”。

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cpp</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>extern</span><span> </span><span>"C"</span><span> {
</span><span>    </span>int glfwInit()<span>;
</span><span>    </span>void glfwTerminate()<span>;
</span>}</code></pre></div></div></pre>



# C++动态库的cmake、xmake的使用


## 一、核心目标

> ✅ **在 CMake 或 xmake 中配置项目，使其能正确链接并运行时加载动态库（`.dll` / `.so` / `.dylib`）。**

我们以 **GLFW** 库为例，展示完整流程。

---

## 🔧 二、方法总览


| 步骤            | 说明                                                |
| --------------- | --------------------------------------------------- |
| 1. 获取动态库   | 下载预编译的`.dll` (Windows) 或 `.so` (Linux)       |
| 2. 配置构建系统 | 告诉 CMake/xmake 头文件在哪、库文件在哪             |
| 3. 链接库       | 在构建脚本中声明要链接的库                          |
| 4. 部署 DLL     | 确保`.dll` 文件与可执行文件同目录（Windows 关键！） |

---

## 🐧 三、Linux 上的 CMake 示例（使用 `.so`）

### 📁 目录结构

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>HelloGLFW/
</span><span>├── </span><span>include</span><span>/              </span><span># GLFW 头文件</span><span>
</span>│   └── GLFW/glfw3.h
├── lib/
<span>│   └── libglfw.so        </span><span># 动态库（或 .so.3.3）</span><span>
</span>├── src/main.cpp
└── CMakeLists.txt</code></pre></div></div></pre>

### ✅ `CMakeLists.txt`

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cmake</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>cmake_minimum_required(VERSION </span>3.10<span>)
</span>project(HelloGLFW)

<span>set(CMAKE_CXX_STANDARD </span>17<span>)
</span>
<span></span><span># 添加可执行文件</span><span>
</span>add_executable(HelloGLFW src/main.cpp)

<span></span><span># 包含头文件路径</span><span>
</span><span>target_include_directories(HelloGLFW </span><span>PRIVATE</span><span> </span><span>include</span><span>)
</span>
<span></span><span># 链接动态库</span><span>
</span>target_link_libraries(HelloGLFW
    lib/libglfw.so
    GL X11 Xrandr Xinerama Xcursor Xi pthread dl
)</code></pre></div></div></pre>

### ✅ 构建 & 运行

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>mkdir build && </span><span>cd</span><span> build
</span>cmake ..
make
<span>./HelloGLFW  </span><span># ✅ 成功运行</span></code></pre></div></div></pre>

> 💡 Linux 上 `.so` 文件通常在系统路径或 `LD_LIBRARY_PATH` 中，但这里我们直接指定路径，也能工作。


## 四、Windows 上的 CMake 示例（使用 `.dll` + `.lib`）

### 📁 目录结构

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>HelloGLFW/
</span>├── include/GLFW/glfw3.h
├── lib/glfw3dll.lib      ← 导入库（.lib）
<span>├── </span><span>bin</span><span>/glfw3.dll         ← 实际动态库（.dll）
</span>├── src/main.cpp
└── CMakeLists.txt</code></pre></div></div></pre>

### ✅ `CMakeLists.txt`

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cmake</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>cmake_minimum_required(VERSION 3.10)
</span>project(HelloGLFW)

<span></span><span>set</span><span>(CMAKE_CXX_STANDARD 17)
</span>
add_executable(HelloGLFW src/main.cpp)

<span></span><span># 包含头文件</span><span>
</span>target_include_directories(HelloGLFW PRIVATE include)

<span></span><span># 链接导入库（.lib）</span><span>
</span>target_link_libraries(HelloGLFW
    lib/glfw3dll.lib
    opengl32 gdi32
)

<span></span><span># 将 .dll 复制到输出目录（关键！）</span><span>
</span>add_custom_command(TARGET HelloGLFW POST_BUILD
<span>    COMMAND </span><span>${CMAKE_COMMAND}</span><span> -E copy_if_different
</span><span>    </span><span>"</span><span>${CMAKE_SOURCE_DIR}</span><span>/bin/glfw3.dll"</span><span>
</span>    $<TARGET_FILE_DIR:HelloGLFW>
)</code></pre></div></div></pre>

### ✅ 解释

* `target_link_libraries(... lib/glfw3dll.lib ...)`：链接导入库，让链接器知道函数存在。
* `add_custom_command(... copy_if_different ...)`：在构建完成后，自动将 `glfw3.dll` 复制到可执行文件所在的目录（如 `build/Debug/`），确保运行时能找到它。

### ✅ 构建

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>mkdir build && </span><span>cd</span><span> build
</span><span>cmake .. -G </span><span>"Visual Studio 17 2022"</span><span> -A Win32
</span>cmake --build .
<span></span><span># ✅ build/Debug/ 下会有 HelloGLFW.exe 和 glfw3.dll</span></code></pre></div></div></pre>


## 五、使用 FindPackage 自动查找系统库（推荐）

更优雅的方式是让 CMake 自动查找已安装的库。

### ✅ `CMakeLists.txt`（使用 `find_package`）

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">cmake</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>cmake_minimum_required(VERSION </span>3.10<span>)
</span>project(HelloGLFW)

<span>set(CMAKE_CXX_STANDARD </span>17<span>)
</span>
<span></span><span># 查找 GLFW（需要 GLFWConfig.cmake 或 FindGLFW.cmake）</span><span>
</span>find_package(glfw3 REQUIRED)

add_executable(HelloGLFW src/main.cpp)

<span></span><span># 使用找到的 GLFW</span><span>
</span><span>target_link_libraries(HelloGLFW </span><span>PRIVATE</span><span> glfw)
</span>
<span></span><span># 如果是 Windows，复制 .dll（如果可用）</span><span>
</span><span></span><span>if</span><span>(WIN32 </span><span>AND</span><span> TARGET glfw::glfw)
</span>    get_target_property(GLFW_DLL_LOCATION glfw::glfw IMPORTED_LOCATION)
<span>    </span><span>if</span><span>(EXISTS </span><span>"${GLFW_DLL_LOCATION}"</span><span>)
</span>        add_custom_command(TARGET HelloGLFW POST_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy_if_different
<span>            </span><span>"${GLFW_DLL_LOCATION}"</span><span>
</span>            $<TARGET_FILE_DIR:HelloGLFW>
        )
<span>    </span><span>endif</span><span>()
</span><span></span><span>endif</span><span>()</span></code></pre></div></div></pre>

> ⚠️ 前提：GLFW 已通过 vcpkg、conan 或手动安装，并提供了 CMake 配置文件。



## 六、xmake 示例（跨平台神器）

[xmake]() 是一个现代化的 C/C++ 构建系统，语法简洁，对动态库支持极佳。

### 📁 目录结构

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">text</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>HelloGLFW/
</span>├── src/main.cpp
└── xmake.lua</code></pre></div></div></pre>

### ✅ `xmake.lua`

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">lua</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>-- xmake.lua
</span><span>add_rules(</span><span>"mode.debug"</span><span>, </span><span>"mode.release"</span><span>)
</span>
<span>target(</span><span>"HelloGLFW"</span><span>)
</span><span>    set_kind(</span><span>"binary"</span><span>)
</span><span>    set_languages(</span><span>"c++17"</span><span>)
</span><span>    add_files(</span><span>"src/*.cpp"</span><span>)
</span>
<span>    -- 方式</span>1<span>：使用 xmake 内建包管理
</span><span>    add_packages(</span><span>"glfw"</span><span>)
</span>
<span>    -- 方式</span>2<span>：手动指定路径（类似 CMake）
</span><span>    -- add_includedirs(</span><span>"include"</span><span>)
</span><span>    -- add_linkdirs(</span><span>"lib"</span><span>)
</span><span>    -- add_links(</span><span>"glfw3dll"</span><span>)  -- Windows
</span><span>    -- add_links(</span><span>"glfw"</span><span>)     -- Linux
</span>
    -- Windows: 自动复制 .dll 到输出目录
<span>    </span><span>if</span><span> is_plat(</span><span>"windows"</span><span>) then
</span><span>        after_build(</span>function ()
            import("devel.git")
            local repo_dir = path.join(os.projectdir(), "external", "glfw")
            local dll_path = path.join(repo_dir, "bin", "glfw3.dll")
            if os.isfile(dll_path) then
                os.cp(dll_path, "$(buildir)")
            end
        end)
    end</code></pre></div></div></pre>

### ✅ 构建 & 运行

<pre><div class="contain-layout-style rounded-12 bg-capsule relative flex min-h-[2em] flex-col"><div class="rounded-[12px] bg-[#fff]"><div class="h-[42px] sticky top-0 z-10 bg-capsule"><div class="flex items-center h-[42px] p-3 text-[14px] border border-[var(--ty-line-border)]"><span class="font-medium mr-auto first-letter:uppercase text-[rgba(17,17,51,0.7)]">bash</span><div class="flex items-center gap-4"><div class="flex items-center justify-center gap-[2px] cursor-pointer text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon size-4 cursor-pointer"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-editingTools-line"></use></svg></span><span class="mt-[2px] text-[12px]">编辑</span></div><div class="flex cursor-pointer gap-1 text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><span role="img" class="anticon"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-sun-line"></use></svg></span></div><span role="img" tabindex="-1" class="anticon flex cursor-pointer items-center text-[rgba(17,17,51,0.7)] hover:text-[#4433ff]"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#appicon-copy-line"></use></svg></span></div></div></div><pre><code><span>xmake f -p windows -a x86    </span><span># 配置为 Windows 32位</span><span>
</span><span>xmake                          </span><span># 构建</span><span>
</span><span>xmake run                      </span><span># 运行（xmake 会自动处理环境）</span></code></pre></div></div></pre>

> ✅ xmake 的 `add_packages("glfw")` 会自动下载、编译、链接 GLFW，**包括自动处理 .dll 部署**，非常方便！

---

## 📦 七、最佳实践建议


| 场景              | 推荐做法                                         |
| ----------------- | ------------------------------------------------ |
| **学习/快速原型** | 手动下载`.dll` + CMake `add_custom_command` 复制 |
| **团队/生产项目** | 使用 **包管理器**（vcpkg、conan、xmake）         |
| **跨平台开发**    | 使用**CMake + FindPackage** 或 **xmake**         |
| **插件系统**      | 显式链接（`LoadLibrary` / `dlopen`）+ 函数指针   |

---

## ✅ 八、总结：CMake / xmake 中的关键点


| 构建系统  | 如何体现动态库                                                                  |
| --------- | ------------------------------------------------------------------------------- |
| **CMake** | `target_link_libraries(... libfile.lib ...)` + `add_custom_command` 复制 `.dll` |
| **xmake** | `add_packages("glfw")` 或 `add_links("glfw3dll")` + `after_build` 复制 `.dll`   |

> 💡 **核心思想不变**：
>
> 1. 编译时：有头文件（声明）
> 2. 链接时：有导入库 `.lib`（符号信息）
> 3. 运行时：有 `.dll` 文件（实际代码）—— **这是 Windows 成功运行的关键！**
>
